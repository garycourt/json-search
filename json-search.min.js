var O={};function F(){}function typeOf(a){return a===void 0?"undefined":a===null?"null":Object.prototype.toString.call(a).split(" ").pop().split("]").shift().toLowerCase()}typeof exports==="undefined"&&(exports={});typeof require!=="function"&&(require=function(){return exports});if(typeof Object.create!=="function")Object.create=function(a){F.prototype=a;return new F};if(typeof Array.isArray!=="function")Array.isArray=function(a){return typeOf(a)==="array"};
if(typeof Array.add!=="function")Array.add=function(a,c){if(a.indexOf(c)===-1)return a[a.length]=c,!0;return!1};if(typeof Array.remove!=="function")Array.remove=function(a,c){var b=a.indexOf(c);if(b!==-1)return a.splice(b,1),!0;return!1};if(!Array.append)Array.append=function(a,c){c=c.slice(0);c.unshift(a.length,0);a.splice.apply(a,c);return a};
if(typeof Array.orderedInsert!=="function")Array.orderedInsert=function(a,c,b){var e,d,g;if(a.length===0)a[0]=c;else{e=0;d=a.length-1;for(g=Math.floor(d/2);e<d;)b(a[g],c)<=0?e=g+1:d=g-1,g=Math.round(e+(d-e)/2);e===d?b(a[e],c)<=0?a.splice(e+1,0,c):a.splice(e,0,c):a.splice(d+1,0,c)}};var EventEmitter=function(){};
try{if(!require("events").EventEmitter)throw Error();EventEmitter=require("events").EventEmitter}catch(e$$5){EventEmitter.prototype.emit=function(a,c){if(a==="error"&&(!this._events||!this._events.error||Array.isArray(this._events.error)&&!this._events.error.length))if(arguments[1]instanceof Error)throw arguments[1];else throw Error("Uncaught, unspecified 'error' event.");if(!this._events)return!1;var b=this._events[a];if(!b)return!1;if(typeof b=="function"){switch(arguments.length){case 1:b.call(this);
break;case 2:b.call(this,arguments[1]);break;case 3:b.call(this,arguments[1],arguments[2]);break;default:c=Array.prototype.slice.call(arguments,1),b.apply(this,c)}return!0}else if(Array.isArray(b)){for(var c=Array.prototype.slice.call(arguments,1),b=b.slice(),e=0,d=b.length;e<d;e++)b[e].apply(this,c);return!0}else return!1},EventEmitter.prototype.addListener=function(a,c){if("function"!==typeof c)throw Error("addListener only takes instances of Function");if(!this._events)this._events={};this._events[a]?
Array.isArray(this._events[a])?this._events[a].push(c):this._events[a]=[this._events[a],c]:this._events[a]=c;return this},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.once=function(a,c){function b(){e.removeListener(a,b);c.apply(this,arguments)}if("function"!==typeof c)throw Error(".once only takes instances of Function");var e=this;b.listener=c;e.on(a,b);return this},EventEmitter.prototype.removeListener=function(a,c){if("function"!==typeof c)throw Error("removeListener only takes instances of Function");
if(!this._events||!this._events[a])return this;var b=this._events[a];if(Array.isArray(b)){for(var e=-1,d=0,g=b.length;d<g;d++)if(b[d]===c||b[d].listener&&b[d].listener===c){e=d;break}if(e<0)return this;b.length===1?delete this._events[a]:b.splice(e,1)}else(b===c||b.listener&&b.listener===c)&&delete this._events[a];return this},EventEmitter.prototype.removeAllListeners=function(a){if(arguments.length===0)return this._events={},this;a&&this._events&&this._events[a]&&(this._events[a]=null);return this},
EventEmitter.prototype.listeners=function(a){if(!this._events)this._events={};this._events[a]||(this._events[a]=[]);Array.isArray(this._events[a])||(this._events[a]=[this._events[a]]);return this._events[a]}}exports.EventEmitter=EventEmitter;function Stream(){EventEmitter.call(this)}Stream.prototype=Object.create(EventEmitter.prototype);Stream.prototype.readable=!1;Stream.prototype.writable=!1;
Stream.prototype.pipe=function(a,c){function b(c){a.writable&&!1===a.write(c)&&j.pause()}function e(c){a.emit("error",c);j.destroy()}function d(){j.readable&&j.resume()}function g(){a.end()}function i(){j.pause()}function p(){j.readable&&j.resume()}function n(){j.removeListener("data",b);j.removeListener("error",e);a.removeListener("drain",d);j.removeListener("end",g);j.removeListener("close",g);a.removeListener("pause",i);a.removeListener("resume",p);j.removeListener("end",n);j.removeListener("close",
n);j.removeListener("error",n);a.removeListener("end",n);a.removeListener("close",n)}var j=this;j.on("data",b);if(!c||c.error!==!1)j.on("error",e);a.on("drain",d);if(!c||c.end!==!1)j.on("end",g),j.on("close",g);a.on("pause",i);a.on("resume",p);j.on("end",n);j.on("close",n);j.on("error",n);a.on("end",n);a.on("close",n)};Stream.prototype.pause=function(){this.emit("pause")};Stream.prototype.resume=function(){this.emit("resume")};
Stream.prototype.destroy=function(){this.writable=this.readable=!1;this.emit("close");this.removeAllListeners()};exports.Stream=Stream;function ArrayStream(a,c){Stream.call(this);this._entries=a;this._index=0;this._mapper=c}ArrayStream.prototype=Object.create(Stream.prototype);ArrayStream.prototype._started=!1;ArrayStream.prototype._paused=!1;ArrayStream.prototype.readable=!0;
ArrayStream.prototype._run=function(){var a;for(this._started=!0;!this._paused&&this._index<this._entries.length;)a=this._entries[this._index++],this._mapper&&(a=this._mapper(a)),this.emit("data",a);!this._paused&&this._index>=this._entries.length&&(this.emit("end"),this.destroy())};ArrayStream.prototype.start=function(){var a=this;setTimeout(function(){a._run()},0);return this};ArrayStream.prototype.pause=function(){this._paused=!0;Stream.prototype.pause.call(this)};
ArrayStream.prototype.resume=function(){if(this._started&&this._paused)this._paused=!1,this.start(),Stream.prototype.resume.call(this)};ArrayStream.prototype.destroy=function(){this._index=Number.POSITIVE_INFINITY;Stream.prototype.destroy.call(this)};exports.ArrayStream=ArrayStream;function Collector(a){var c=this;Stream.call(this);this.collection=[];this.callback=a||null;this.on("error",function(a){if(c.callback)c.callback(a),c.callback=null})}Collector.prototype=Object.create(Stream.prototype);
Collector.prototype.callback=null;Collector.prototype.writable=!0;Collector.prototype.write=function(a){this.collection.push(a);return!0};Collector.prototype.end=function(a){typeof a!=="undefined"&&this.write(a);this.destroy()};Collector.prototype.destroy=function(){if(this.callback)this.callback(null,this.collection),this.callback=null};exports.Collector=Collector;function SingleCollector(){Stream.call(this)}SingleCollector.prototype=Object.create(Stream.prototype);
SingleCollector.prototype._writing=!1;SingleCollector.prototype.readable=!0;SingleCollector.prototype.writable=!0;SingleCollector.prototype.write=function(a){if(typeof this.data!=="undefined")throw Error("Stream is full");this.data=a;this._writing=!0;this.emit("data",a);this._writing=!1;return typeof this.data==="undefined"};SingleCollector.prototype.drain=function(){this.data=void 0;this._writing||this.emit("drain")};
SingleCollector.prototype.end=function(a){typeof a!=="undefined"&&this.write(a);this.emit("end");this.destroy()};exports.SingleCollector=SingleCollector;function DefaultTermIndexer(){}
DefaultTermIndexer.prototype.index=function(a,c,b){var e,d,g=[];switch(typeOf(a)){case "null":case "boolean":case "number":g[0]={term:a,field:b||null,documentID:c};break;case "string":a=a.replace(/[^\w\d]/g," ").replace(/\s\s/g," ").toLowerCase().split(" ");e={};for(d=0;d<a.length;++d)e[a[d]]?(e[a[d]].termFrequency++,e[a[d]].termPositions.push(d)):e[a[d]]={term:a[d],termFrequency:1,termPositions:[d],field:b,totalFieldTokens:a.length,documentID:c};for(d in e)e[d]!==O[d]&&(g[g.length]=e[d]);break;case "object":for(d in a)a[d]!==
O[d]&&(g=g.concat(this.index(a[d],c,b?b+"."+d:d)));break;case "array":for(d=0;d<a.length;++d)g=g.concat(this.index(a[d],c,b?b+"."+d:String(d)))}return g};DefaultTermIndexer.prototype.toSource=function(){};exports.DefaultTermIndexer=DefaultTermIndexer;function MemoryIndex(){this._docs={};this._index={};this._indexKeys=[]}MemoryIndex.documentIDComparator=function(a,c){if(a.documentID<c.documentID)return-1;else if(a.documentID>c.documentID)return 1;return 0};
MemoryIndex.stringComparator=function(a,c){if(a<c)return-1;else if(a>c)return 1;return 0};MemoryIndex.prototype._docCount=0;MemoryIndex.prototype._termIndexer=new DefaultTermIndexer;MemoryIndex.prototype.generateID=function(){return String(Math.random())};
MemoryIndex.prototype.indexDocument=function(a,c,b){var e,d,a=this._termIndexer.index(a,c),c=0;for(e=a.length;c<e;++c)d=JSON.stringify([a[c].field,a[c].term]),this._index[d]?Array.orderedInsert(this._index[d],a[c],MemoryIndex.documentIDComparator):this._index[d]=[a[c]],Array.orderedInsert(this._indexKeys,d,MemoryIndex.stringComparator);b&&b(null)};
MemoryIndex.prototype.addDocument=function(a,c,b){c=typeof c==="undefined"||typeOf(c)==="null"?this.generateID():String(c);this._docs[c]=a;this._docCount++;this.indexDocument(a,c,b)};MemoryIndex.prototype.getDocument=function(a,c){c(null,this._docs[a])};MemoryIndex.prototype.setTermIndexer=function(a,c){var b=this._docs,e;this._termIndexer=a;this._index={};for(e in b)b.hasOwnProperty(e)&&this.indexDocument(b[e],e);c&&c(null)};
MemoryIndex.prototype.getTermVectors=function(a,c){var b=this._index[JSON.stringify([a,c])]||[];return(new ArrayStream(b)).start()};MemoryIndex.prototype.getTermRangeVectors=function(a,c,b,e,d){var c=JSON.stringify([a,c]),a=JSON.stringify([a,b]),b=this.indexOfKey(c),g=this._indexKeys.length,i=[];e&&this._indexKeys[b]===c&&++b;if(d)for(;b<g&&this._indexKeys[b]<a;)i=i.concat(this._index[this._indexKeys[b]]),++b;else for(;b<g&&this._indexKeys[b]<=a;)i=i.concat(this._index[this._indexKeys[b]]),++b;return(new ArrayStream(i)).start()};
MemoryIndex.prototype.indexOfKey=function(a){var c=this._indexKeys,b,e,d;if(c.length===0)return 0;b=0;e=c.length-1;for(d=Math.floor(e/2);b<e;){if(c[d]===a)return d;else c[d]<a?b=d+1:e=d-1;d=Math.round(b+(e-b)/2)}if(b===e)return c[b]<a?b+1:b;return e+1};exports.MemoryIndex=MemoryIndex;function BooleanClause(a,c){this.query=a;this.occur=c||Occur.SHOULD}var Occur={MUST:1,SHOULD:0,MUST_NOT:-1};exports.BooleanQuery=BooleanQuery;exports.Occur=Occur;
function BooleanQuery(a,c,b){this.clauses=a||[];this.minimumOptionalMatches=c||0;this.boost=b||1}BooleanQuery.prototype.minimumOptionalMatches=0;BooleanQuery.prototype.boost=1;BooleanQuery.prototype.score=function(a,c){return new BooleanScorer(this,a,c)};BooleanQuery.prototype.extractTerms=function(){var a,c,b=[];a=0;for(c=this.clauses.length;a<c;++a)b=b.concat(this.clauses[a].query.extractTerms());return b};
BooleanQuery.prototype.rewrite=function(){var a,c,b,e=!1;if(this.minimumOptionalMatches===0&&this.clauses.length===1&&this.clauses[0].occur!==Occur.MUST_NOT)a=this.clauses[0].query,a=a.rewrite(),a.boost*=this.boost;else{a=new BooleanQuery;a.boost=this.boost;c=0;for(b=this.clauses.length;c<b;++c)a.clauses[c]=new BooleanClause(this.clauses[c].query.rewrite(),this.clauses[c].occur),a.clauses[c].query!==this.clauses[c].query&&(e=!0);e||(a=this)}return a};
function BooleanScorer(a,c,b){Stream.call(this);this._query=a;this._similarity=c;this._index=b;this._inputs=[];this.addInputs(a.clauses)}BooleanScorer.prototype=Object.create(Stream.prototype);BooleanScorer.prototype._collectorCount=0;BooleanScorer.prototype._paused=!1;BooleanScorer.prototype.readable=!0;BooleanScorer.prototype.writable=!0;
BooleanScorer.prototype.addInputs=function(a){var c=this,b,e,d,g,i;b=0;for(e=a.length;b<e;++b)d=a[b],g=new SingleCollector,i=new BooleanClauseStream(d.query,d.occur,g),g.pipe(this,{end:!1}),d.query.score(this._similarity,this._index).pipe(g),this._inputs.push(i),this._collectorCount++,d=function(a){return function(){a.collector.removeListener("end",arguments.callee);a.collector.removeListener("close",arguments.callee);a.collector=null;c._collectorCount--;c._collectorCount===0||a.occur===Occur.MUST?
(c._collectorCount=0,c.end()):c._collectorCount>0&&c.write()}}(i),g.on("end",d),g.on("close",d)};
BooleanScorer.prototype.write=function(){var a,c,b=[],e=0,d=!1,g=0,i;if(this._paused)return!0;a=0;for(c=this._inputs.length;a<c;++a){if(this._inputs[a].collector){if(b[a]=this._inputs[a].collector.data,typeof b[a]==="undefined")return!0}else b[a]=void 0;if(a>0&&(!b[e]||b[a]&&b[a].id<b[e].id))e=a}e=b[e].id;i=new DocumentTerms(e);a=0;for(c=this._inputs.length;a<c;++a)if(b[a]&&b[a].id===e)if(this._inputs[a].occur===Occur.MUST_NOT){d=!1;break}else this._inputs[a].occur===Occur.SHOULD&&g++,d=!0,i.terms=
i.terms.concat(b[a].terms),i.sumOfSquaredWeights+=b[a].sumOfSquaredWeights,i.score+=b[a].score;else if(this._inputs[a].occur===Occur.MUST){d=!1;break}d&&g>=this._query.minimumOptionalMatches&&(i.score*=this._query.boost,i.sumOfSquaredWeights*=this._query.boost*this._query.boost,this.emit("data",i));a=0;for(c=this._inputs.length;a<c;++a)b[a]&&b[a].id===e&&this._inputs[a].collector.drain();return!0};
BooleanScorer.prototype.end=function(){if(this._collectorCount)throw Error("BooleanScorer#end called while there are still collectors attached!");this.emit("end");this.destroy()};BooleanScorer.prototype.pause=function(){this._paused=!0};BooleanScorer.prototype.resume=function(){this._paused=!1;this.write()};BooleanScorer.prototype.destroy=function(){var a,c;a=0;for(c=this._inputs.length;a<c;++a)this._inputs[a].collector&&this._inputs[a].collector.destroy();Stream.prototype.destroy.call(this)};
function BooleanClauseStream(a,c,b){this.query=a;this.occur=c;this.collector=b}BooleanClauseStream.prototype=Object.create(BooleanClause.prototype);exports.BooleanQuery=BooleanQuery;var DefaultSimilarity=function(){};DefaultSimilarity.prototype.norm=function(a){return(a.documentBoost||1)*(a.fieldBoost||1)*(1/Math.sqrt(a.totalFieldTokens||1))};DefaultSimilarity.prototype.queryNorm=function(a){return 1/Math.sqrt(a.sumOfSquaredWeights)};
DefaultSimilarity.prototype.tf=function(a){return Math.sqrt(a.termFrequency||1)};DefaultSimilarity.prototype.sloppyFreq=function(a){return 1/(a+1)};DefaultSimilarity.prototype.idf=function(a){return Math.log((a.totalDocuments||1)/((a.documentFrequency||1)+1))+1};DefaultSimilarity.prototype.coord=function(a,c){return a/c};exports.DefaultSimilarity=DefaultSimilarity;function DocumentTerms(a,c){this.id=a;this.terms=c||[]}DocumentTerms.prototype.terms=[];DocumentTerms.prototype.sumOfSquaredWeights=0;
DocumentTerms.prototype.score=0;exports.DocumentTerms=DocumentTerms;function FilterQuery(a,c,b){this.query=a;this.filter=c;this.boost=b||1}FilterQuery.prototype.boost=1;FilterQuery.prototype.score=function(a,c){var b=new FilterScorer(this,a);this.query.score(a,c).pipe(b);return b};FilterQuery.prototype.extractTerms=function(){return this.query.extractTerms()};FilterQuery.prototype.rewrite=function(){var a;do a=this.query,this.query=this.query.rewrite();while(this.query!==a);return this};
function FilterScorer(a,c){Stream.call(this);this._query=a;this._similarity=c;this._maxOverlap=a.extractTerms().length}FilterScorer.prototype=Object.create(Stream.prototype);FilterScorer.prototype.readable=!0;FilterScorer.prototype.writable=!0;FilterScorer.prototype.write=function(a){this._query.filter(a)&&(a.score*=this._query.boost,a.sumOfSquaredWeights*=this._query.boost*this._query.boost,this.emit("data",a))};
FilterScorer.prototype.end=function(a){typeof a!=="undefined"&&this.write(a);this.emit("end");this.destroy()};exports.FilterQuery=FilterQuery;function NormalizedQuery(a,c){this.query=a;this.boost=c||1}NormalizedQuery.prototype.boost=1;NormalizedQuery.prototype.score=function(a,c){var b=new NormalizedScorer(this,a);this.query.score(a,c).pipe(b);return b};NormalizedQuery.prototype.extractTerms=function(){return this.query.extractTerms()};
NormalizedQuery.prototype.rewrite=function(){var a;do a=this.query,this.query=this.query.rewrite();while(this.query!==a);return this};function NormalizedScorer(a,c){Stream.call(this);this._query=a;this._similarity=c;this._maxOverlap=a.extractTerms().length}NormalizedScorer.prototype=Object.create(Stream.prototype);NormalizedScorer.prototype.readable=!0;NormalizedScorer.prototype.writable=!0;
NormalizedScorer.prototype.write=function(a){a.score*=this._query.boost*this._similarity.queryNorm(a)*this._similarity.coord(a.terms.length,this._maxOverlap);this.emit("data",a)};NormalizedScorer.prototype.end=function(a){typeof a!=="undefined"&&this.write(a);this.emit("end");this.destroy()};exports.NormalizedQuery=NormalizedQuery;function PhraseQuery(a,c,b,e){this.field=a||null;this.terms=c||[];this.slop=b||0;this.boost=e||1}PhraseQuery.prototype.field=null;PhraseQuery.prototype.slop=0;
PhraseQuery.prototype.boost=1;PhraseQuery.prototype.score=function(){};PhraseQuery.prototype.extractTerms=function(){var a,c,b=[];a=0;for(c=this.terms.length;a<c;++a)typeof this.terms[a]!=="undefined"&&b.push({term:this.terms[a],field:this.field});return b};PhraseQuery.prototype.rewrite=function(){if(this.terms.length===1&&typeof this.terms[0]!=="undefined")return new TermQuery(this.field,this.terms[0],this.boost);return this};exports.PhraseQuery=PhraseQuery;
function PrefixQuery(a,c,b){this.prefix=a;this.field=c||null;this.boost=b||1}PrefixQuery.prototype.field=null;PrefixQuery.prototype.boost=1;PrefixQuery.prototype.score=function(a,c){return this.rewrite().score(a,c)};PrefixQuery.prototype.extractTerms=function(){return[{term:this.prefix,field:this.field}]};PrefixQuery.prototype.rewrite=function(){var a=this.prefix.replace(/.$/,function(a){return String.fromCharCode(a.charCodeAt(0)+1)});return new TermRangeQuery(this.field,this.prefix,a,!1,!0,this.boost)};
exports.PrefixQuery=PrefixQuery;function QueryParser(){}QueryParser.parse=function(a,c){var b,e;b=QueryParser.impl.parse(a,void 0,c||null);do e=b,b=b.rewrite();while(b!==e);return b};
QueryParser.impl=function(){var a={parse:function(a,b,e){function d(a){var c=a.charCodeAt(0);if(c<=255)var a="x",b=2;else a="u",b=4;var a="\\"+a,f=c.toString(16).toUpperCase(),c=f;b-=f.length;for(f=0;f<b;f++)c="0"+c;return a+c}function g(a){return'"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/[\x80-\uFFFF]/g,d)+'"'}function i(a){f<r||(f>r&&(r=f,t=[]),t.push(a))}function p(){var b="WHITESPACE@"+f,h=l[b];if(h)return f=h.nextPos,h.result;h=k;k=!1;if(a.substr(f).match(/^[ \t\n\r\u3000]/)!==
null){var m=a.charAt(f);f++}else m=null,k&&i("[ \t\\n\\r\\u3000]");(k=h)&&m===null&&i("whitespace");l[b]={nextPos:f,result:m};return m}function n(){var a="SKIP@"+f,c=l[a];if(c)return f=c.nextPos,c.result;for(var c=[],b=p();b!==null;)c.push(b),b=p();l[a]={nextPos:f,result:c};return c}function j(){var b="Number@"+f,h=l[b];if(h)return f=h.nextPos,h.result;h=k;k=!1;var m=f;if(a.substr(f).match(/^[0-9]/)!==null){var e=a.charAt(f);f++}else e=null,k&&i("[0-9]");if(e!==null)for(var d=[];e!==null;)d.push(e),
a.substr(f).match(/^[0-9]/)!==null?(e=a.charAt(f),f++):(e=null,k&&i("[0-9]"));else d=null;if(d!==null){e=f;if(a.substr(f,1)==="."){var o=".";f+=1}else o=null,k&&i('"."');if(o!==null){if(a.substr(f).match(/^[0-9]/)!==null){var g=a.charAt(f);f++}else g=null,k&&i("[0-9]");if(g!==null)for(var j=[];g!==null;)j.push(g),a.substr(f).match(/^[0-9]/)!==null?(g=a.charAt(f),f++):(g=null,k&&i("[0-9]"));else j=null;j!==null?o=[o,j]:(o=null,f=e)}else o=null,f=e;e=o!==null?o:"";e!==null?d=[d,e]:(d=null,f=m)}else d=
null,f=m;m=d!==null?parseFloat(d[0].concat(d[1][0],d[1][1]).join("")):null;(k=h)&&m===null&&i("number");l[b]={nextPos:f,result:m};return m}function y(){var b="ESCAPED_CHAR@"+f,h=l[b];if(h)return f=h.nextPos,h.result;h=f;if(a.substr(f,1)==="\\"){var m="\\";f+=1}else m=null,k&&i('"\\\\"');if(m!==null){if(a.length>f){var e=a.charAt(f);f++}else e=null,k&&i("any character");e!==null?m=[m,e]:(m=null,f=h)}else m=null,f=h;l[b]={nextPos:f,result:m};return m}function u(){var b="TERM_START_CHAR@"+f,h=l[b];if(h)return f=
h.nextPos,h.result;a.substr(f).match(/^[^ \t\n\r\u3000+\-!():^[\]"{}~*?\\]/)!==null?(h=a.charAt(f),f++):(h=null,k&&i('[^ \t\\n\\r\\u3000+\\-!():^[\\]"{}~*?\\\\]'));l[b]={nextPos:f,result:h};return h}function v(){var b="TERM_CHAR@"+f,h=l[b];if(h)return f=h.nextPos,h.result;h=u();h===null&&(h=y(),h===null&&(a.substr(f,1)==="-"?(h="-",f+=1):(h=null,k&&i('"-"')),h===null&&(a.substr(f,1)==="+"?(h="+",f+=1):(h=null,k&&i('"+"')),h=h!==null?h:null)));l[b]={nextPos:f,result:h};return h}function w(){var a=
"Term@"+f,c=l[a];if(c)return f=c.nextPos,c.result;c=k;k=!1;var b=f,e=u();if(e!==null){for(var d=[],g=v();g!==null;)d.push(g),g=v();d!==null?e=[e,d]:(e=null,f=b)}else e=null,f=b;b=e!==null?[e[0]].concat(e[1]).join(""):null;(k=c)&&b===null&&i("term");l[a]={nextPos:f,result:b};return b}function x(){var b="Boost@"+f,h=l[b];if(h)return f=h.nextPos,h.result;h=k;k=!1;var e=f;if(a.substr(f,1)==="^"){var d="^";f+=1}else d=null,k&&i('"^"');if(d!==null){var g=j();g!==null?d=[d,g]:(d=null,f=e)}else d=null,f=
e;e=d!==null?d:"";e=e!==null?function(a){a&&(a=a[1]);return typeof a==="number"?a:1}(e):null;(k=h)&&e===null&&i("boost");l[b]={nextPos:f,result:e};return e}function z(){var b="TermQuery@"+f,e=l[b];if(e)return f=e.nextPos,e.result;var d=e=f,g=w();if(g!==null){if(a.substr(f,1)===":"){var q=":";f+=1}else q=null,k&&i('":"');q!==null?g=[g,q]:(g=null,f=d)}else g=null,f=d;d=g!==null?g:"";d!==null?(g=w(),g!==null?(q=x(),q!==null?d=[d,g,q]:(d=null,f=e)):(d=null,f=e)):(d=null,f=e);e=d!==null?new TermQuery(d[0]?
d[0][0]:E,d[1],d[2]):null;l[b]={nextPos:f,result:e};return e}function s(){var b="BooleanClause@"+f,e=l[b];if(e)return f=e.nextPos,e.result;e=f;if(a.substr(f,1)==="+"){var d="+";f+=1}else d=null,k&&i('"+"');d===null&&(a.substr(f,1)==="-"?(d="-",f+=1):(d=null,k&&i('"-"')),d=d!==null?d:null);d=d!==null?d:"";if(d!==null){var g=A();g===null&&(g=z(),g=g!==null?g:null);g!==null?d=[d,g]:(d=null,f=e)}else d=null,f=e;e=d!==null?function(a,c){a=a==="+"?Occur.MUST:a==="-"?Occur.MUST_NOT:Occur.SHOULD;return new BooleanClause(c,
a)}(d[0],d[1]):null;l[b]={nextPos:f,result:e};return e}function B(){var a="BooleanQuery@"+f,c=l[a];if(c)return f=c.nextPos,c.result;var c=f,b=s();if(b!==null){var e=[],d=f,g=n();if(g!==null){var i=s();i!==null?g=[g,i]:(g=null,f=d)}else g=null,f=d;for(;g!==null;)e.push(g),d=f,g=n(),g!==null?(i=s(),i!==null?g=[g,i]:(g=null,f=d)):(g=null,f=d);e!==null?b=[b,e]:(b=null,f=c)}else b=null,f=c;c=b!==null?function(a,c){var b=[a];if(c)for(var d=0,e=c.length;d<e;++d)b[b.length]=c[d][1];return new BooleanQuery(b)}(b[0],
b[1]):null;l[a]={nextPos:f,result:c};return c}function A(){var b="SubQuery@"+f,d=l[b];if(d)return f=d.nextPos,d.result;d=f;if(a.substr(f,1)==="("){var e="(";f+=1}else e=null,k&&i('"("');if(e!==null){var g=C();if(g!==null){if(a.substr(f,1)===")"){var j=")";f+=1}else j=null,k&&i('")"');if(j!==null){var o=x();o!==null?e=[e,g,j,o]:(e=null,f=d)}else e=null,f=d}else e=null,f=d}else e=null,f=d;d=e!==null?function(a,c){a.boost=c;return a}(e[1],e[3]):null;l[b]={nextPos:f,result:d};return d}function C(){var a=
"Query@"+f,c=l[a];if(c)return f=c.nextPos,c.result;var c=f,b=n();if(b!==null){var d=B();if(d!==null){var e=n();e!==null?b=[b,d,e]:(b=null,f=c)}else b=null,f=c}else b=null,f=c;c=b!==null?b[1]:null;l[a]={nextPos:f,result:c};return c}function G(){var b=function(a){a.sort();for(var c=null,b=[],d=0;d<a.length;d++)a[d]!==c&&(b.push(a[d]),c=a[d]);switch(b.length){case 0:return"end of input";case 1:return b[0];default:return b.slice(0,b.length-1).join(", ")+" or "+b[b.length-1]}}(t),d=Math.max(f,r),d=d<a.length?
g(a.charAt(d)):"end of input";return"Expected "+b+" but "+d+" found."}function H(){for(var b=1,d=1,e=!1,f=0;f<r;f++){var g=a.charAt(f);g==="\n"?(e||b++,d=1,e=!1):g==="\r"|g==="\u2028"||g==="\u2029"?(b++,d=1,e=!0):(d++,e=!1)}return{line:b,column:d}}var D={BooleanClause:s,BooleanQuery:B,Boost:x,ESCAPED_CHAR:y,Number:j,Query:C,SKIP:n,SubQuery:A,TERM_CHAR:v,TERM_START_CHAR:u,Term:w,TermQuery:z,WHITESPACE:p};if(b!==void 0){if(D[b]===void 0)throw Error("Invalid rule name: "+g(b)+".");}else b="Query";var f=
0,k=!0,r=0,t=[],l={},E=e||null,b=D[b]();if(b===null||f!==a.length)throw b=H(),new this.SyntaxError(G(),b.line,b.column);return b},toSource:function(){return typeof this._source==="string"?this._source:this.toString()},SyntaxError:function(a,b,e){this.name="SyntaxError";this.message=a;this.line=b;this.column=e}};a.SyntaxError.prototype=Error.prototype;return a}();function Searcher(a){this._index=a}Searcher.prototype.similarity=new DefaultSimilarity;
Searcher.prototype.search=function(a,c,b){c=new TopDocumentsCollector(c,b);(new NormalizedQuery(a)).score(this.similarity,this._index).pipe(c)};exports.Searcher=Searcher;function TermQuery(a,c,b){this.field=a||null;this.term=c;this.boost=b||1}TermQuery.prototype.field=null;TermQuery.prototype.boost=1;TermQuery.prototype.score=function(a,c){var b=new TermScorer(this,a);c.getTermVectors(this.field,this.term).pipe(b);return b};TermQuery.prototype.extractTerms=function(){return[{term:this.term,field:this.field}]};
TermQuery.prototype.rewrite=function(){return this};function TermScorer(a,c){Stream.call(this);this._boost=a.boost;this._similarity=c}TermScorer.prototype=Object.create(Stream.prototype);TermScorer.prototype.readable=!0;TermScorer.prototype.writable=!0;TermScorer.prototype.write=function(a){var c=this._similarity,b=new DocumentTerms(a.documentID,[a]),e=c.idf(a);b.sumOfSquaredWeights=e*this._boost*e*this._boost;b.score=c.tf(a)*e*e*this._boost*c.norm(a);this.emit("data",b)};
TermScorer.prototype.end=function(a){typeof a!=="undefined"&&this.write(a);this.emit("end");this.destroy()};exports.TermQuery=TermQuery;function TermRangeQuery(a,c,b,e,d,g){this.field=a||null;this.startTerm=c;this.endTerm=b;this.excludeStart=e||!1;this.excludeEnd=d||!1;this.boost=g||1}TermRangeQuery.prototype.field=null;TermRangeQuery.prototype.excludeStart=!1;TermRangeQuery.prototype.excludeEnd=!1;TermRangeQuery.prototype.boost=1;
TermRangeQuery.prototype.score=function(a,c){var b=new TermScorer(this,a);c.getTermRangeVectors(this.field,this.startTerm,this.endTerm,this.excludeStart,this.excludeEnd).pipe(b);return b};TermRangeQuery.prototype.extractTerms=function(){return[{term:this.startTerm,field:this.field}]};TermRangeQuery.prototype.rewrite=function(){return this};exports.TermRangeQuery=TermRangeQuery;function TopDocumentsCollector(a,c){Collector.call(this,c);this.max=a||1}
TopDocumentsCollector.compareScores=function(a,c){return c.score-a.score};TopDocumentsCollector.prototype=Object.create(Collector.prototype);TopDocumentsCollector.prototype.lowestScore=0;TopDocumentsCollector.prototype.write=function(a){if(this.collection.length<this.max||a.score>this.lowestScore)this.collection.length>=this.max&&this.collection.pop(),Array.orderedInsert(this.collection,a,TopDocumentsCollector.compareScores),this.lowestScore=this.collection[this.collection.length-1].score};
exports.TopDocumentsCollector=TopDocumentsCollector;
