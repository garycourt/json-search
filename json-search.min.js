var O={};function F(){}function typeOf(a){return a===void 0?"undefined":a===null?"null":Object.prototype.toString.call(a).split(" ").pop().split("]").shift().toLowerCase()}typeof exports==="undefined"&&(exports={});typeof require!=="function"&&(require=function(){return exports});if(typeof Object.create!=="function")Object.create=function(a){F.prototype=a;return new F};if(typeof Array.isArray!=="function")Array.isArray=function(a){return typeOf(a)==="array"};
if(typeof Array.add!=="function")Array.add=function(a,e){if(a.indexOf(e)===-1)return a[a.length]=e,!0;return!1};if(typeof Array.remove!=="function")Array.remove=function(a,e){var c=a.indexOf(e);if(c!==-1)return a.splice(c,1),!0;return!1};if(!Array.append)Array.append=function(a,e){e=e.slice(0);e.unshift(a.length,0);a.splice.apply(a,e);return a};
if(typeof Array.orderedInsert!=="function")Array.orderedInsert=function(a,e,c){var b,d,h;if(a.length===0)a[0]=e;else{b=0;d=a.length-1;for(h=Math.floor(d/2);b<d;)c(a[h],e)<=0?b=h+1:d=h-1,h=Math.round(b+(d-b)/2);b===d?c(a[b],e)<=0?a.splice(b+1,0,e):a.splice(b,0,e):a.splice(d+1,0,e)}};function Stream(){}Stream.prototype._streamInput=null;Stream.prototype._streamOutput=null;Stream.prototype._streamBuffer=null;Stream.prototype._streamPaused=!1;Stream.prototype._streamEnded=!1;
Stream.prototype._streamError=null;Stream.prototype._streamDraining=!1;
Stream.prototype._streamDrain=function(){var a,e,c;if(this._streamBuffer&&!this._streamPaused&&!this._streamDraining){this._streamDraining=!0;try{for(a=0;!this._streamPaused&&a<this._streamBuffer.length;++a)if(this._streamBuffer[a].length>1)if(this.onBulkWrite!==Stream.prototype.onBulkWrite)this.onBulkWrite(this._streamBuffer[a]);else{e=0;for(c=this._streamBuffer[a].length;!this._streamPaused&&e<c;++e)this.onWrite(this._streamBuffer[a][e]);if(e<c){this._streamBuffer[a]=this._streamBuffer[a].slice(e);
break}}else if(this._streamBuffer[a].length===1)this.onWrite(this._streamBuffer[a][0])}catch(b){this.error(b),a=this._streamBuffer.length}if(!this._streamPaused&&a>=this._streamBuffer.length){if(this._streamBuffer=null,this._streamEnded)try{if(this._streamError)this.onError(this._streamError);else this.onEnd()}catch(d){}}else this._streamBuffer=this._streamBuffer.slice(a);this._streamDraining=!1}};
Stream.prototype.pipe=function(a){if(this._streamOutput)throw Error("Stream already has an output");if(a._streamInput)throw Error("Output stream already has an input");this._streamOutput=a;a._streamInput=this;a._streamEnded=!1;a._streamError=null;a.onStart(this)};Stream.prototype.write=function(a){if(this._streamPaused){if(!this._streamBuffer)this._streamBuffer=[];this._streamBuffer[this._streamBuffer.length]=[a]}else this.onWrite(a)};Stream.prototype.emit=function(a){this._streamOutput&&this._streamOutput.write(a)};
Stream.prototype.bulkWrite=function(a){if(this._streamPaused){if(!this._streamBuffer)this._streamBuffer=[];this._streamBuffer[this._streamBuffer.length]=a}else this.onBulkWrite(a)};Stream.prototype.emitBulk=function(a){this._streamOutput&&this._streamOutput.bulkWrite(a)};Stream.prototype.isPaused=function(){return this._streamPaused};Stream.prototype.pause=function(){if(!this._streamPaused){this._streamPaused=!0;if(this.onPause)this.onPause();this._streamInput&&this._streamInput.pause()}};
Stream.prototype.resume=function(){var a=this;if(this._streamPaused){this._streamPaused=!1;if(this.onResume)this.onResume();this._streamBuffer&&setTimeout(function(){a._streamDrain()},0);this._streamInput&&this._streamInput.resume()}};Stream.prototype.end=function(){if(!this._streamEnded)if(this._streamEnded=!0,!this._streamPaused&&!this._streamBuffer)this.onEnd();else if(!this._streamBuffer)this._streamBuffer=[]};
Stream.prototype.emitEnd=function(){this._streamEnded=!0;if(this._streamOutput)this._streamOutput.end(),this._streamOutput=this._streamOutput._streamInput=null};Stream.prototype.error=function(a){if(!this._streamEnded)if(this._streamEnded=!0,this._streamError=a,!this._streamPaused&&!this._streamBuffer)this.onError(a);else if(!this._streamBuffer)this._streamBuffer=[]};
Stream.prototype.emitError=function(a){this._streamEnded=!0;this._streamError=a;if(this._streamOutput)this._streamOutput.error(a),this._streamOutput=this._streamOutput._streamInput=null};Stream.prototype.onStart=function(){};Stream.prototype.onWrite=Stream.prototype.emit;Stream.prototype.onBulkWrite=function(a){if(this.onWrite!==Stream.prototype.onWrite){if(!this._streamBuffer)this._streamBuffer=[];this._streamBuffer[this._streamBuffer.length]=a;this._streamDrain()}else this.emitBulk(a)};
Stream.prototype.onEnd=Stream.prototype.emitEnd;Stream.prototype.onError=Stream.prototype.emitError;exports.Stream=Stream;function Collector(a){Stream.call(this);this.collection=[];this.callback=a||null}Collector.prototype=Object.create(Stream.prototype);Collector.prototype.callback=null;Collector.prototype.onWrite=function(a){this.collection.push(a)};Collector.prototype.onBulkWrite=function(a){this.collection=this.collection.concat(a)};
Collector.prototype.onEnd=function(){if(this.callback)this.callback(null,this.collection),this.callback=null};Collector.prototype.onError=function(a){if(this.callback)this.callback(a),this.callback=null};exports.Collector=Collector;var ScapegoatTreeNode;function ScapegoatTree(a){this.a=a&&a>=0.5&&a<1?a:0.5;this.lna=Math.log(1/this.a);this.root=null;this.size=0}function Scapegoat_size(a){return a===null?0:Scapegoat_size(a[1])+Scapegoat_size(a[2])+1}
function Scapegoat_toArray(a){if(a===null)return[];return Scapegoat_toArray(a[1]).concat([a[0]],Scapegoat_toArray(a[2]))}function Scapegoat_toTree(a){var e;if(a.length===0)return null;if(a.length===1)return[a[0],null,null];e=Math.floor(a.length/2);return[a[e],Scapegoat_toTree(a.slice(0,e)),Scapegoat_toTree(a.slice(e+1))]}
ScapegoatTree.prototype.insert=function(a){var e,c,b,d,h;if(this.root!==null){this.size++;e=Math.log(this.size)/this.lna+1;c=[this.root];for(b=this.root;;){if(b[0]>a)if(b[1]!==null)b=b[1];else{b=b[1]=[a,null,null];break}else if(b[2]!==null)b=b[2];else{b=b[2]=[a,null,null];break}c[c.length]=b}if(c.length+1>e){a=b;for(d=1;c.length;)if(b=a,e=d,a=c.pop(),b=a[1]===b?Scapegoat_size(a[2]):Scapegoat_size(a[1]),d=e+b+1,h=d*this.a,e>h||b>h){b=Scapegoat_toTree(Scapegoat_toArray(a));c.length===0?this.root=b:
c[c.length-1][1]===a?c[c.length-1][1]=b:c[c.length-1][2]=b;break}}}else this.root=[a,null,null],this.size=1};ScapegoatTree.prototype.insertAll=function(a){var e,c;e=0;for(c=a.length;e<c;++e)this.insert(a[e])};
ScapegoatTree.prototype.range=function(a,e,c,b){for(var d=[],h=this.root,f=[];h!==null&&h[0]!==a;)h[0]>=a?(d[d.length]=h,h=h[1]):h=h[2];if(h!==null&&(!c||h[0]!==a))f[f.length]=h[0];for(;d.length;){h=d.pop();if(h[0]>=e){!b&&h[0]===e&&(f[f.length]=h[0]);break}f[f.length]=h[0];for(h=h[2];h!==null;)d[d.length]=h,h=h[1]}return f};ScapegoatTree.prototype.toArray=function(){return Scapegoat_toArray(this.root)};exports.ScapegoatTree=ScapegoatTree;
function SingleCollector(a){Stream.call(this);this.listener=a}SingleCollector.prototype=Object.create(Stream.prototype);SingleCollector.prototype.onWrite=function(a){if(typeof this.data!=="undefined")throw Error("Stream is full");this.data=a;this.listener&&this.listener(null,a);typeof this.data!=="undefined"&&this.pause()};SingleCollector.prototype.drain=function(){this.data=void 0;this.resume()};SingleCollector.prototype.onEnd=function(){if(this.listener)this.listener(!0),this.listener=null;this.emitEnd()};
SingleCollector.prototype.onError=function(a){if(this.listener)this.listener(a),this.listener=null;this.emitError(a)};exports.SingleCollector=SingleCollector;function BaseFilter(a,e,c){this.analyzer=a;this.filterer=e;this.mapper=c}
BaseFilter.prototype.parse=function(a,e){var c=this.analyzer.parse(a,e),b,d,h,f=0;if(this.filterer){h=[];b=0;for(d=c.length;b<d;++b)this.filterer(c[b])?(c[b].positionIncrement+=f,h[h.length]=c[b],f=0):f+=c[b].positionIncrement}else h=c;this.mapper&&(h=h.map(this.mapper));return h};exports.BaseFilter=BaseFilter;function CharTokenizer(a){this.regexp=a}
CharTokenizer.prototype.parse=function(a){var e,c,b=this.regexp,d="",h=0,f=[];if(typeof a==="string"){e=0;for(c=a.length;e<c;++e)b.test(a[e])?d+=a[e]:(d.length&&(f[f.length]={value:d,startOffset:h,endOffset:e,positionIncrement:1},d=""),h=e+1);d.length&&(f[f.length]={value:d,startOffset:h,endOffset:a.length,positionIncrement:1})}else f=[{value:a,positionIncrement:1}];return f};function WhitespaceTokenizer(){}WhitespaceTokenizer.prototype=Object.create(CharTokenizer.prototype);
WhitespaceTokenizer.prototype.regexp=/[^\u0009-\u000D\u001C-\u001F\u0020\u0085\u1680\u180E\u2000-\u2006\u2008-\u200A\u2028\u2029\u205F\u3000]/;function LetterTokenizer(){}LetterTokenizer.prototype=Object.create(CharTokenizer.prototype);LetterTokenizer.prototype.regexp=/[A-Za-z]/;exports.CharTokenizer=CharTokenizer;exports.WhitespaceTokenizer=WhitespaceTokenizer;exports.LetterTokenizer=LetterTokenizer;function IDTokenizer(){}
IDTokenizer.prototype.parse=function(a){return typeof a==="string"?[{value:a,startOffset:0,endOffset:a.length,positionIncrement:1}]:[{value:a,positionIncrement:1}]};exports.IDTokenizer=IDTokenizer;function LengthFilter(a,e,c){this.analyzer=a;this.min=e||0;this.max=c||Number.POSITIVE_INFINITY}
LengthFilter.prototype.parse=function(a,e){var c,b,d,h=this.analyzer.parse(a,e),f=this.min,i=this.max,k=[],o=0;c=0;for(b=h.length;c<b;++c)d=h[c].value,typeof d==="string"&&d.length>=f&&d.length<=i?(h[c].positionIncrement+=o,k[k.length]=h[c],o=0):o+=h[c].positionIncrement;return k};exports.LengthFilter=LengthFilter;function LowerCaseFilter(a){this.analyzer=a}
LowerCaseFilter.prototype.parse=function(a,e){var c,b,d=this.analyzer.parse(a,e);c=0;for(b=d.length;c<b;++c)if(typeof d[c].value==="string")d[c].value=d[c].value.toLowerCase();return d};exports.LowerCaseFilter=LowerCaseFilter;function StopFilter(a,e){this.analyzer=a;this.stopWords=typeOf(e)==="array"?StopFilter.toHash(e):e}StopFilter.toHash=function(a){var e,c,b={};e=0;for(c=a.length;e<c;++e)b[a[e]]=!0;return b};
StopFilter.prototype.parse=function(a,e){var c,b,d,h=this.analyzer.parse(a,e),f=this.stopWords,i=[],k=0;c=0;for(b=h.length;c<b;++c)d=h[c].value,typeof d!=="string"||f[d]!==!0?(h[c].positionIncrement+=k,i[i.length]=h[c],k=0):k+=h[c].positionIncrement;return i};exports.StopFilter=StopFilter;function PorterFilter(a){this.analyzer=a}
PorterFilter.prototype.parse=function(a,e){var c,b,d=this.analyzer.parse(a,e);c=0;for(b=d.length;c<b;++c)if(typeof d[c].value==="string")d[c].value=porterStem(d[c].value);return d};exports.PorterFilter=PorterFilter;
var porterStem=function(){var a={ational:"ate",tional:"tion",enci:"ence",anci:"ance",izer:"ize",bli:"ble",alli:"al",entli:"ent",eli:"e",ousli:"ous",ization:"ize",ation:"ate",ator:"ate",alism:"al",iveness:"ive",fulness:"ful",ousness:"ous",aliti:"al",iviti:"ive",biliti:"ble",logi:"log"},e={icate:"ic",ative:"",alize:"al",iciti:"ic",ical:"ic",ful:"",ness:""};return function(c){var b,d,h,f,i;if(c.length<3)return c;h=c.substr(0,1);h=="y"&&(c=h.toUpperCase()+c.substr(1));f=/^(.+?)(ss|i)es$/;d=/^(.+?)([^s])s$/;
f.test(c)?c=c.replace(f,"$1$2"):d.test(c)&&(c=c.replace(d,"$1$2"));f=/^(.+?)eed$/;d=/^(.+?)(ed|ing)$/;f.test(c)?(d=f.exec(c),f=/^([^aeiou][^aeiouy]*)?[aeiouy][aeiou]*[^aeiou][^aeiouy]*/,f.test(d[1])&&(f=/.$/,c=c.replace(f,""))):d.test(c)&&(d=d.exec(c),b=d[1],d=/^([^aeiou][^aeiouy]*)?[aeiouy]/,d.test(b)&&(c=b,d=/(at|bl|iz)$/,i=/([^aeiouylsz])\1$/,b=/^[^aeiou][^aeiouy]*[aeiouy][^aeiouwxy]$/,d.test(c)?c+="e":i.test(c)?(f=/.$/,c=c.replace(f,"")):b.test(c)&&(c+="e")));f=/^(.+?)y$/;f.test(c)&&(d=f.exec(c),
b=d[1],f=/^([^aeiou][^aeiouy]*)?[aeiouy]/,f.test(b)&&(c=b+"i"));f=/^(.+?)(ational|tional|enci|anci|izer|bli|alli|entli|eli|ousli|ization|ation|ator|alism|iveness|fulness|ousness|aliti|iviti|biliti|logi)$/;f.test(c)&&(d=f.exec(c),b=d[1],d=d[2],f=/^([^aeiou][^aeiouy]*)?[aeiouy][aeiou]*[^aeiou][^aeiouy]*/,f.test(b)&&(c=b+a[d]));f=/^(.+?)(icate|ative|alize|iciti|ical|ful|ness)$/;f.test(c)&&(d=f.exec(c),b=d[1],d=d[2],f=/^([^aeiou][^aeiouy]*)?[aeiouy][aeiou]*[^aeiou][^aeiouy]*/,f.test(b)&&(c=b+e[d]));f=
/^(.+?)(al|ance|ence|er|ic|able|ible|ant|ement|ment|ent|ou|ism|ate|iti|ous|ive|ize)$/;d=/^(.+?)(s|t)(ion)$/;f.test(c)?(d=f.exec(c),b=d[1],f=/^([^aeiou][^aeiouy]*)?[aeiouy][aeiou]*[^aeiou][^aeiouy]*[aeiouy][aeiou]*[^aeiou][^aeiouy]*/,f.test(b)&&(c=b)):d.test(c)&&(d=d.exec(c),b=d[1]+d[2],d=/^([^aeiou][^aeiouy]*)?[aeiouy][aeiou]*[^aeiou][^aeiouy]*[aeiouy][aeiou]*[^aeiou][^aeiouy]*/,d.test(b)&&(c=b));f=/^(.+?)e$/;if(f.test(c)&&(d=f.exec(c),b=d[1],f=/^([^aeiou][^aeiouy]*)?[aeiouy][aeiou]*[^aeiou][^aeiouy]*[aeiouy][aeiou]*[^aeiou][^aeiouy]*/,
d=/^([^aeiou][^aeiouy]*)?[aeiouy][aeiou]*[^aeiou][^aeiouy]*([aeiouy][aeiou]*)?$/,i=/^[^aeiou][^aeiouy]*[aeiouy][^aeiouwxy]$/,f.test(b)||d.test(b)&&!i.test(b)))c=b;f=/ll$/;d=/^([^aeiou][^aeiouy]*)?[aeiouy][aeiou]*[^aeiou][^aeiouy]*[aeiouy][aeiou]*[^aeiou][^aeiouy]*/;f.test(c)&&d.test(c)&&(f=/.$/,c=c.replace(f,""));h=="y"&&(c=h.toLowerCase()+c.substr(1));return c}}();
function StandardAnalyzer(){this.analyzer=new StopFilter(new LowerCaseFilter(new StandardTokenizer),StandardAnalyzer.ENGLISH_STOP_WORDS)}StandardAnalyzer.ENGLISH_STOP_WORDS=StopFilter.toHash(["a","an","and","are","as","at","be","but","by","for","if","in","into","is","it","no","not","of","on","or","such","that","the","their","then","there","these","they","this","to","was","will","with"]);StandardAnalyzer.prototype.parse=function(a,e){return this.analyzer.parse(a,e)};exports.StandardAnalyzer=StandardAnalyzer;
function StandardTokenizer(){}StandardTokenizer.LETTER=/[A-Za-z]/;StandardTokenizer.SKIP_LETTER=/['&@_]/;StandardTokenizer.DIGIT=/[0-9]/;StandardTokenizer.ALPHANUM=/[0-9A-Za-z]/;
StandardTokenizer.prototype.parse=function(a){var e,c,b,d=StandardTokenizerState.UNKNOWN,h=0,f="",i=!1,k=[];if(typeof a==="string"){e=0;for(c=a.length;e<=c;++e){b=a[e];if(b!==void 0)switch(d){case StandardTokenizerState.UNKNOWN:if(StandardTokenizer.LETTER.test(b))d=StandardTokenizerState.STRING,h=e,f=b;else if(StandardTokenizer.DIGIT.test(b))d=StandardTokenizerState.INT,h=e,f=b;break;case StandardTokenizerState.STRING:StandardTokenizer.ALPHANUM.test(b)?f+=b:StandardTokenizer.SKIP_LETTER.test(b)||
(i=!0);break;case StandardTokenizerState.INT:StandardTokenizer.DIGIT.test(b)?f+=b:b==="."?(d=StandardTokenizerState.FLOAT,f+=b):StandardTokenizer.LETTER.test(b)?(d=StandardTokenizerState.STRING,f+=b):(i=!0,f=parseInt(f,10));break;case StandardTokenizerState.FLOAT:StandardTokenizer.DIGIT.test(b)?f+=b:b==="."||StandardTokenizer.LETTER.test(b)?(d=StandardTokenizerState.STRING,f+=b):(i=!0,f=parseFloat(f))}else switch(d){case StandardTokenizerState.STRING:i=!0;break;case StandardTokenizerState.INT:case StandardTokenizerState.FLOAT:i=
!0,f=parseFloat(f)}if(i)k[k.length]={value:f,startOffset:h,endOffset:e,positionIncrement:1},d=StandardTokenizerState.UNKNOWN,i=!1,--e}}else k=[{value:a,positionIncrement:1}];return k};var StandardTokenizerState={UNKNOWN:0,STRING:1,INT:2,FLOAT:3};exports.StandardTokenizer=StandardTokenizer;function DefaultIndexer(a){this.analyzer=a||new StandardAnalyzer}DefaultIndexer.prototype.parse=function(a,e){return this.analyzer.parse(a,e)};
DefaultIndexer.prototype.index=function(a,e,c){var b,d,h,f=0,i=[];switch(typeOf(a)){case "null":case "boolean":case "number":i[0]={term:a,field:c||null,documentID:e};break;case "string":a=this.parse(a,c);b={};for(d=0;d<a.length;++d)h=a[d].value,f+=a[d].positionIncrement,b[h]?(b[h].termFrequency++,b[h].termPositions.push(f),b[h].termStartOffsets.push(a[d].startOffset),b[h].termEndOffsets.push(a[d].endOffset)):b[h]={term:h,termFrequency:1,termPositions:[f],termStartOffsets:[a[d].startOffset],termEndOffsets:[a[d].endOffset],
field:c,totalFieldTokens:a.length,documentID:e};for(d in b)b[d]!==O[d]&&(i[i.length]=b[d]);break;case "object":for(d in a)a[d]!==O[d]&&(i=i.concat(this.index(a[d],e,c?c+"."+d:d)));break;case "array":for(d=0;d<a.length;++d)i=i.concat(this.index(a[d],e,c?c+"."+d:String(d)))}return i};DefaultIndexer.prototype.toSource=function(){};exports.DefaultIndexer=DefaultIndexer;function MemoryIndex(a){this._docs={};this._index={};this._indexKeys=new ScapegoatTree;if(a)this._indexer=a}
MemoryIndex.documentIDComparator=function(a,e){if(a.documentID<e.documentID)return-1;else if(a.documentID>e.documentID)return 1;return 0};MemoryIndex.stringComparator=function(a,e){if(a<e)return-1;else if(a>e)return 1;return 0};MemoryIndex.prototype._docCount=0;MemoryIndex.prototype._indexer=new DefaultIndexer;MemoryIndex.prototype.generateID=function(){return String(Math.random())};
MemoryIndex.prototype.indexDocument=function(a,e,c){var b,d,a=this._indexer.index(a,e),e=0;for(b=a.length;e<b;++e)d=JSON.stringify([a[e].field,a[e].term]),this._index[d]?Array.orderedInsert(this._index[d],a[e],MemoryIndex.documentIDComparator):(this._index[d]=[a[e]],this._indexKeys.insert(d));c&&c(null)};MemoryIndex.prototype.addDocument=function(a,e,c){e=typeof e==="undefined"||typeOf(e)==="null"?this.generateID():String(e);this._docs[e]=a;this._docCount++;this.indexDocument(a,e,c)};
MemoryIndex.prototype.getDocument=function(a,e){e(null,this._docs[a])};MemoryIndex.prototype.setIndexer=function(a,e){var c=this._docs,b;this._indexer=a;this._index={};for(b in c)c.hasOwnProperty(b)&&this.indexDocument(c[b],b);e&&e(null)};MemoryIndex.prototype.getIndexer=function(a){a(null,this._indexer)};MemoryIndex.prototype.getTermVectors=function(a,e){var c=this._index[JSON.stringify([a,e])]||[],b=new Stream;b.pause();b.bulkWrite(c);b.end();b.resume();return b};
MemoryIndex.prototype.getTermRangeVectors=function(a,e,c,b,d){e=JSON.stringify([a,e]);a=JSON.stringify([a,c]);b=this._indexKeys.range(e,a,b,d);c=new Stream;c.pause();d=0;for(a=b.length;d<a;++d)c.bulkWrite(this._index[b[d]]);c.end();c.resume();return c};MemoryIndex.prototype.getTermRange=function(a,e,c,b,d,h){var e=JSON.stringify([a,e]),a=JSON.stringify([a,c]),f=this._indexKeys.range(e,a,b,d).map(function(a){return JSON.parse(a)[1]});setTimeout(function(){h(null,f)},0)};exports.MemoryIndex=MemoryIndex;
function BooleanClause(a,e){this.query=a;this.occur=e||Occur.SHOULD}var Occur={MUST:1,SHOULD:0,MUST_NOT:-1};exports.BooleanQuery=BooleanQuery;exports.Occur=Occur;function BooleanQuery(a,e,c){this.clauses=a||[];this.minimumOptionalMatches=e||0;this.boost=c||1}BooleanQuery.prototype.minimumOptionalMatches=0;BooleanQuery.prototype.boost=1;BooleanQuery.prototype.score=function(a,e){return new BooleanScorer(this,a,e)};
BooleanQuery.prototype.extractTerms=function(){var a,e,c=[];a=0;for(e=this.clauses.length;a<e;++a)c=c.concat(this.clauses[a].query.extractTerms());return c};
BooleanQuery.prototype.rewrite=function(){var a,e,c,b=!1;if(this.minimumOptionalMatches===0&&this.clauses.length===1&&this.clauses[0].occur!==Occur.MUST_NOT)a=this.clauses[0].query,a=a.rewrite(),a.boost*=this.boost;else{a=new BooleanQuery;a.boost=this.boost;e=0;for(c=this.clauses.length;e<c;++e)a.clauses[e]=new BooleanClause(this.clauses[e].query.rewrite(),this.clauses[e].occur),a.clauses[e].query!==this.clauses[e].query&&(b=!0);b||(a=this)}return a};
function BooleanScorer(a,e,c){Stream.call(this);this._query=a;this._similarity=e;this._index=c;this._inputs=[];this.addInputs(a.clauses)}BooleanScorer.prototype=Object.create(Stream.prototype);BooleanScorer.prototype._collectorCount=0;
BooleanScorer.prototype.addInputs=function(a){var e=this;a.forEach(function(a){var b=new SingleCollector(function(a){if(a)a===!0?(d.collector=null,e._collectorCount--,e._collectorCount===0||d.occur===Occur.MUST?(e._collectorCount=0,e.end()):e._collectorCount>0&&e.match()):e.error(a);else return e.match()}),d=new BooleanClauseStream(a.query,a.occur,b);a.query.score(e._similarity,e._index).pipe(b);e._inputs.push(d);e._collectorCount++})};
BooleanScorer.prototype.match=function(){var a,e,c=[],b=0,d=!1,h=0,f;if(!this.isPaused()){a=0;for(e=this._inputs.length;a<e;++a){if(this._inputs[a].collector){if(c[a]=this._inputs[a].collector.data,typeof c[a]==="undefined")return}else c[a]=void 0;if(a>0&&(!c[b]||c[a]&&c[a].id<c[b].id))b=a}b=c[b].id;f=new DocumentTerms(b);a=0;for(e=this._inputs.length;a<e;++a)if(c[a]&&c[a].id===b)if(this._inputs[a].occur===Occur.MUST_NOT){d=!1;break}else this._inputs[a].occur===Occur.SHOULD&&h++,d=!0,f.terms=f.terms.concat(c[a].terms),
f.sumOfSquaredWeights+=c[a].sumOfSquaredWeights,f.score+=c[a].score;else if(this._inputs[a].occur===Occur.MUST){d=!1;break}d&&h>=this._query.minimumOptionalMatches&&(f.score*=this._query.boost,f.sumOfSquaredWeights*=this._query.boost*this._query.boost,this.emit(f));a=0;for(e=this._inputs.length;a<e;++a)c[a]&&c[a].id===b&&this._inputs[a].collector.drain()}};BooleanScorer.prototype.onResume=function(){var a=this;setTimeout(function(){a.match()},0)};
BooleanScorer.prototype.onEnd=function(){if(this._collectorCount)throw Error("BooleanScorer#end called while there are still collectors attached!");this.emitEnd();this._cleanup()};BooleanScorer.prototype.onError=function(a){this.emitError(a);this._cleanup()};BooleanScorer.prototype._cleanup=function(){var a,e;a=0;for(e=this._inputs.length;a<e;++a)this._inputs[a].collector&&this._inputs[a].collector.end();this._inputs=[]};
function BooleanClauseStream(a,e,c){this.query=a;this.occur=e;this.collector=c}BooleanClauseStream.prototype=Object.create(BooleanClause.prototype);exports.BooleanQuery=BooleanQuery;var DefaultSimilarity=function(){};DefaultSimilarity.prototype.norm=function(a){return(a.documentBoost||1)*(a.fieldBoost||1)*(1/Math.sqrt(a.totalFieldTokens||1))};DefaultSimilarity.prototype.queryNorm=function(a){return 1/Math.sqrt(a.sumOfSquaredWeights)};
DefaultSimilarity.prototype.tf=function(a){return Math.sqrt(a.termFrequency||1)};DefaultSimilarity.prototype.sloppyFreq=function(a){return 1/(a+1)};DefaultSimilarity.prototype.idf=function(a){return Math.log((a.totalDocuments||1)/((a.documentFrequency||1)+1))+1};DefaultSimilarity.prototype.coord=function(a,e){return a/e};exports.DefaultSimilarity=DefaultSimilarity;function DocumentTerms(a,e){this.id=a;this.terms=e||[]}
DocumentTerms.compare=function(a,e){if(a.id<e.id)return-1;else if(a.id>e.id)return 1;return 0};DocumentTerms.prototype.terms=[];DocumentTerms.prototype.sumOfSquaredWeights=0;DocumentTerms.prototype.score=0;exports.DocumentTerms=DocumentTerms;function FilterQuery(a,e,c){this.query=a;this.filter=e;this.boost=c||1}FilterQuery.prototype.boost=1;FilterQuery.prototype.score=function(a,e){var c=new FilterScorer(this,a);this.query.score(a,e).pipe(c);return c};FilterQuery.prototype.extractTerms=function(){return this.query.extractTerms()};
FilterQuery.prototype.rewrite=function(){var a;do a=this.query,this.query=this.query.rewrite();while(this.query!==a);return this};function FilterScorer(a,e){Stream.call(this);this._query=a;this._similarity=e;this._maxOverlap=a.extractTerms().length}FilterScorer.prototype=Object.create(Stream.prototype);FilterScorer.prototype.onWrite=function(a){var e=this._query.boost;this._query.filter(a)&&(a.score*=e,a.sumOfSquaredWeights*=e*e,this.emit(a))};
FilterScorer.prototype.onBulkWrite=function(a){var e,c,b=this._query.filter,d=this._query.boost,h=[];e=0;for(c=a.length;e<c;++e)b(a[e])&&(a[e].score*=d,a[e].sumOfSquaredWeights*=d*d,h[h.length]=a[e]);this.emitBulk(h)};exports.FilterQuery=FilterQuery;function MultiTermQuery(a,e,c,b){this.field=a;this.terms=e;this.all=c||!1;this.boost=b||1}MultiTermQuery.prototype.all=!1;MultiTermQuery.prototype.boost=1;MultiTermQuery.prototype.score=function(a,e){return this.rewrite().score(a,e)};
MultiTermQuery.prototype.extractTerms=function(){var a,e,c,b;a=this.terms;e=Array(a.length);c=0;for(b=a.length;c<b;++c)e[c]={term:a[c],field:this.field};return e};MultiTermQuery.prototype.rewrite=function(){var a,e,c,b,d;if(this.terms.length===1)return new TermQuery(this.field,this.terms[0],this.boost);a=new BooleanQuery;a.boost=this.boost;e=this.terms;c=this.all?Occur.MUST:Occur.SHOULD;b=0;for(d=e.length;b<d;++b)a.clauses.push(new BooleanClause(new TermQuery(this.field,e[b]),c));return a};
exports.MultiTermQuery=MultiTermQuery;function NormalizedQuery(a,e){this.query=a;this.boost=e||1}NormalizedQuery.prototype.boost=1;NormalizedQuery.prototype.score=function(a,e){var c=new NormalizedScorer(this,a);this.query.score(a,e).pipe(c);return c};NormalizedQuery.prototype.extractTerms=function(){return this.query.extractTerms()};NormalizedQuery.prototype.rewrite=function(){var a;do a=this.query,this.query=this.query.rewrite();while(this.query!==a);return this};
function NormalizedScorer(a,e){Stream.call(this);this._query=a;this._similarity=e}NormalizedScorer.prototype=Object.create(Stream.prototype);NormalizedScorer.prototype.onWrite=function(a){if(!this._maxOverlap)this._maxOverlap=this._query.extractTerms().length;a.score*=this._query.boost*this._similarity.queryNorm(a)*this._similarity.coord(a.terms.length,this._maxOverlap);this.emit(a)};
NormalizedScorer.prototype.onBulkWrite=function(a){var e,c,b;if(!this._maxOverlap)this._maxOverlap=this._query.extractTerms().length;e=0;for(c=a.length;e<c;++e)b=a[e],b.score*=this._query.boost*this._similarity.queryNorm(b)*this._similarity.coord(b.terms.length,this._maxOverlap);this.emitBulk(a)};function PhraseQuery(a,e,c,b){this.field=a||null;this.terms=e||[];this.slop=c||0;this.boost=b||1}
PhraseQuery.createFromTokens=function(a,e,c,b){var d,h,f,i=[],e=e||[];d=0;h=e.length;for(f=-1;d<h;++d)f+=e[d].positionIncrement,i[f]=e[d].value;return new PhraseQuery(a,i,c,b)};PhraseQuery.prototype.field=null;PhraseQuery.prototype.slop=0;PhraseQuery.prototype.boost=1;
PhraseQuery.prototype.score=function(a,e){var c=new PhraseFilter(this),b,d,h=[];b=0;for(d=this.terms.length;b<d;++b)typeof this.terms[b]!=="undefined"&&(h[h.length]=this.terms[b]);(new MultiTermQuery(this.field,h,!0,this.boost)).score(a,e).pipe(c);return c};PhraseQuery.prototype.extractTerms=function(){var a,e,c=[];a=0;for(e=this.terms.length;a<e;++a)typeof this.terms[a]!=="undefined"&&c.push({term:this.terms[a],field:this.field});return c};
PhraseQuery.prototype.rewrite=function(){if(this.terms.length===1&&typeof this.terms[0]!=="undefined")return new TermQuery(this.field,this.terms[0],this.boost);return this};function PhraseFilter(a){Stream.call(this);this._query=a}PhraseFilter.prototype=Object.create(Stream.prototype);
PhraseFilter.prototype.onWrite=function(a){var e,c,b,d,h,f,i=this._query.terms,k=this._query.slop;b=a.terms;var o={},q,t,s,r;e=0;for(c=b.length;e<c;++e)if(!(o[b[e].term]=b[e].termPositions))return;q=o[i[0]];e=0;for(c=q.length;e<c;++e){b=1;for(d=i.length;b<d;++b)if(typeof i[b]!=="undefined"){t=q[e]+b-k;s=q[e]+b+k;r=o[i[b]];h=0;for(f=r.length;h<f;++h)if(r[h]>=t&&r[h]<=s)break;if(h>=f)break}if(b>=d){this.emit(a);break}}};exports.PhraseQuery=PhraseQuery;
function PrefixQuery(a,e,c){this.field=a||null;this.prefix=e;this.boost=c||1}PrefixQuery.prototype.field=null;PrefixQuery.prototype.boost=1;PrefixQuery.prototype.score=function(a,e){return this.rewrite().score(a,e)};PrefixQuery.prototype.extractTerms=function(){return[{term:this.prefix,field:this.field}]};PrefixQuery.prototype.rewrite=function(){var a=this.prefix.replace(/.$/,function(a){return String.fromCharCode(a.charCodeAt(0)+1)});return new TermRangeQuery(this.field,this.prefix,a,!1,!0,this.boost)};
exports.PrefixQuery=PrefixQuery;function Searcher(a){this._index=a}Searcher.prototype.similarity=new DefaultSimilarity;Searcher.prototype.search=function(a,e,c){e=new TopDocumentsCollector(e,c);(new NormalizedQuery(a)).score(this.similarity,this._index).pipe(e)};exports.Searcher=Searcher;function TermQuery(a,e,c){this.field=a||null;this.term=e;this.boost=c||1}TermQuery.prototype.field=null;TermQuery.prototype.boost=1;
TermQuery.prototype.score=function(a,e){var c=new TermScorer(this,a);e.getTermVectors(this.field,this.term).pipe(c);return c};TermQuery.prototype.extractTerms=function(){return[{term:this.term,field:this.field}]};TermQuery.prototype.rewrite=function(){return this};function TermScorer(a,e){Stream.call(this);this._boost=a.boost;this._similarity=e}TermScorer.prototype=Object.create(Stream.prototype);
TermScorer.prototype.onWrite=function(a){var e=this._similarity,c=new DocumentTerms(a.documentID,[a]),b=e.idf(a);c.sumOfSquaredWeights=b*this._boost*b*this._boost;c.score=e.tf(a)*b*b*this._boost*e.norm(a);this.emit(c)};TermScorer.prototype.onBulkWrite=function(a){var e,c,b=this._similarity,d,h,f,i=Array(a.length);e=0;for(c=a.length;e<c;++e)d=a[e],h=new DocumentTerms(d.documentID,[d]),f=b.idf(d),h.sumOfSquaredWeights=f*this._boost*f*this._boost,h.score=b.tf(d)*f*f*this._boost*b.norm(d),i[e]=h;this.emitBulk(i)};
exports.TermQuery=TermQuery;function TermRangeQuery(a,e,c,b,d,h){this.field=a||null;this.startTerm=e;this.endTerm=c;this.excludeStart=b||!1;this.excludeEnd=d||!1;this.boost=h||1}TermRangeQuery.prototype.field=null;TermRangeQuery.prototype.excludeStart=!1;TermRangeQuery.prototype.excludeEnd=!1;TermRangeQuery.prototype.boost=1;TermRangeQuery.prototype._terms=null;
TermRangeQuery.prototype.score=function(a,e){var c=this,b=new Stream;e.getTermRange(this.field,this.startTerm,this.endTerm,this.excludeStart,this.excludeEnd,function(d,h){if(d)b.error(d);else try{c._terms=h,(new MultiTermQuery(c.field,h,!1,c.boost)).score(a,e).pipe(b)}catch(f){b.error(f)}});return b};
TermRangeQuery.prototype.extractTerms=function(){var a,e,c,b;if(this._terms){a=this._terms;e=Array(a.length);c=0;for(b=a.length;c<b;++c)e[c]={term:a[c],field:this.field};return e}else return[{term:this.startTerm,field:this.field}]};TermRangeQuery.prototype.rewrite=function(){return this};exports.TermRangeQuery=TermRangeQuery;function TopDocumentsCollector(a,e){Collector.call(this,e);this.max=a||1}TopDocumentsCollector.compareScores=function(a,e){return e.score-a.score};
TopDocumentsCollector.prototype=Object.create(Collector.prototype);TopDocumentsCollector.prototype.lowestScore=0;TopDocumentsCollector.prototype.onWrite=function(a){if(this.collection.length<this.max||a.score>this.lowestScore)this.collection.length>=this.max&&this.collection.pop(),Array.orderedInsert(this.collection,a,TopDocumentsCollector.compareScores),this.lowestScore=this.collection[this.collection.length-1].score};
TopDocumentsCollector.prototype.onBulkWrite=function(a){var e,c;e=0;for(c=a.length;e<c;++e)if(this.collection.length<this.max||a[e].score>this.lowestScore)this.collection.length>=this.max&&this.collection.pop(),Array.orderedInsert(this.collection,a[e],TopDocumentsCollector.compareScores),this.lowestScore=this.collection[this.collection.length-1].score};exports.TopDocumentsCollector=TopDocumentsCollector;function QueryParser(){}QueryParser.defaultAnalyzer=new StandardAnalyzer;
QueryParser.parse=function(a,e,c){a=QueryParser.impl.parse(a,void 0,e||null,c||QueryParser.defaultAnalyzer);do e=a,a=a.rewrite();while(a!==e);return a};
QueryParser.impl=function(){var a={parse:function(a,c,b,d){function h(a){var e=a.charCodeAt(0);if(e<=255)var a="x",c=2;else a="u",c=4;var a="\\"+a,b=e.toString(16).toUpperCase(),e=b;c-=b.length;for(b=0;b<c;b++)e="0"+e;return a+e}function f(a){return'"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/[\x80-\uFFFF]/g,h)+'"'}function i(a){g<u||(g>u&&(u=g,x=[]),x.push(a))}function k(){var c="WHITESPACE@"+g,b=l[c];if(b)return g=b.nextPos,b.result;b=j;j=!1;
if(a.substr(g).match(/^[ \t\n\r\u3000]/)!==null){var d=a.charAt(g);g++}else d=null,j&&i("[ \t\\n\\r\\u3000]");(j=b)&&d===null&&i("whitespace");l[c]={nextPos:g,result:d};return d}function o(){var a="SKIP@"+g,e=l[a];if(e)return g=e.nextPos,e.result;for(var e=[],c=k();c!==null;)e.push(c),c=k();l[a]={nextPos:g,result:e};return e}function q(){var c="Number@"+g,b=l[c];if(b)return g=b.nextPos,b.result;b=j;j=!1;var d=g;if(a.substr(g).match(/^[0-9]/)!==null){var f=a.charAt(g);g++}else f=null,j&&i("[0-9]");
if(f!==null)for(var h=[];f!==null;)h.push(f),a.substr(g).match(/^[0-9]/)!==null?(f=a.charAt(g),g++):(f=null,j&&i("[0-9]"));else h=null;if(h!==null){f=g;if(a.substr(g,1)==="."){var n=".";g+=1}else n=null,j&&i('"."');if(n!==null){if(a.substr(g).match(/^[0-9]/)!==null){var m=a.charAt(g);g++}else m=null,j&&i("[0-9]");if(m!==null)for(var k=[];m!==null;)k.push(m),a.substr(g).match(/^[0-9]/)!==null?(m=a.charAt(g),g++):(m=null,j&&i("[0-9]"));else k=null;k!==null?n=[n,k]:(n=null,g=f)}else n=null,g=f;f=n!==
null?n:"";f!==null?h=[h,f]:(h=null,g=d)}else h=null,g=d;d=h!==null?parseFloat(h[0].concat(h[1][0],h[1][1]).join("")):null;(j=b)&&d===null&&i("number");l[c]={nextPos:g,result:d};return d}function t(){var c="ESCAPED_CHAR@"+g,b=l[c];if(b)return g=b.nextPos,b.result;b=g;if(a.substr(g,1)==="\\"){var d="\\";g+=1}else d=null,j&&i('"\\\\"');if(d!==null){if(a.length>g){var f=a.charAt(g);g++}else f=null,j&&i("any character");f!==null?d=[d,f]:(d=null,g=b)}else d=null,g=b;l[c]={nextPos:g,result:d};return d}function s(){var c=
"TERM_START_CHAR@"+g,b=l[c];if(b)return g=b.nextPos,b.result;a.substr(g).match(/^[^ \t\n\r\u3000+\-!():^[\]"{}~*?\\]/)!==null?(b=a.charAt(g),g++):(b=null,j&&i('[^ \t\\n\\r\\u3000+\\-!():^[\\]"{}~*?\\\\]'));l[c]={nextPos:g,result:b};return b}function r(){var c="TERM_CHAR@"+g,b=l[c];if(b)return g=b.nextPos,b.result;b=s();b===null&&(b=t(),b===null&&(a.substr(g,1)==="-"?(b="-",g+=1):(b=null,j&&i('"-"')),b===null&&(a.substr(g,1)==="+"?(b="+",g+=1):(b=null,j&&i('"+"')),b=b!==null?b:null)));l[c]={nextPos:g,
result:b};return b}function v(){var a="Term@"+g,e=l[a];if(e)return g=e.nextPos,e.result;e=j;j=!1;var c=g,b=s();if(b!==null){for(var d=[],f=r();f!==null;)d.push(f),f=r();d!==null?b=[b,d]:(b=null,g=c)}else b=null,g=c;c=b!==null?[b[0]].concat(b[1]).join(""):null;(j=e)&&c===null&&i("term");l[a]={nextPos:g,result:c};return c}function y(){var c="Boost@"+g,b=l[c];if(b)return g=b.nextPos,b.result;b=j;j=!1;var d=g;if(a.substr(g,1)==="^"){var f="^";g+=1}else f=null,j&&i('"^"');if(f!==null){var h=q();h!==null?
f=[f,h]:(f=null,g=d)}else f=null,g=d;d=f!==null?f:"";d=d!==null?function(a){a&&(a=a[1]);return typeof a==="number"?a:1}(d):null;(j=b)&&d===null&&i("boost");l[c]={nextPos:g,result:d};return d}function z(){var c="TermType@"+g,b=l[c];if(b)return g=b.nextPos,b.result;var b=g,d=v();if(d!==null){if(a.substr(g,1)==="*"){var f="*";g+=1}else f=null,j&&i('"*"');f=f!==null?f:"";f!==null?d=[d,f]:(d=null,g=b)}else d=null,g=b;b=d!==null?d[1]?{prefix:d[0]}:{term:d[0]}:null;l[c]={nextPos:g,result:b};return b}function A(){var c=
"Range@"+g,b=l[c];if(b)return g=b.nextPos,b.result;b=g;if(a.substr(g,1)==="["){var d="[";g+=1}else d=null,j&&i('"["');d===null&&(a.substr(g,1)==="{"?(d="{",g+=1):(d=null,j&&i('"{"')),d=d!==null?d:null);if(d!==null){var f=o();if(f!==null){var h=v();if(h!==null){var n=o();if(n!==null){if(a.substr(g,2)==="TO"){var m="TO";g+=2}else m=null,j&&i('"TO"');m===null&&(a.substr(g,1)==="-"?(m="-",g+=1):(m=null,j&&i('"-"')),m=m!==null?m:null);m=m!==null?m:"";if(m!==null){var k=o();if(k!==null){var B=v();if(B!==
null){var C=o();if(C!==null){if(a.substr(g,1)==="]"){var p="]";g+=1}else p=null,j&&i('"]"');p===null&&(a.substr(g,1)==="}"?(p="}",g+=1):(p=null,j&&i('"}"')),p=p!==null?p:null);p!==null?d=[d,f,h,n,m,k,B,C,p]:(d=null,g=b)}else d=null,g=b}else d=null,g=b}else d=null,g=b}else d=null,g=b}else d=null,g=b}else d=null,g=b}else d=null,g=b}else d=null,g=b;b=d!==null?{startTerm:d[2],endTerm:d[6],excludeStart:d[0]==="{",excludeEnd:d[8]==="}"}:null;l[c]={nextPos:g,result:b};return b}function D(){var c="Phrase@"+
g,b=l[c];if(b)return g=b.nextPos,b.result;b=g;if(a.substr(g,1)==='"'){var d='"';g+=1}else d=null,j&&i('"\\""');if(d!==null){var f=[];if(a.substr(g).match(/^[^"]/)!==null){var h=a.charAt(g);g++}else h=null,j&&i('[^"]');for(;h!==null;)f.push(h),a.substr(g).match(/^[^"]/)!==null?(h=a.charAt(g),g++):(h=null,j&&i('[^"]'));if(f!==null)if(a.substr(g,1)==='"'?(h='"',g+=1):(h=null,j&&i('"\\""')),h!==null){var n=g;if(a.substr(g,1)==="~"){var m="~";g+=1}else m=null,j&&i('"~"');if(m!==null){var k=q();k!==null?
m=[m,k]:(m=null,g=n)}else m=null,g=n;n=m!==null?m:"";n!==null?d=[d,f,h,n]:(d=null,g=b)}else d=null,g=b;else d=null,g=b}else d=null,g=b;b=d!==null?{phrase:d[1]&&d[1].length?d[1].join(""):[],slop:d[3]?d[3][1]:0}:null;l[c]={nextPos:g,result:b};return b}function E(){var b="TermQuery@"+g,c=l[b];if(c)return g=c.nextPos,c.result;var d=c=g,f=v();if(f!==null){if(a.substr(g,1)===":"){var h=":";g+=1}else h=null,j&&i('":"');h!==null?f=[f,h]:(f=null,g=d)}else f=null,g=d;d=f!==null?f:"";d!==null?(f=D(),f===null&&
(f=A(),f===null&&(f=z(),f=f!==null?f:null)),f!==null?(h=y(),h!==null?d=[d,f,h]:(d=null,g=c)):(d=null,g=c)):(d=null,g=c);c=d!==null?function(a,c,b){a=a?a[0]:L;if(c.phrase)return PhraseQuery.createFromTokens(a,G.parse(c.phrase,a),c.slop,b);else if(c.startTerm)return new TermRangeQuery(a,c.startTerm,c.endTerm,c.excludeStart,c.excludeEnd,b);else if(c.prefix)return new PrefixQuery(a,c.prefix,b);else if(c=G.parse(c.term,a),c.length===1)return new TermQuery(a,c[0].value,b);else if(c.length>1){for(var e=
[],d=0,g=c.length;d<g;++d)e[d]=c[d].value;return new MultiTermQuery(a,e,!1,b)}}(d[0],d[1],d[2]):null;l[b]={nextPos:g,result:c};return c}function w(){var c="BooleanClause@"+g,b=l[c];if(b)return g=b.nextPos,b.result;b=g;if(a.substr(g,1)==="+"){var d="+";g+=1}else d=null,j&&i('"+"');d===null&&(a.substr(g,1)==="-"?(d="-",g+=1):(d=null,j&&i('"-"')),d=d!==null?d:null);d=d!==null?d:"";if(d!==null){var f=H();f===null&&(f=E(),f=f!==null?f:null);f!==null?d=[d,f]:(d=null,g=b)}else d=null,g=b;b=d!==null?function(a,
c){a=a==="+"?Occur.MUST:a==="-"?Occur.MUST_NOT:Occur.SHOULD;return c&&new BooleanClause(c,a)}(d[0],d[1]):null;l[c]={nextPos:g,result:b};return b}function I(){var a="BooleanQuery@"+g,c=l[a];if(c)return g=c.nextPos,c.result;var c=g,b=w();if(b!==null){var e=[],d=g,f=k();if(f!==null)for(var h=[];f!==null;)h.push(f),f=k();else h=null;h!==null?(f=w(),f!==null?h=[h,f]:(h=null,g=d)):(h=null,g=d);for(;h!==null;){e.push(h);d=g;f=k();if(f!==null)for(h=[];f!==null;)h.push(f),f=k();else h=null;h!==null?(f=w(),
f!==null?h=[h,f]:(h=null,g=d)):(h=null,g=d)}e!==null?b=[b,e]:(b=null,g=c)}else b=null,g=c;c=b!==null?function(a,c){var b=a?[a]:[];if(c)for(var e=0,d=c.length;e<d;++e)c[e][1]&&(b[b.length]=c[e][1]);return new BooleanQuery(b)}(b[0],b[1]):null;l[a]={nextPos:g,result:c};return c}function H(){var c="SubQuery@"+g,b=l[c];if(b)return g=b.nextPos,b.result;b=g;if(a.substr(g,1)==="("){var d="(";g+=1}else d=null,j&&i('"("');if(d!==null){var f=J();if(f!==null){if(a.substr(g,1)===")"){var h=")";g+=1}else h=null,
j&&i('")"');if(h!==null){var k=y();k!==null?d=[d,f,h,k]:(d=null,g=b)}else d=null,g=b}else d=null,g=b}else d=null,g=b;b=d!==null?function(a,c){a.boost=c;return a}(d[1],d[3]):null;l[c]={nextPos:g,result:b};return b}function J(){var a="Query@"+g,c=l[a];if(c)return g=c.nextPos,c.result;var c=g,b=o();if(b!==null){var e=I();if(e!==null){var d=o();d!==null?b=[b,e,d]:(b=null,g=c)}else b=null,g=c}else b=null,g=c;c=b!==null?b[1]:null;l[a]={nextPos:g,result:c};return c}function M(){var c=function(a){a.sort();
for(var c=null,b=[],e=0;e<a.length;e++)a[e]!==c&&(b.push(a[e]),c=a[e]);switch(b.length){case 0:return"end of input";case 1:return b[0];default:return b.slice(0,b.length-1).join(", ")+" or "+b[b.length-1]}}(x),b=Math.max(g,u),b=b<a.length?f(a.charAt(b)):"end of input";return"Expected "+c+" but "+b+" found."}function N(){for(var b=1,c=1,d=!1,f=0;f<u;f++){var g=a.charAt(f);g==="\n"?(d||b++,c=1,d=!1):g==="\r"|g==="\u2028"||g==="\u2029"?(b++,c=1,d=!0):(c++,d=!1)}return{line:b,column:c}}var K={BooleanClause:w,
BooleanQuery:I,Boost:y,ESCAPED_CHAR:t,Number:q,Phrase:D,Query:J,Range:A,SKIP:o,SubQuery:H,TERM_CHAR:r,TERM_START_CHAR:s,Term:v,TermQuery:E,TermType:z,WHITESPACE:k};if(c!==void 0){if(K[c]===void 0)throw Error("Invalid rule name: "+f(c)+".");}else c="Query";var g=0,j=!0,u=0,x=[],l={},L=b||null,G=d,c=K[c]();if(c===null||g!==a.length)throw c=N(),new this.SyntaxError(M(),c.line,c.column);return c},toSource:function(){return typeof this._source==="string"?this._source:this.toString()},SyntaxError:function(a,
c,b){this.name="SyntaxError";this.message=a;this.line=c;this.column=b}};a.SyntaxError.prototype=Error.prototype;return a}();
