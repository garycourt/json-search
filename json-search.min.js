var O={};function F(){}function typeOf(a){return a===void 0?"undefined":a===null?"null":Object.prototype.toString.call(a).split(" ").pop().split("]").shift().toLowerCase()}typeof exports==="undefined"&&(exports={});typeof require!=="function"&&(require=function(){return exports});if(typeof Object.create!=="function")Object.create=function(a){F.prototype=a;return new F};if(typeof Array.isArray!=="function")Array.isArray=function(a){return typeOf(a)==="array"};
if(typeof Array.add!=="function")Array.add=function(a,d){if(a.indexOf(d)===-1)return a[a.length]=d,!0;return!1};if(typeof Array.remove!=="function")Array.remove=function(a,d){var c=a.indexOf(d);if(c!==-1)return a.splice(c,1),!0;return!1};if(!Array.append)Array.append=function(a,d){d=d.slice(0);d.unshift(a.length,0);a.splice.apply(a,d);return a};
if(typeof Array.orderedInsert!=="function")Array.orderedInsert=function(a,d,c){var b,e,g;if(a.length===0)a[0]=d;else{b=0;e=a.length-1;for(g=Math.floor(e/2);b<e;)c(a[g],d)<=0?b=g+1:e=g-1,g=Math.round(b+(e-b)/2);b===e?c(a[b],d)<=0?a.splice(b+1,0,d):a.splice(b,0,d):a.splice(e+1,0,d)}};function Stream(){}Stream.prototype._streamInput=null;Stream.prototype._streamOutput=null;Stream.prototype._streamBuffer=null;Stream.prototype._streamPaused=!1;Stream.prototype._streamEnded=!1;
Stream.prototype._streamError=null;Stream.prototype._streamDraining=!1;
Stream.prototype._streamDrain=function(){var a,d,c;if(this._streamBuffer&&!this._streamPaused&&!this._streamDraining){this._streamDraining=!0;try{for(a=0;!this._streamPaused&&a<this._streamBuffer.length;++a)if(this._streamBuffer[a].length>1)if(this.onBulkWrite!==Stream.prototype.onBulkWrite)this.onBulkWrite(this._streamBuffer[a]);else{d=0;for(c=this._streamBuffer[a].length;!this._streamPaused&&d<c;++d)this.onWrite(this._streamBuffer[a][d]);if(d<c){this._streamBuffer[a]=this._streamBuffer[a].slice(d);
break}}else if(this._streamBuffer[a].length===1)this.onWrite(this._streamBuffer[a][0])}catch(b){this.error(b),a=this._streamBuffer.length}if(!this._streamPaused&&a>=this._streamBuffer.length){if(this._streamBuffer=null,this._streamEnded)try{if(this._streamError)this.onError(this._streamError);else this.onEnd()}catch(e){}}else this._streamBuffer=this._streamBuffer.slice(a);this._streamDraining=!1}};
Stream.prototype.pipe=function(a){if(this._streamOutput)throw Error("Stream already has an output");if(a._streamInput)throw Error("Output stream already has an input");this._streamOutput=a;a._streamInput=this;a._streamEnded=!1;a._streamError=null;a.onStart(this)};Stream.prototype.write=function(a){if(this._streamPaused){if(!this._streamBuffer)this._streamBuffer=[];this._streamBuffer[this._streamBuffer.length]=[a]}else this.onWrite(a)};Stream.prototype.emit=function(a){this._streamOutput&&this._streamOutput.write(a)};
Stream.prototype.bulkWrite=function(a){if(this._streamPaused){if(!this._streamBuffer)this._streamBuffer=[];this._streamBuffer[this._streamBuffer.length]=a}else this.onBulkWrite(a)};Stream.prototype.emitBulk=function(a){this._streamOutput&&this._streamOutput.bulkWrite(a)};Stream.prototype.isPaused=function(){return this._streamPaused};Stream.prototype.pause=function(){if(!this._streamPaused){this._streamPaused=!0;if(this.onPause)this.onPause();this._streamInput&&this._streamInput.pause()}};
Stream.prototype.resume=function(){var a=this;if(this._streamPaused){this._streamPaused=!1;if(this.onResume)this.onResume();this._streamBuffer&&setTimeout(function(){a._streamDrain()},0);this._streamInput&&this._streamInput.resume()}};Stream.prototype.end=function(){if(!this._streamEnded)if(this._streamEnded=!0,!this._streamPaused&&!this._streamBuffer)this.onEnd();else if(!this._streamBuffer)this._streamBuffer=[]};
Stream.prototype.emitEnd=function(){this._streamEnded=!0;if(this._streamOutput)this._streamOutput.end(),this._streamOutput=this._streamOutput._streamInput=null};Stream.prototype.error=function(a){if(!this._streamEnded)if(this._streamEnded=!0,this._streamError=a,!this._streamPaused&&!this._streamBuffer)this.onError(a);else if(!this._streamBuffer)this._streamBuffer=[]};
Stream.prototype.emitError=function(a){this._streamEnded=!0;this._streamError=a;if(this._streamOutput)this._streamOutput.error(a),this._streamOutput=this._streamOutput._streamInput=null};Stream.prototype.onStart=function(){};Stream.prototype.onWrite=Stream.prototype.emit;Stream.prototype.onBulkWrite=function(a){if(this.onWrite!==Stream.prototype.onWrite){if(!this._streamBuffer)this._streamBuffer=[];this._streamBuffer[this._streamBuffer.length]=a;this._streamDrain()}else this.emitBulk(a)};
Stream.prototype.onEnd=Stream.prototype.emitEnd;Stream.prototype.onError=Stream.prototype.emitError;exports.Stream=Stream;function Collector(a){Stream.call(this);this.collection=[];this.callback=a||null}Collector.prototype=Object.create(Stream.prototype);Collector.prototype.callback=null;Collector.prototype.onWrite=function(a){this.collection.push(a)};Collector.prototype.onBulkWrite=function(a){this.collection=this.collection.concat(a)};
Collector.prototype.onEnd=function(){if(this.callback)this.callback(null,this.collection),this.callback=null};Collector.prototype.onError=function(a){if(this.callback)this.callback(a),this.callback=null};exports.Collector=Collector;var ScapegoatTreeNode;function ScapegoatTree(a){this.a=a&&a>=0.5&&a<1?a:0.5;this.lna=Math.log(1/this.a);this.root=null;this.size=0}function Scapegoat_size(a){return a===null?0:Scapegoat_size(a[1])+Scapegoat_size(a[2])+1}
function Scapegoat_toArray(a){if(a===null)return[];return Scapegoat_toArray(a[1]).concat([a[0]],Scapegoat_toArray(a[2]))}function Scapegoat_toTree(a){var d;if(a.length===0)return null;if(a.length===1)return[a[0],null,null];d=Math.floor(a.length/2);return[a[d],Scapegoat_toTree(a.slice(0,d)),Scapegoat_toTree(a.slice(d+1))]}
ScapegoatTree.prototype.insert=function(a){var d,c,b,e,g;if(this.root!==null){this.size++;d=Math.log(this.size)/this.lna+1;c=[this.root];for(b=this.root;;){if(b[0]>a)if(b[1]!==null)b=b[1];else{b=b[1]=[a,null,null];break}else if(b[2]!==null)b=b[2];else{b=b[2]=[a,null,null];break}c[c.length]=b}if(c.length+1>d){a=b;for(e=1;c.length;)if(b=a,d=e,a=c.pop(),b=a[1]===b?Scapegoat_size(a[2]):Scapegoat_size(a[1]),e=d+b+1,g=e*this.a,d>g||b>g){b=Scapegoat_toTree(Scapegoat_toArray(a));c.length===0?this.root=b:
c[c.length-1][1]===a?c[c.length-1][1]=b:c[c.length-1][2]=b;break}}}else this.root=[a,null,null],this.size=1};ScapegoatTree.prototype.insertAll=function(a){var d,c;d=0;for(c=a.length;d<c;++d)this.insert(a[d])};
ScapegoatTree.prototype.range=function(a,d,c,b){for(var e=[],g=this.root,h=[];g!==null&&g[0]!==a;)g[0]>=a?(e[e.length]=g,g=g[1]):g=g[2];if(g!==null&&(!c||g[0]!==a))h[h.length]=g[0];for(;e.length;){g=e.pop();if(g[0]>=d){!b&&g[0]===d&&(h[h.length]=g[0]);break}h[h.length]=g[0];for(g=g[2];g!==null;)e[e.length]=g,g=g[1]}return h};ScapegoatTree.prototype.toArray=function(){return Scapegoat_toArray(this.root)};exports.ScapegoatTree=ScapegoatTree;
function SingleCollector(a){Stream.call(this);this.listener=a}SingleCollector.prototype=Object.create(Stream.prototype);SingleCollector.prototype.onWrite=function(a){if(typeof this.data!=="undefined")throw Error("Stream is full");this.data=a;this.listener&&this.listener(null,a);typeof this.data!=="undefined"&&this.pause()};SingleCollector.prototype.drain=function(){this.data=void 0;this.resume()};SingleCollector.prototype.onEnd=function(){if(this.listener)this.listener(!0),this.listener=null;this.emitEnd()};
SingleCollector.prototype.onError=function(a){if(this.listener)this.listener(a),this.listener=null;this.emitError(a)};exports.SingleCollector=SingleCollector;function BaseFilter(a,d,c){this.analyzer=a;this.filterer=d;this.mapper=c}
BaseFilter.prototype.tokenize=function(a){var a=this.analyzer.tokenize(a),d,c,b,e=0;if(this.filterer){b=[];d=0;for(c=a.length;d<c;++d)this.filterer(a[d])?(a[d].positionIncrement+=e,b[b.length]=a[d],e=0):e+=a[d].positionIncrement}else b=a;this.mapper&&(b=b.map(this.mapper));return b};exports.BaseFilter=BaseFilter;function CharTokenizer(a){this.regexp=a}
CharTokenizer.prototype.tokenize=function(a){var d,c,b=this.regexp,e="",g=0,h=[];d=0;for(c=a.length;d<c;++d)b.test(a[d])?e+=a[d]:(e.length&&(h[h.length]={type:"word",value:e,startOffset:g,endOffset:d,positionIncrement:1},e=""),g=d+1);e.length&&(h[h.length]={type:"word",value:e,startOffset:g,endOffset:a.length,positionIncrement:1});return h};function WhitespaceTokenizer(){}WhitespaceTokenizer.prototype=Object.create(CharTokenizer.prototype);WhitespaceTokenizer.prototype.regexp=/[^\u0009-\u000D\u001C-\u001F\u0020\u0085\u1680\u180E\u2000-\u2006\u2008-\u200A\u2028\u2029\u205F\u3000]/;
function LetterTokenizer(){}LetterTokenizer.prototype=Object.create(CharTokenizer.prototype);LetterTokenizer.prototype.regexp=/[A-Za-z]/;exports.CharTokenizer=CharTokenizer;exports.WhitespaceTokenizer=WhitespaceTokenizer;exports.LetterTokenizer=LetterTokenizer;function IDTokenizer(){}IDTokenizer.prototype.tokenize=function(a){return[{type:"word",value:a,startOffset:0,endOffset:a.length,positionIncrement:1}]};exports.IDTokenizer=IDTokenizer;
function LengthFilter(a,d,c){this.analyzer=a;this.min=d||0;this.max=c||Number.POSITIVE_INFINITY}LengthFilter.prototype.tokenize=function(a){var d,c,b=this.analyzer.tokenize(a),e=this.min,g=this.max,h=[],i=0,a=0;for(d=b.length;a<d;++a)c=b[a].value,typeof c==="string"&&c.length>=e&&c.length<=g?(b[a].positionIncrement+=i,h[h.length]=b[a],i=0):i+=b[a].positionIncrement;return h};exports.LengthFilter=LengthFilter;function LowerCaseFilter(a){this.analyzer=a}
LowerCaseFilter.prototype.tokenize=function(a){var d,c=this.analyzer.tokenize(a),a=0;for(d=c.length;a<d;++a)if(typeof c[a].value==="string")c[a].value=c[a].value.toLowerCase();return c};exports.LowerCaseFilter=LowerCaseFilter;function StopFilter(a,d){this.analyzer=a;this.stopWords=typeOf(d)==="array"?StopFilter.toHash(d):d}StopFilter.toHash=function(a){var d,c,b={};d=0;for(c=a.length;d<c;++d)b[a[d]]=!0;return b};
StopFilter.prototype.tokenize=function(a){var d,c,b=this.analyzer.tokenize(a),e=this.stopWords,g=[],h=0,a=0;for(d=b.length;a<d;++a)c=b[a].value,typeof c!=="string"||e[c]!==!0?(b[a].positionIncrement+=h,g[g.length]=b[a],h=0):h+=b[a].positionIncrement;return g};exports.StopFilter=StopFilter;function PorterFilter(a){this.analyzer=a}
PorterFilter.prototype.tokenize=function(a){var d,c=this.analyzer.tokenize(a),a=0;for(d=c.length;a<d;++a)if(typeof c[a].value==="string")c[a].value=porterStem(c[a].value);return c};exports.PorterFilter=PorterFilter;
var porterStem=function(){var a={ational:"ate",tional:"tion",enci:"ence",anci:"ance",izer:"ize",bli:"ble",alli:"al",entli:"ent",eli:"e",ousli:"ous",ization:"ize",ation:"ate",ator:"ate",alism:"al",iveness:"ive",fulness:"ful",ousness:"ous",aliti:"al",iviti:"ive",biliti:"ble",logi:"log"},d={icate:"ic",ative:"",alize:"al",iciti:"ic",ical:"ic",ful:"",ness:""};return function(c){var b,e,g,h,i;if(c.length<3)return c;g=c.substr(0,1);g=="y"&&(c=g.toUpperCase()+c.substr(1));h=/^(.+?)(ss|i)es$/;e=/^(.+?)([^s])s$/;
h.test(c)?c=c.replace(h,"$1$2"):e.test(c)&&(c=c.replace(e,"$1$2"));h=/^(.+?)eed$/;e=/^(.+?)(ed|ing)$/;h.test(c)?(e=h.exec(c),h=/^([^aeiou][^aeiouy]*)?[aeiouy][aeiou]*[^aeiou][^aeiouy]*/,h.test(e[1])&&(h=/.$/,c=c.replace(h,""))):e.test(c)&&(e=e.exec(c),b=e[1],e=/^([^aeiou][^aeiouy]*)?[aeiouy]/,e.test(b)&&(c=b,e=/(at|bl|iz)$/,i=/([^aeiouylsz])\1$/,b=/^[^aeiou][^aeiouy]*[aeiouy][^aeiouwxy]$/,e.test(c)?c+="e":i.test(c)?(h=/.$/,c=c.replace(h,"")):b.test(c)&&(c+="e")));h=/^(.+?)y$/;h.test(c)&&(e=h.exec(c),
b=e[1],h=/^([^aeiou][^aeiouy]*)?[aeiouy]/,h.test(b)&&(c=b+"i"));h=/^(.+?)(ational|tional|enci|anci|izer|bli|alli|entli|eli|ousli|ization|ation|ator|alism|iveness|fulness|ousness|aliti|iviti|biliti|logi)$/;h.test(c)&&(e=h.exec(c),b=e[1],e=e[2],h=/^([^aeiou][^aeiouy]*)?[aeiouy][aeiou]*[^aeiou][^aeiouy]*/,h.test(b)&&(c=b+a[e]));h=/^(.+?)(icate|ative|alize|iciti|ical|ful|ness)$/;h.test(c)&&(e=h.exec(c),b=e[1],e=e[2],h=/^([^aeiou][^aeiouy]*)?[aeiouy][aeiou]*[^aeiou][^aeiouy]*/,h.test(b)&&(c=b+d[e]));h=
/^(.+?)(al|ance|ence|er|ic|able|ible|ant|ement|ment|ent|ou|ism|ate|iti|ous|ive|ize)$/;e=/^(.+?)(s|t)(ion)$/;h.test(c)?(e=h.exec(c),b=e[1],h=/^([^aeiou][^aeiouy]*)?[aeiouy][aeiou]*[^aeiou][^aeiouy]*[aeiouy][aeiou]*[^aeiou][^aeiouy]*/,h.test(b)&&(c=b)):e.test(c)&&(e=e.exec(c),b=e[1]+e[2],e=/^([^aeiou][^aeiouy]*)?[aeiouy][aeiou]*[^aeiou][^aeiouy]*[aeiouy][aeiou]*[^aeiou][^aeiouy]*/,e.test(b)&&(c=b));h=/^(.+?)e$/;if(h.test(c)&&(e=h.exec(c),b=e[1],h=/^([^aeiou][^aeiouy]*)?[aeiouy][aeiou]*[^aeiou][^aeiouy]*[aeiouy][aeiou]*[^aeiou][^aeiouy]*/,
e=/^([^aeiou][^aeiouy]*)?[aeiouy][aeiou]*[^aeiou][^aeiouy]*([aeiouy][aeiou]*)?$/,i=/^[^aeiou][^aeiouy]*[aeiouy][^aeiouwxy]$/,h.test(b)||e.test(b)&&!i.test(b)))c=b;h=/ll$/;e=/^([^aeiou][^aeiouy]*)?[aeiouy][aeiou]*[^aeiou][^aeiouy]*[aeiouy][aeiou]*[^aeiou][^aeiouy]*/;h.test(c)&&e.test(c)&&(h=/.$/,c=c.replace(h,""));g=="y"&&(c=g.toLowerCase()+c.substr(1));return c}}();
function StandardAnalyzer(){this.analyzer=new StopFilter(new LowerCaseFilter(new StandardTokenizer),StandardAnalyzer.ENGLISH_STOP_WORDS)}StandardAnalyzer.ENGLISH_STOP_WORDS=StopFilter.toHash(["a","an","and","are","as","at","be","but","by","for","if","in","into","is","it","no","not","of","on","or","such","that","the","their","then","there","these","they","this","to","was","will","with"]);StandardAnalyzer.prototype.tokenize=function(a){return this.analyzer.tokenize(a)};exports.StandardAnalyzer=StandardAnalyzer;
function StandardTokenizer(){}StandardTokenizer.LETTER=/[A-Za-z]/;StandardTokenizer.SKIP_LETTER=/['&@_]/;StandardTokenizer.DIGIT=/[0-9]/;StandardTokenizer.ALPHANUM=/[0-9A-Za-z]/;
StandardTokenizer.prototype.tokenize=function(a){var d,c,b,e=StandardTokenizerState.UNKNOWN,g=0,h="",i=!1,p=[];d=0;for(c=a.length;d<=c;++d){b=a[d];if(b!==void 0)switch(e){case StandardTokenizerState.UNKNOWN:if(StandardTokenizer.LETTER.test(b))e=StandardTokenizerState.STRING,g=d,h=b;else if(StandardTokenizer.DIGIT.test(b))e=StandardTokenizerState.INT,g=d,h=b;break;case StandardTokenizerState.STRING:StandardTokenizer.ALPHANUM.test(b)?h+=b:StandardTokenizer.SKIP_LETTER.test(b)||(i="word");break;case StandardTokenizerState.INT:StandardTokenizer.DIGIT.test(b)?
h+=b:b==="."?(e=StandardTokenizerState.FLOAT,h+=b):StandardTokenizer.LETTER.test(b)?(e=StandardTokenizerState.STRING,h+=b):(i="number",h=parseInt(h,10));break;case StandardTokenizerState.FLOAT:StandardTokenizer.DIGIT.test(b)?h+=b:b==="."||StandardTokenizer.LETTER.test(b)?(e=StandardTokenizerState.STRING,h+=b):(i="number",h=parseFloat(h))}else switch(e){case StandardTokenizerState.STRING:i="word";break;case StandardTokenizerState.INT:case StandardTokenizerState.FLOAT:i="number",h=parseFloat(h)}if(i)p[p.length]=
{type:i,value:h,startOffset:g,endOffset:d,positionIncrement:1},e=StandardTokenizerState.UNKNOWN,i=!1,--d}return p};StandardTokenizerState={UNKNOWN:0,STRING:1,INT:2,FLOAT:3};function DefaultIndexer(){this.analyzer=new StandardAnalyzer}
DefaultIndexer.prototype.index=function(a,d,c){var b,e,g,h=0,i=[];switch(typeOf(a)){case "null":case "boolean":case "number":i[0]={term:a,field:c||null,documentID:d};break;case "string":a=this.analyzer.tokenize(a);b={};for(e=0;e<a.length;++e)g=a[e].value,h+=a[e].positionIncrement,b[g]?(b[g].termFrequency++,b[g].termPositions.push(h),b[g].termOffsets.push(a[e].startOffset)):b[g]={term:g,termFrequency:1,termPositions:[h],termOffsets:[a[e].startOffset],field:c,totalFieldTokens:a.length,documentID:d};
for(e in b)b[e]!==O[e]&&(i[i.length]=b[e]);break;case "object":for(e in a)a[e]!==O[e]&&(i=i.concat(this.index(a[e],d,c?c+"."+e:e)));break;case "array":for(e=0;e<a.length;++e)i=i.concat(this.index(a[e],d,c?c+"."+e:String(e)))}return i};DefaultIndexer.prototype.toSource=function(){};exports.DefaultIndexer=DefaultIndexer;function MemoryIndex(){this._docs={};this._index={};this._indexKeys=new ScapegoatTree}
MemoryIndex.documentIDComparator=function(a,d){if(a.documentID<d.documentID)return-1;else if(a.documentID>d.documentID)return 1;return 0};MemoryIndex.stringComparator=function(a,d){if(a<d)return-1;else if(a>d)return 1;return 0};MemoryIndex.prototype._docCount=0;MemoryIndex.prototype._indexer=new DefaultIndexer;MemoryIndex.prototype.generateID=function(){return String(Math.random())};
MemoryIndex.prototype.indexDocument=function(a,d,c){var b,e,a=this._indexer.index(a,d),d=0;for(b=a.length;d<b;++d)e=JSON.stringify([a[d].field,a[d].term]),this._index[e]?Array.orderedInsert(this._index[e],a[d],MemoryIndex.documentIDComparator):(this._index[e]=[a[d]],this._indexKeys.insert(e));c&&c(null)};MemoryIndex.prototype.addDocument=function(a,d,c){d=typeof d==="undefined"||typeOf(d)==="null"?this.generateID():String(d);this._docs[d]=a;this._docCount++;this.indexDocument(a,d,c)};
MemoryIndex.prototype.getDocument=function(a,d){d(null,this._docs[a])};MemoryIndex.prototype.setIndexer=function(a,d){var c=this._docs,b;this._indexer=a;this._index={};for(b in c)c.hasOwnProperty(b)&&this.indexDocument(c[b],b);d&&d(null)};MemoryIndex.prototype.getTermVectors=function(a,d){var c=this._index[JSON.stringify([a,d])]||[],b=new Stream;b.pause();b.bulkWrite(c);b.end();b.resume();return b};
MemoryIndex.prototype.getTermRangeVectors=function(a,d,c,b,e){d=JSON.stringify([a,d]);a=JSON.stringify([a,c]);b=this._indexKeys.range(d,a,b,e);stream=new Stream;stream.pause();e=0;for(a=b.length;e<a;++e)stream.bulkWrite(this._index[b[e]]);stream.end();stream.resume();return stream};MemoryIndex.prototype.getTermRange=function(a,d,c,b,e,g){var d=JSON.stringify([a,d]),a=JSON.stringify([a,c]),h=this._indexKeys.range(d,a,b,e).map(function(a){return JSON.parse(a)[1]});setTimeout(function(){g(null,h)},0)};
exports.MemoryIndex=MemoryIndex;function BooleanClause(a,d){this.query=a;this.occur=d||Occur.SHOULD}var Occur={MUST:1,SHOULD:0,MUST_NOT:-1};exports.BooleanQuery=BooleanQuery;exports.Occur=Occur;function BooleanQuery(a,d,c){this.clauses=a||[];this.minimumOptionalMatches=d||0;this.boost=c||1}BooleanQuery.prototype.minimumOptionalMatches=0;BooleanQuery.prototype.boost=1;BooleanQuery.prototype.score=function(a,d){return new BooleanScorer(this,a,d)};
BooleanQuery.prototype.extractTerms=function(){var a,d,c=[];a=0;for(d=this.clauses.length;a<d;++a)c=c.concat(this.clauses[a].query.extractTerms());return c};
BooleanQuery.prototype.rewrite=function(){var a,d,c,b=!1;if(this.minimumOptionalMatches===0&&this.clauses.length===1&&this.clauses[0].occur!==Occur.MUST_NOT)a=this.clauses[0].query,a=a.rewrite(),a.boost*=this.boost;else{a=new BooleanQuery;a.boost=this.boost;d=0;for(c=this.clauses.length;d<c;++d)a.clauses[d]=new BooleanClause(this.clauses[d].query.rewrite(),this.clauses[d].occur),a.clauses[d].query!==this.clauses[d].query&&(b=!0);b||(a=this)}return a};
function BooleanScorer(a,d,c){Stream.call(this);this._query=a;this._similarity=d;this._index=c;this._inputs=[];this.addInputs(a.clauses)}BooleanScorer.prototype=Object.create(Stream.prototype);BooleanScorer.prototype._collectorCount=0;
BooleanScorer.prototype.addInputs=function(a){var d=this;a.forEach(function(a){var b=new SingleCollector(function(a){if(a)a===!0?(e.collector=null,d._collectorCount--,d._collectorCount===0||e.occur===Occur.MUST?(d._collectorCount=0,d.end()):d._collectorCount>0&&d.match()):d.error(a);else return d.match()}),e=new BooleanClauseStream(a.query,a.occur,b);a.query.score(d._similarity,d._index).pipe(b);d._inputs.push(e);d._collectorCount++})};
BooleanScorer.prototype.match=function(){var a,d,c=[],b=0,e=!1,g=0,h;if(!this.isPaused()){a=0;for(d=this._inputs.length;a<d;++a){if(this._inputs[a].collector){if(c[a]=this._inputs[a].collector.data,typeof c[a]==="undefined")return}else c[a]=void 0;if(a>0&&(!c[b]||c[a]&&c[a].id<c[b].id))b=a}b=c[b].id;h=new DocumentTerms(b);a=0;for(d=this._inputs.length;a<d;++a)if(c[a]&&c[a].id===b)if(this._inputs[a].occur===Occur.MUST_NOT){e=!1;break}else this._inputs[a].occur===Occur.SHOULD&&g++,e=!0,h.terms=h.terms.concat(c[a].terms),
h.sumOfSquaredWeights+=c[a].sumOfSquaredWeights,h.score+=c[a].score;else if(this._inputs[a].occur===Occur.MUST){e=!1;break}e&&g>=this._query.minimumOptionalMatches&&(h.score*=this._query.boost,h.sumOfSquaredWeights*=this._query.boost*this._query.boost,this.emit(h));a=0;for(d=this._inputs.length;a<d;++a)c[a]&&c[a].id===b&&this._inputs[a].collector.drain()}};BooleanScorer.prototype.onResume=function(){var a=this;setTimeout(function(){a.match()},0)};
BooleanScorer.prototype.onEnd=function(){if(this._collectorCount)throw Error("BooleanScorer#end called while there are still collectors attached!");this.emitEnd();this._cleanup()};BooleanScorer.prototype.onError=function(a){this.emitError(a);this._cleanup()};BooleanScorer.prototype._cleanup=function(){var a,d;a=0;for(d=this._inputs.length;a<d;++a)this._inputs[a].collector&&this._inputs[a].collector.end();this._inputs=[]};
function BooleanClauseStream(a,d,c){this.query=a;this.occur=d;this.collector=c}BooleanClauseStream.prototype=Object.create(BooleanClause.prototype);exports.BooleanQuery=BooleanQuery;var DefaultSimilarity=function(){};DefaultSimilarity.prototype.norm=function(a){return(a.documentBoost||1)*(a.fieldBoost||1)*(1/Math.sqrt(a.totalFieldTokens||1))};DefaultSimilarity.prototype.queryNorm=function(a){return 1/Math.sqrt(a.sumOfSquaredWeights)};
DefaultSimilarity.prototype.tf=function(a){return Math.sqrt(a.termFrequency||1)};DefaultSimilarity.prototype.sloppyFreq=function(a){return 1/(a+1)};DefaultSimilarity.prototype.idf=function(a){return Math.log((a.totalDocuments||1)/((a.documentFrequency||1)+1))+1};DefaultSimilarity.prototype.coord=function(a,d){return a/d};exports.DefaultSimilarity=DefaultSimilarity;function DocumentTerms(a,d){this.id=a;this.terms=d||[]}
DocumentTerms.compare=function(a,d){if(a.id<d.id)return-1;else if(a.id>d.id)return 1;return 0};DocumentTerms.prototype.terms=[];DocumentTerms.prototype.sumOfSquaredWeights=0;DocumentTerms.prototype.score=0;exports.DocumentTerms=DocumentTerms;function FilterQuery(a,d,c){this.query=a;this.filter=d;this.boost=c||1}FilterQuery.prototype.boost=1;FilterQuery.prototype.score=function(a,d){var c=new FilterScorer(this,a);this.query.score(a,d).pipe(c);return c};FilterQuery.prototype.extractTerms=function(){return this.query.extractTerms()};
FilterQuery.prototype.rewrite=function(){var a;do a=this.query,this.query=this.query.rewrite();while(this.query!==a);return this};function FilterScorer(a,d){Stream.call(this);this._query=a;this._similarity=d;this._maxOverlap=a.extractTerms().length}FilterScorer.prototype=Object.create(Stream.prototype);FilterScorer.prototype.onWrite=function(a){var d=this._query.boost;this._query.filter(a)&&(a.score*=d,a.sumOfSquaredWeights*=d*d,this.emit(a))};
FilterScorer.prototype.onBulkWrite=function(a){var d,c;boost=this._query.boost;a=a.filter(this._query.filter);d=0;for(c=a.length;d<c;++d)filter(a[d])&&(a[d].score*=boost,a[d].sumOfSquaredWeights*=boost*boost);this.emitBulk(a)};exports.FilterQuery=FilterQuery;function MultiTermQuery(a,d,c,b){this.field=a;this.terms=d;this.all=c||!1;this.boost=b||1}MultiTermQuery.prototype.all=!1;MultiTermQuery.prototype.boost=1;MultiTermQuery.prototype.score=function(a,d){return this.rewrite().score(a,d)};
MultiTermQuery.prototype.extractTerms=function(){var a,d,c,b;a=this.terms;d=Array(a.length);c=0;for(b=a.length;c<b;++c)d[c]={term:a[c],field:this.field};return d};MultiTermQuery.prototype.rewrite=function(){var a,d,c,b,e;if(this.terms.length===1)return new TermQuery(this.field,this.terms[0],this.boost);a=new BooleanQuery;a.boost=this.boost;d=this.terms;c=this.all?Occur.MUST:Occur.SHOULD;b=0;for(e=d.length;b<e;++b)a.clauses.push(new BooleanClause(new TermQuery(this.field,d[b]),c));return a};
exports.MultiTermQuery=MultiTermQuery;function NormalizedQuery(a,d){this.query=a;this.boost=d||1}NormalizedQuery.prototype.boost=1;NormalizedQuery.prototype.score=function(a,d){var c=new NormalizedScorer(this,a);this.query.score(a,d).pipe(c);return c};NormalizedQuery.prototype.extractTerms=function(){return this.query.extractTerms()};NormalizedQuery.prototype.rewrite=function(){var a;do a=this.query,this.query=this.query.rewrite();while(this.query!==a);return this};
function NormalizedScorer(a,d){Stream.call(this);this._query=a;this._similarity=d}NormalizedScorer.prototype=Object.create(Stream.prototype);NormalizedScorer.prototype.onWrite=function(a){if(!this._maxOverlap)this._maxOverlap=this._query.extractTerms().length;a.score*=this._query.boost*this._similarity.queryNorm(a)*this._similarity.coord(a.terms.length,this._maxOverlap);this.emit(a)};
NormalizedScorer.prototype.onBulkWrite=function(a){var d,c,b;if(!this._maxOverlap)this._maxOverlap=this._query.extractTerms().length;d=0;for(c=a.length;d<c;++d)b=a[d],b.score*=this._query.boost*this._similarity.queryNorm(b)*this._similarity.coord(b.terms.length,this._maxOverlap);this.emitBulk(a)};exports.NormalizedQuery=NormalizedQuery;function PhraseQuery(a,d,c,b){this.field=a||null;this.terms=d||[];this.slop=c||0;this.boost=b||1}PhraseQuery.prototype.field=null;PhraseQuery.prototype.slop=0;
PhraseQuery.prototype.boost=1;PhraseQuery.prototype.score=function(a,d){var c=new PhraseFilter(this),b,e,g=[];b=0;for(e=this.terms.length;b<e;++b)typeof this.terms[b]!=="undefined"&&(g[g.length]=this.terms[b]);(new MultiTermQuery(this.field,g,!0,this.boost)).score(a,d).pipe(c);return c};PhraseQuery.prototype.extractTerms=function(){var a,d,c=[];a=0;for(d=this.terms.length;a<d;++a)typeof this.terms[a]!=="undefined"&&c.push({term:this.terms[a],field:this.field});return c};
PhraseQuery.prototype.rewrite=function(){if(this.terms.length===1&&typeof this.terms[0]!=="undefined")return new TermQuery(this.field,this.terms[0],this.boost);return this};function PhraseFilter(a){Stream.call(this);this._query=a}PhraseFilter.prototype=Object.create(Stream.prototype);
PhraseFilter.prototype.onWrite=function(a){var d,c,b,e,g,h,i=this._query.terms,p=this._query.slop;b=a.terms;var u={},v,w,y,q;d=0;for(c=b.length;d<c;++d)if(!(u[b[d].term]=b[d].termPositions))return;v=u[i[0]];d=0;for(c=v.length;d<c;++d){b=1;for(e=i.length;b<e;++b)if(typeof i[b]!=="undefined"){w=v[d]+b-p;y=v[d]+b+p;q=u[i[b]];g=0;for(h=q.length;g<h;++g)if(q[g]>=w&&q[g]<=y)break;if(g>=h)break}if(b>=e){this.emit(a);break}}};exports.PhraseQuery=PhraseQuery;
function PrefixQuery(a,d,c){this.field=a||null;this.prefix=d;this.boost=c||1}PrefixQuery.prototype.field=null;PrefixQuery.prototype.boost=1;PrefixQuery.prototype.score=function(a,d){return this.rewrite().score(a,d)};PrefixQuery.prototype.extractTerms=function(){return[{term:this.prefix,field:this.field}]};PrefixQuery.prototype.rewrite=function(){var a=this.prefix.replace(/.$/,function(a){return String.fromCharCode(a.charCodeAt(0)+1)});return new TermRangeQuery(this.field,this.prefix,a,!1,!0,this.boost)};
exports.PrefixQuery=PrefixQuery;function Searcher(a){this._index=a}Searcher.prototype.similarity=new DefaultSimilarity;Searcher.prototype.search=function(a,d,c){d=new TopDocumentsCollector(d,c);(new NormalizedQuery(a)).score(this.similarity,this._index).pipe(d)};exports.Searcher=Searcher;function TermQuery(a,d,c){this.field=a||null;this.term=d;this.boost=c||1}TermQuery.prototype.field=null;TermQuery.prototype.boost=1;
TermQuery.prototype.score=function(a,d){var c=new TermScorer(this,a);d.getTermVectors(this.field,this.term).pipe(c);return c};TermQuery.prototype.extractTerms=function(){return[{term:this.term,field:this.field}]};TermQuery.prototype.rewrite=function(){return this};function TermScorer(a,d){Stream.call(this);this._boost=a.boost;this._similarity=d}TermScorer.prototype=Object.create(Stream.prototype);
TermScorer.prototype.onWrite=function(a){var d=this._similarity,c=new DocumentTerms(a.documentID,[a]),b=d.idf(a);c.sumOfSquaredWeights=b*this._boost*b*this._boost;c.score=d.tf(a)*b*b*this._boost*d.norm(a);this.emit(c)};TermScorer.prototype.onBulkWrite=function(a){var d=this._similarity,c,b,e,g=Array(a.length);x=0;for(xl=a.length;x<xl;++x)c=a[x],b=new DocumentTerms(c.documentID,[c]),e=d.idf(c),b.sumOfSquaredWeights=e*this._boost*e*this._boost,b.score=d.tf(c)*e*e*this._boost*d.norm(c),g[x]=b;this.emitBulk(g)};
exports.TermQuery=TermQuery;function TermRangeQuery(a,d,c,b,e,g){this.field=a||null;this.startTerm=d;this.endTerm=c;this.excludeStart=b||!1;this.excludeEnd=e||!1;this.boost=g||1}TermRangeQuery.prototype.field=null;TermRangeQuery.prototype.excludeStart=!1;TermRangeQuery.prototype.excludeEnd=!1;TermRangeQuery.prototype.boost=1;TermRangeQuery.prototype._terms=null;
TermRangeQuery.prototype.score=function(a,d){var c=this,b=new Stream;d.getTermRange(this.field,this.startTerm,this.endTerm,this.excludeStart,this.excludeEnd,function(e,g){if(e)b.error(e);else try{c._terms=g,(new MultiTermQuery(c.field,g,!1,c.boost)).score(a,d).pipe(b)}catch(h){b.error(h)}});return b};
TermRangeQuery.prototype.extractTerms=function(){var a,d,c,b;if(this._terms){a=this._terms;d=Array(a.length);c=0;for(b=a.length;c<b;++c)d[c]={term:a[c],field:this.field};return d}else return[{term:this.startTerm,field:this.field}]};TermRangeQuery.prototype.rewrite=function(){return this};exports.TermRangeQuery=TermRangeQuery;function TopDocumentsCollector(a,d){Collector.call(this,d);this.max=a||1}TopDocumentsCollector.compareScores=function(a,d){return d.score-a.score};
TopDocumentsCollector.prototype=Object.create(Collector.prototype);TopDocumentsCollector.prototype.lowestScore=0;TopDocumentsCollector.prototype.onWrite=function(a){if(this.collection.length<this.max||a.score>this.lowestScore)this.collection.length>=this.max&&this.collection.pop(),Array.orderedInsert(this.collection,a,TopDocumentsCollector.compareScores),this.lowestScore=this.collection[this.collection.length-1].score};
TopDocumentsCollector.prototype.onBulkWrite=function(a){var d,c;d=0;for(c=a.length;d<c;++d)if(this.collection.length<this.max||a[d].score>this.lowestScore)this.collection.length>=this.max&&this.collection.pop(),Array.orderedInsert(this.collection,a[d],TopDocumentsCollector.compareScores),this.lowestScore=this.collection[this.collection.length-1].score};exports.TopDocumentsCollector=TopDocumentsCollector;function QueryParser(){}
QueryParser.parse=function(a,d){var c,b;c=QueryParser.impl.parse(a,void 0,d||null);do b=c,c=c.rewrite();while(c!==b);return c};
QueryParser.impl=function(){var a={parse:function(a,c,b){function e(a){var d=a.charCodeAt(0);if(d<=255)var a="x",c=2;else a="u",c=4;var a="\\"+a,b=d.toString(16).toUpperCase(),d=b;c-=b.length;for(b=0;b<c;b++)d="0"+d;return a+d}function g(a){return'"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/[\x80-\uFFFF]/g,e)+'"'}function h(a){f<z||(f>z&&(z=f,B=[]),B.push(a))}function i(){var c="WHITESPACE@"+f,b=k[c];if(b)return f=b.nextPos,b.result;b=j;j=!1;if(a.substr(f).match(/^[ \t\n\r\u3000]/)!==
null){var s=a.charAt(f);f++}else s=null,j&&h("[ \t\\n\\r\\u3000]");(j=b)&&s===null&&h("whitespace");k[c]={nextPos:f,result:s};return s}function p(){var a="SKIP@"+f,d=k[a];if(d)return f=d.nextPos,d.result;for(var d=[],c=i();c!==null;)d.push(c),c=i();k[a]={nextPos:f,result:d};return d}function u(){var c="Number@"+f,b=k[c];if(b)return f=b.nextPos,b.result;b=j;j=!1;var s=f;if(a.substr(f).match(/^[0-9]/)!==null){var e=a.charAt(f);f++}else e=null,j&&h("[0-9]");if(e!==null)for(var g=[];e!==null;)g.push(e),
a.substr(f).match(/^[0-9]/)!==null?(e=a.charAt(f),f++):(e=null,j&&h("[0-9]"));else g=null;if(g!==null){e=f;if(a.substr(f,1)==="."){var o=".";f+=1}else o=null,j&&h('"."');if(o!==null){if(a.substr(f).match(/^[0-9]/)!==null){var l=a.charAt(f);f++}else l=null,j&&h("[0-9]");if(l!==null)for(var i=[];l!==null;)i.push(l),a.substr(f).match(/^[0-9]/)!==null?(l=a.charAt(f),f++):(l=null,j&&h("[0-9]"));else i=null;i!==null?o=[o,i]:(o=null,f=e)}else o=null,f=e;e=o!==null?o:"";e!==null?g=[g,e]:(g=null,f=s)}else g=
null,f=s;s=g!==null?parseFloat(g[0].concat(g[1][0],g[1][1]).join("")):null;(j=b)&&s===null&&h("number");k[c]={nextPos:f,result:s};return s}function v(){var c="ESCAPED_CHAR@"+f,b=k[c];if(b)return f=b.nextPos,b.result;b=f;if(a.substr(f,1)==="\\"){var e="\\";f+=1}else e=null,j&&h('"\\\\"');if(e!==null){if(a.length>f){var g=a.charAt(f);f++}else g=null,j&&h("any character");g!==null?e=[e,g]:(e=null,f=b)}else e=null,f=b;k[c]={nextPos:f,result:e};return e}function w(){var c="TERM_START_CHAR@"+f,b=k[c];if(b)return f=
b.nextPos,b.result;a.substr(f).match(/^[^ \t\n\r\u3000+\-!():^[\]"{}~*?\\]/)!==null?(b=a.charAt(f),f++):(b=null,j&&h('[^ \t\\n\\r\\u3000+\\-!():^[\\]"{}~*?\\\\]'));k[c]={nextPos:f,result:b};return b}function y(){var c="TERM_CHAR@"+f,b=k[c];if(b)return f=b.nextPos,b.result;b=w();b===null&&(b=v(),b===null&&(a.substr(f,1)==="-"?(b="-",f+=1):(b=null,j&&h('"-"')),b===null&&(a.substr(f,1)==="+"?(b="+",f+=1):(b=null,j&&h('"+"')),b=b!==null?b:null)));k[c]={nextPos:f,result:b};return b}function q(){var a=
"Term@"+f,d=k[a];if(d)return f=d.nextPos,d.result;d=j;j=!1;var c=f,b=w();if(b!==null){for(var e=[],g=y();g!==null;)e.push(g),g=y();e!==null?b=[b,e]:(b=null,f=c)}else b=null,f=c;c=b!==null?[b[0]].concat(b[1]).join(""):null;(j=d)&&c===null&&h("term");k[a]={nextPos:f,result:c};return c}function C(){var c="Boost@"+f,b=k[c];if(b)return f=b.nextPos,b.result;b=j;j=!1;var e=f;if(a.substr(f,1)==="^"){var g="^";f+=1}else g=null,j&&h('"^"');if(g!==null){var i=u();i!==null?g=[g,i]:(g=null,f=e)}else g=null,f=
e;e=g!==null?g:"";e=e!==null?function(a){a&&(a=a[1]);return typeof a==="number"?a:1}(e):null;(j=b)&&e===null&&h("boost");k[c]={nextPos:f,result:e};return e}function E(){var c="TermType@"+f,b=k[c];if(b)return f=b.nextPos,b.result;var b=f,e=q();if(e!==null){if(a.substr(f,1)==="*"){var g="*";f+=1}else g=null,j&&h('"*"');g=g!==null?g:"";g!==null?e=[e,g]:(e=null,f=b)}else e=null,f=b;b=e!==null?e[1]?{prefix:e[0]}:{term:e[0]}:null;k[c]={nextPos:f,result:b};return b}function G(){var c="Range@"+f,b=k[c];if(b)return f=
b.nextPos,b.result;b=f;if(a.substr(f,1)==="["){var e="[";f+=1}else e=null,j&&h('"["');e===null&&(a.substr(f,1)==="{"?(e="{",f+=1):(e=null,j&&h('"{"')),e=e!==null?e:null);if(e!==null){var g=p();if(g!==null){var i=q();if(i!==null){var o=p();if(o!==null){if(a.substr(f,2)==="TO"){var l="TO";f+=2}else l=null,j&&h('"TO"');l===null&&(a.substr(f,1)==="-"?(l="-",f+=1):(l=null,j&&h('"-"')),l=l!==null?l:null);l=l!==null?l:"";if(l!==null){var m=p();if(m!==null){var n=q();if(n!==null){var t=p();if(t!==null){if(a.substr(f,
1)==="]"){var r="]";f+=1}else r=null,j&&h('"]"');r===null&&(a.substr(f,1)==="}"?(r="}",f+=1):(r=null,j&&h('"}"')),r=r!==null?r:null);r!==null?e=[e,g,i,o,l,m,n,t,r]:(e=null,f=b)}else e=null,f=b}else e=null,f=b}else e=null,f=b}else e=null,f=b}else e=null,f=b}else e=null,f=b}else e=null,f=b}else e=null,f=b;b=e!==null?{startTerm:e[2],endTerm:e[6],excludeStart:e[0]==="{",excludeEnd:e[8]==="}"}:null;k[c]={nextPos:f,result:b};return b}function H(){var b="Phrase@"+f,c=k[b];if(c)return f=c.nextPos,c.result;
c=f;if(a.substr(f,1)==='"'){var e='"';f+=1}else e=null,j&&h('"\\""');if(e!==null){var g=p();if(g!==null){var D=q();if(D!==null){var o=[],l=f,m=i();if(m!==null)for(var n=[];m!==null;)n.push(m),m=i();else n=null;n!==null?(m=q(),m!==null?n=[n,m]:(n=null,f=l)):(n=null,f=l);for(;n!==null;){o.push(n);l=f;m=i();if(m!==null)for(n=[];m!==null;)n.push(m),m=i();else n=null;n!==null?(m=q(),m!==null?n=[n,m]:(n=null,f=l)):(n=null,f=l)}if(o!==null)if(l=p(),l!==null)if(a.substr(f,1)==='"'?(n='"',f+=1):(n=null,j&&
h('"\\""')),n!==null){m=f;if(a.substr(f,1)==="~"){var t="~";f+=1}else t=null,j&&h('"~"');if(t!==null){var r=u();r!==null?t=[t,r]:(t=null,f=m)}else t=null,f=m;m=t!==null?t:"";m!==null?e=[e,g,D,o,l,n,m]:(e=null,f=c)}else e=null,f=c;else e=null,f=c;else e=null,f=c}else e=null,f=c}else e=null,f=c}else e=null,f=c;c=e!==null?function(a,c,b){a=[a];if(c)for(var d=0,e=c.length;d<e;++d)a.push(c[d][1]);return{phrase:a,slop:b?b[1]:0}}(e[2],e[3],e[6]):null;k[b]={nextPos:f,result:c};return c}function I(){var c=
"TermQuery@"+f,b=k[c];if(b)return f=b.nextPos,b.result;var e=b=f,g=q();if(g!==null){if(a.substr(f,1)===":"){var i=":";f+=1}else i=null,j&&h('":"');i!==null?g=[g,i]:(g=null,f=e)}else g=null,f=e;e=g!==null?g:"";e!==null?(g=H(),g===null&&(g=G(),g===null&&(g=E(),g=g!==null?g:null)),g!==null?(i=C(),i!==null?e=[e,g,i]:(e=null,f=b)):(e=null,f=b)):(e=null,f=b);b=e!==null?function(a,b,c){a=a?a[0]:N;return b.phrase?new PhraseQuery(a,b.phrase,b.slop,c):b.startTerm?new TermRangeQuery(a,b.startTerm,b.endTerm,
b.excludeStart,b.excludeEnd,c):b.prefix?new PrefixQuery(a,b.prefix,c):new TermQuery(a,b.term,c)}(e[0],e[1],e[2]):null;k[c]={nextPos:f,result:b};return b}function A(){var b="BooleanClause@"+f,c=k[b];if(c)return f=c.nextPos,c.result;c=f;if(a.substr(f,1)==="+"){var e="+";f+=1}else e=null,j&&h('"+"');e===null&&(a.substr(f,1)==="-"?(e="-",f+=1):(e=null,j&&h('"-"')),e=e!==null?e:null);e=e!==null?e:"";if(e!==null){var g=J();g===null&&(g=I(),g=g!==null?g:null);g!==null?e=[e,g]:(e=null,f=c)}else e=null,f=
c;c=e!==null?function(a,b){a=a==="+"?Occur.MUST:a==="-"?Occur.MUST_NOT:Occur.SHOULD;return new BooleanClause(b,a)}(e[0],e[1]):null;k[b]={nextPos:f,result:c};return c}function K(){var a="BooleanQuery@"+f,b=k[a];if(b)return f=b.nextPos,b.result;var b=f,c=A();if(c!==null){var d=[],e=f,g=i();if(g!==null)for(var h=[];g!==null;)h.push(g),g=i();else h=null;h!==null?(g=A(),g!==null?h=[h,g]:(h=null,f=e)):(h=null,f=e);for(;h!==null;){d.push(h);e=f;g=i();if(g!==null)for(h=[];g!==null;)h.push(g),g=i();else h=
null;h!==null?(g=A(),g!==null?h=[h,g]:(h=null,f=e)):(h=null,f=e)}d!==null?c=[c,d]:(c=null,f=b)}else c=null,f=b;b=c!==null?function(a,b){var c=[a];if(b)for(var d=0,e=b.length;d<e;++d)c[c.length]=b[d][1];return new BooleanQuery(c)}(c[0],c[1]):null;k[a]={nextPos:f,result:b};return b}function J(){var b="SubQuery@"+f,c=k[b];if(c)return f=c.nextPos,c.result;c=f;if(a.substr(f,1)==="("){var e="(";f+=1}else e=null,j&&h('"("');if(e!==null){var g=L();if(g!==null){if(a.substr(f,1)===")"){var i=")";f+=1}else i=
null,j&&h('")"');if(i!==null){var o=C();o!==null?e=[e,g,i,o]:(e=null,f=c)}else e=null,f=c}else e=null,f=c}else e=null,f=c;c=e!==null?function(a,c){a.boost=c;return a}(e[1],e[3]):null;k[b]={nextPos:f,result:c};return c}function L(){var a="Query@"+f,c=k[a];if(c)return f=c.nextPos,c.result;var c=f,b=p();if(b!==null){var d=K();if(d!==null){var e=p();e!==null?b=[b,d,e]:(b=null,f=c)}else b=null,f=c}else b=null,f=c;c=b!==null?b[1]:null;k[a]={nextPos:f,result:c};return c}function P(){var c=function(a){a.sort();
for(var c=null,b=[],d=0;d<a.length;d++)a[d]!==c&&(b.push(a[d]),c=a[d]);switch(b.length){case 0:return"end of input";case 1:return b[0];default:return b.slice(0,b.length-1).join(", ")+" or "+b[b.length-1]}}(B),b=Math.max(f,z),b=b<a.length?g(a.charAt(b)):"end of input";return"Expected "+c+" but "+b+" found."}function Q(){for(var b=1,c=1,e=!1,f=0;f<z;f++){var g=a.charAt(f);g==="\n"?(e||b++,c=1,e=!1):g==="\r"|g==="\u2028"||g==="\u2029"?(b++,c=1,e=!0):(c++,e=!1)}return{line:b,column:c}}var M={BooleanClause:A,
BooleanQuery:K,Boost:C,ESCAPED_CHAR:v,Number:u,Phrase:H,Query:L,Range:G,SKIP:p,SubQuery:J,TERM_CHAR:y,TERM_START_CHAR:w,Term:q,TermQuery:I,TermType:E,WHITESPACE:i};if(c!==void 0){if(M[c]===void 0)throw Error("Invalid rule name: "+g(c)+".");}else c="Query";var f=0,j=!0,z=0,B=[],k={},N=b||null,c=M[c]();if(c===null||f!==a.length)throw c=Q(),new this.SyntaxError(P(),c.line,c.column);return c},toSource:function(){return typeof this._source==="string"?this._source:this.toString()},SyntaxError:function(a,
c,b){this.name="SyntaxError";this.message=a;this.line=c;this.column=b}};a.SyntaxError.prototype=Error.prototype;return a}();
