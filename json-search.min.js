var O={};function F(){}function typeOf(a){return a===void 0?"undefined":a===null?"null":Object.prototype.toString.call(a).split(" ").pop().split("]").shift().toLowerCase()}typeof exports==="undefined"&&(exports={});typeof require!=="function"&&(require=function(){return exports});if(typeof Object.create!=="function")Object.create=function(a){F.prototype=a;return new F};if(typeof Array.isArray!=="function")Array.isArray=function(a){return typeOf(a)==="array"};
if(typeof Array.add!=="function")Array.add=function(a,b){if(a.indexOf(b)===-1)return a[a.length]=b,!0;return!1};if(typeof Array.remove!=="function")Array.remove=function(a,b){var d=a.indexOf(b);if(d!==-1)return a.splice(d,1),!0;return!1};if(!Array.append)Array.append=function(a,b){b=b.slice(0);b.unshift(a.length,0);a.splice.apply(a,b);return a};
if(typeof Array.orderedInsert!=="function")Array.orderedInsert=function(a,b,d){var c,f,h;if(a.length===0)a[0]=b;else{c=0;f=a.length-1;for(h=Math.floor(f/2);c<f;)d(a[h],b)<=0?c=h+1:f=h-1,h=Math.round(c+(f-c)/2);c===f?d(a[c],b)<=0?a.splice(c+1,0,b):a.splice(c,0,b):a.splice(f+1,0,b)}};function Stream(){}Stream.prototype._streamInput=null;Stream.prototype._streamOutput=null;Stream.prototype._streamBuffer=null;Stream.prototype._streamPaused=!1;Stream.prototype._streamEnded=!1;
Stream.prototype._streamError=null;Stream.prototype._streamDraining=!1;
Stream.prototype._streamDrain=function(){var a,b,d;if(this._streamBuffer&&!this._streamPaused&&!this._streamDraining){this._streamDraining=!0;try{for(a=0;!this._streamPaused&&a<this._streamBuffer.length;++a)if(this._streamBuffer[a].length>1)if(this.onBulkWrite!==Stream.prototype.onBulkWrite)this.onBulkWrite(this._streamBuffer[a]);else{b=0;for(d=this._streamBuffer[a].length;!this._streamPaused&&b<d;++b)this.onWrite(this._streamBuffer[a][b]);if(b<d){this._streamBuffer[a]=this._streamBuffer[a].slice(b);
break}}else if(this._streamBuffer[a].length===1)this.onWrite(this._streamBuffer[a][0])}catch(c){this.error(c),a=this._streamBuffer.length}if(!this._streamPaused&&a>=this._streamBuffer.length){if(this._streamBuffer=null,this._streamEnded)try{if(this._streamError)this.onError(this._streamError);else this.onEnd()}catch(f){}}else this._streamBuffer=this._streamBuffer.slice(a);this._streamDraining=!1}};
Stream.prototype.pipe=function(a){if(this._streamOutput)throw Error("Stream already has an output");if(a._streamInput)throw Error("Output stream already has an input");this._streamOutput=a;a._streamInput=this;a._streamEnded=!1;a._streamError=null;a.onStart(this)};Stream.prototype.write=function(a){if(this._streamPaused){if(!this._streamBuffer)this._streamBuffer=[];this._streamBuffer[this._streamBuffer.length]=[a]}else this.onWrite(a)};Stream.prototype.emit=function(a){this._streamOutput&&this._streamOutput.write(a)};
Stream.prototype.bulkWrite=function(a){if(this._streamPaused){if(!this._streamBuffer)this._streamBuffer=[];this._streamBuffer[this._streamBuffer.length]=a}else this.onBulkWrite(a)};Stream.prototype.emitBulk=function(a){this._streamOutput&&this._streamOutput.bulkWrite(a)};Stream.prototype.isPaused=function(){return this._streamPaused};Stream.prototype.pause=function(){if(!this._streamPaused){this._streamPaused=!0;if(this.onPause)this.onPause();this._streamInput&&this._streamInput.pause()}};
Stream.prototype.resume=function(){var a=this;if(this._streamPaused){this._streamPaused=!1;if(this.onResume)this.onResume();this._streamBuffer&&setTimeout(function(){a._streamDrain()},0);this._streamInput&&this._streamInput.resume()}};Stream.prototype.end=function(){if(!this._streamEnded)if(this._streamEnded=!0,!this._streamPaused&&!this._streamBuffer)this.onEnd();else if(!this._streamBuffer)this._streamBuffer=[]};
Stream.prototype.emitEnd=function(){this._streamEnded=!0;if(this._streamOutput)this._streamOutput.end(),this._streamOutput=this._streamOutput._streamInput=null};Stream.prototype.error=function(a){if(!this._streamEnded)if(this._streamEnded=!0,this._streamError=a,!this._streamPaused&&!this._streamBuffer)this.onError(a);else if(!this._streamBuffer)this._streamBuffer=[]};
Stream.prototype.emitError=function(a){this._streamEnded=!0;this._streamError=a;if(this._streamOutput)this._streamOutput.error(a),this._streamOutput=this._streamOutput._streamInput=null};Stream.prototype.onStart=function(){};Stream.prototype.onWrite=Stream.prototype.emit;Stream.prototype.onBulkWrite=function(a){if(this.onWrite!==Stream.prototype.onWrite){if(!this._streamBuffer)this._streamBuffer=[];this._streamBuffer[this._streamBuffer.length]=a;this._streamDrain()}else this.emitBulk(a)};
Stream.prototype.onEnd=Stream.prototype.emitEnd;Stream.prototype.onError=Stream.prototype.emitError;exports.Stream=Stream;function Collector(a){Stream.call(this);this.collection=[];this.callback=a||null}Collector.prototype=Object.create(Stream.prototype);Collector.prototype.callback=null;Collector.prototype.onWrite=function(a){this.collection.push(a)};Collector.prototype.onBulkWrite=function(a){this.collection=this.collection.concat(a)};
Collector.prototype.onEnd=function(){if(this.callback)this.callback(null,this.collection),this.callback=null};Collector.prototype.onError=function(a){if(this.callback)this.callback(a),this.callback=null};exports.Collector=Collector;var ScapegoatTreeNode;function ScapegoatTree(a){this.a=a&&a>=0.5&&a<1?a:0.5;this.lna=Math.log(1/this.a);this.root=null;this.size=0}function Scapegoat_size(a){return a===null?0:Scapegoat_size(a[1])+Scapegoat_size(a[2])+1}
function Scapegoat_toArray(a){if(a===null)return[];return Scapegoat_toArray(a[1]).concat([a[0]],Scapegoat_toArray(a[2]))}function Scapegoat_toTree(a){var b;if(a.length===0)return null;if(a.length===1)return[a[0],null,null];b=Math.floor(a.length/2);return[a[b],Scapegoat_toTree(a.slice(0,b)),Scapegoat_toTree(a.slice(b+1))]}
ScapegoatTree.prototype.insert=function(a){var b,d,c,f,h;if(this.root!==null){this.size++;b=Math.log(this.size)/this.lna+1;d=[this.root];for(c=this.root;;){if(c[0]>a)if(c[1]!==null)c=c[1];else{c=c[1]=[a,null,null];break}else if(c[2]!==null)c=c[2];else{c=c[2]=[a,null,null];break}d[d.length]=c}if(d.length+1>b){a=c;for(f=1;d.length;)if(c=a,b=f,a=d.pop(),c=a[1]===c?Scapegoat_size(a[2]):Scapegoat_size(a[1]),f=b+c+1,h=f*this.a,b>h||c>h){c=Scapegoat_toTree(Scapegoat_toArray(a));d.length===0?this.root=c:
d[d.length-1][1]===a?d[d.length-1][1]=c:d[d.length-1][2]=c;break}}}else this.root=[a,null,null],this.size=1};ScapegoatTree.prototype.insertAll=function(a){var b,d;b=0;for(d=a.length;b<d;++b)this.insert(a[b])};
ScapegoatTree.prototype.range=function(a,b,d,c){for(var f=[],h=this.root,i=[];h!==null&&h[0]!==a;)h[0]>=a?(f[f.length]=h,h=h[1]):h=h[2];if(h!==null&&(!d||h[0]!==a))i[i.length]=h[0];for(;f.length;){h=f.pop();if(h[0]>=b){!c&&h[0]===b&&(i[i.length]=h[0]);break}i[i.length]=h[0];for(h=h[2];h!==null;)f[f.length]=h,h=h[1]}return i};ScapegoatTree.prototype.toArray=function(){return Scapegoat_toArray(this.root)};exports.ScapegoatTree=ScapegoatTree;
function SingleCollector(a){Stream.call(this);this.listener=a}SingleCollector.prototype=Object.create(Stream.prototype);SingleCollector.prototype.onWrite=function(a){if(typeof this.data!=="undefined")throw Error("Stream is full");this.data=a;this.listener&&this.listener(null,a);typeof this.data!=="undefined"&&this.pause()};SingleCollector.prototype.drain=function(){this.data=void 0;this.resume()};SingleCollector.prototype.onEnd=function(){if(this.listener)this.listener(!0),this.listener=null;this.emitEnd()};
SingleCollector.prototype.onError=function(a){if(this.listener)this.listener(a),this.listener=null;this.emitError(a)};exports.SingleCollector=SingleCollector;function DefaultTermIndexer(){}
DefaultTermIndexer.prototype.index=function(a,b,d){var c,f,h=[];switch(typeOf(a)){case "null":case "boolean":case "number":h[0]={term:a,field:d||null,documentID:b};break;case "string":a=a.replace(/[^\w\d]/g," ").replace(/\s\s/g," ").toLowerCase().split(" ");c={};for(f=0;f<a.length;++f)c[a[f]]?(c[a[f]].termFrequency++,c[a[f]].termPositions.push(f)):c[a[f]]={term:a[f],termFrequency:1,termPositions:[f],field:d,totalFieldTokens:a.length,documentID:b};for(f in c)c[f]!==O[f]&&(h[h.length]=c[f]);break;case "object":for(f in a)a[f]!==
O[f]&&(h=h.concat(this.index(a[f],b,d?d+"."+f:f)));break;case "array":for(f=0;f<a.length;++f)h=h.concat(this.index(a[f],b,d?d+"."+f:String(f)))}return h};DefaultTermIndexer.prototype.toSource=function(){};exports.DefaultTermIndexer=DefaultTermIndexer;function MemoryIndex(){this._docs={};this._index={};this._indexKeys=new ScapegoatTree}MemoryIndex.documentIDComparator=function(a,b){if(a.documentID<b.documentID)return-1;else if(a.documentID>b.documentID)return 1;return 0};
MemoryIndex.stringComparator=function(a,b){if(a<b)return-1;else if(a>b)return 1;return 0};MemoryIndex.prototype._docCount=0;MemoryIndex.prototype._termIndexer=new DefaultTermIndexer;MemoryIndex.prototype.generateID=function(){return String(Math.random())};
MemoryIndex.prototype.indexDocument=function(a,b,d){var c,f,a=this._termIndexer.index(a,b),b=0;for(c=a.length;b<c;++b)f=JSON.stringify([a[b].field,a[b].term]),this._index[f]?Array.orderedInsert(this._index[f],a[b],MemoryIndex.documentIDComparator):(this._index[f]=[a[b]],this._indexKeys.insert(f));d&&d(null)};MemoryIndex.prototype.addDocument=function(a,b,d){b=typeof b==="undefined"||typeOf(b)==="null"?this.generateID():String(b);this._docs[b]=a;this._docCount++;this.indexDocument(a,b,d)};
MemoryIndex.prototype.getDocument=function(a,b){b(null,this._docs[a])};MemoryIndex.prototype.setTermIndexer=function(a,b){var d=this._docs,c;this._termIndexer=a;this._index={};for(c in d)d.hasOwnProperty(c)&&this.indexDocument(d[c],c);b&&b(null)};MemoryIndex.prototype.getTermVectors=function(a,b){var d=this._index[JSON.stringify([a,b])]||[],c=new Stream;c.pause();c.bulkWrite(d);c.end();c.resume();return c};
MemoryIndex.prototype.getTermRangeVectors=function(a,b,d,c,f){b=JSON.stringify([a,b]);a=JSON.stringify([a,d]);c=this._indexKeys.range(b,a,c,f);stream=new Stream;stream.pause();f=0;for(a=c.length;f<a;++f)stream.bulkWrite(this._index[c[f]]);stream.end();stream.resume();return stream};MemoryIndex.prototype.getTermRange=function(a,b,d,c,f,h){var b=JSON.stringify([a,b]),a=JSON.stringify([a,d]),i=this._indexKeys.range(b,a,c,f).map(function(a){return JSON.parse(a)[1]});setTimeout(function(){h(null,i)},0)};
exports.MemoryIndex=MemoryIndex;function BooleanClause(a,b){this.query=a;this.occur=b||Occur.SHOULD}var Occur={MUST:1,SHOULD:0,MUST_NOT:-1};exports.BooleanQuery=BooleanQuery;exports.Occur=Occur;function BooleanQuery(a,b,d){this.clauses=a||[];this.minimumOptionalMatches=b||0;this.boost=d||1}BooleanQuery.prototype.minimumOptionalMatches=0;BooleanQuery.prototype.boost=1;BooleanQuery.prototype.score=function(a,b){return new BooleanScorer(this,a,b)};
BooleanQuery.prototype.extractTerms=function(){var a,b,d=[];a=0;for(b=this.clauses.length;a<b;++a)d=d.concat(this.clauses[a].query.extractTerms());return d};
BooleanQuery.prototype.rewrite=function(){var a,b,d,c=!1;if(this.minimumOptionalMatches===0&&this.clauses.length===1&&this.clauses[0].occur!==Occur.MUST_NOT)a=this.clauses[0].query,a=a.rewrite(),a.boost*=this.boost;else{a=new BooleanQuery;a.boost=this.boost;b=0;for(d=this.clauses.length;b<d;++b)a.clauses[b]=new BooleanClause(this.clauses[b].query.rewrite(),this.clauses[b].occur),a.clauses[b].query!==this.clauses[b].query&&(c=!0);c||(a=this)}return a};
function BooleanScorer(a,b,d){Stream.call(this);this._query=a;this._similarity=b;this._index=d;this._inputs=[];this.addInputs(a.clauses)}BooleanScorer.prototype=Object.create(Stream.prototype);BooleanScorer.prototype._collectorCount=0;
BooleanScorer.prototype.addInputs=function(a){var b=this;a.forEach(function(a){var c=new SingleCollector(function(a){a?a===!0?(f.collector=null,b._collectorCount--,b._collectorCount===0||f.occur===Occur.MUST?(b._collectorCount=0,b.end()):b._collectorCount>0&&b.match()):b.error(a):b.match()}),f=new BooleanClauseStream(a.query,a.occur,c);a.query.score(b._similarity,b._index).pipe(c);b._inputs.push(f);b._collectorCount++})};
BooleanScorer.prototype.match=function(){var a,b,d=[],c=0,f=!1,h=0,i;if(!this.isPaused()){a=0;for(b=this._inputs.length;a<b;++a){if(this._inputs[a].collector){if(d[a]=this._inputs[a].collector.data,typeof d[a]==="undefined")return}else d[a]=void 0;if(a>0&&(!d[c]||d[a]&&d[a].id<d[c].id))c=a}c=d[c].id;i=new DocumentTerms(c);a=0;for(b=this._inputs.length;a<b;++a)if(d[a]&&d[a].id===c)if(this._inputs[a].occur===Occur.MUST_NOT){f=!1;break}else this._inputs[a].occur===Occur.SHOULD&&h++,f=!0,i.terms=i.terms.concat(d[a].terms),
i.sumOfSquaredWeights+=d[a].sumOfSquaredWeights,i.score+=d[a].score;else if(this._inputs[a].occur===Occur.MUST){f=!1;break}f&&h>=this._query.minimumOptionalMatches&&(i.score*=this._query.boost,i.sumOfSquaredWeights*=this._query.boost*this._query.boost,this.emit(i));a=0;for(b=this._inputs.length;a<b;++a)d[a]&&d[a].id===c&&this._inputs[a].collector.drain()}};BooleanScorer.prototype.onResume=function(){var a=this;setTimeout(function(){a.match()},0)};
BooleanScorer.prototype.onEnd=function(){if(this._collectorCount)throw Error("BooleanScorer#end called while there are still collectors attached!");this.emitEnd();this._cleanup()};BooleanScorer.prototype.onError=function(a){this.emitError(a);this._cleanup()};BooleanScorer.prototype._cleanup=function(){var a,b;a=0;for(b=this._inputs.length;a<b;++a)this._inputs[a].collector&&this._inputs[a].collector.end();this._inputs=[]};
function BooleanClauseStream(a,b,d){this.query=a;this.occur=b;this.collector=d}BooleanClauseStream.prototype=Object.create(BooleanClause.prototype);exports.BooleanQuery=BooleanQuery;var DefaultSimilarity=function(){};DefaultSimilarity.prototype.norm=function(a){return(a.documentBoost||1)*(a.fieldBoost||1)*(1/Math.sqrt(a.totalFieldTokens||1))};DefaultSimilarity.prototype.queryNorm=function(a){return 1/Math.sqrt(a.sumOfSquaredWeights)};
DefaultSimilarity.prototype.tf=function(a){return Math.sqrt(a.termFrequency||1)};DefaultSimilarity.prototype.sloppyFreq=function(a){return 1/(a+1)};DefaultSimilarity.prototype.idf=function(a){return Math.log((a.totalDocuments||1)/((a.documentFrequency||1)+1))+1};DefaultSimilarity.prototype.coord=function(a,b){return a/b};exports.DefaultSimilarity=DefaultSimilarity;function DocumentTerms(a,b){this.id=a;this.terms=b||[]}
DocumentTerms.compare=function(a,b){if(a.id<b.id)return-1;else if(a.id>b.id)return 1;return 0};DocumentTerms.prototype.terms=[];DocumentTerms.prototype.sumOfSquaredWeights=0;DocumentTerms.prototype.score=0;exports.DocumentTerms=DocumentTerms;function FilterQuery(a,b,d){this.query=a;this.filter=b;this.boost=d||1}FilterQuery.prototype.boost=1;FilterQuery.prototype.score=function(a,b){var d=new FilterScorer(this,a);this.query.score(a,b).pipe(d);return d};FilterQuery.prototype.extractTerms=function(){return this.query.extractTerms()};
FilterQuery.prototype.rewrite=function(){var a;do a=this.query,this.query=this.query.rewrite();while(this.query!==a);return this};function FilterScorer(a,b){Stream.call(this);this._query=a;this._similarity=b;this._maxOverlap=a.extractTerms().length}FilterScorer.prototype=Object.create(Stream.prototype);FilterScorer.prototype.onWrite=function(a){var b=this._query.boost;this._query.filter(a)&&(a.score*=b,a.sumOfSquaredWeights*=b*b,this.emit(a))};
FilterScorer.prototype.onBulkWrite=function(a){var b,d;boost=this._query.boost;a=a.filter(this._query.filter);b=0;for(d=a.length;b<d;++b)filter(a[b])&&(a[b].score*=boost,a[b].sumOfSquaredWeights*=boost*boost);this.emitBulk(a)};exports.FilterQuery=FilterQuery;function MultiTermQuery(a,b,d){this.field=a;this.terms=b;this.boost=d||1}MultiTermQuery.prototype.boost=1;MultiTermQuery.prototype.score=function(a,b){return this.rewrite().score(a,b)};
MultiTermQuery.prototype.extractTerms=function(){var a,b,d,c;a=this.terms;b=Array(a.length);d=0;for(c=a.length;d<c;++d)b[d]={term:a[d],field:this.field};return b};MultiTermQuery.prototype.rewrite=function(){var a,b,d,c;if(this.terms.length===1)return new TermQuery(this.field,this.terms[0],this.boost);a=new BooleanQuery;a.minimumOptionalMatches=1;a.boost=this.boost;b=this.terms;d=0;for(c=b.length;d<c;++d)a.clauses.push(new BooleanClause(new TermQuery(this.field,b[d]),Occur.SHOULD));return a};
exports.MultiTermQuery=MultiTermQuery;function NormalizedQuery(a,b){this.query=a;this.boost=b||1}NormalizedQuery.prototype.boost=1;NormalizedQuery.prototype.score=function(a,b){var d=new NormalizedScorer(this,a);this.query.score(a,b).pipe(d);return d};NormalizedQuery.prototype.extractTerms=function(){return this.query.extractTerms()};NormalizedQuery.prototype.rewrite=function(){var a;do a=this.query,this.query=this.query.rewrite();while(this.query!==a);return this};
function NormalizedScorer(a,b){Stream.call(this);this._query=a;this._similarity=b}NormalizedScorer.prototype=Object.create(Stream.prototype);NormalizedScorer.prototype.onWrite=function(a){if(!this._maxOverlap)this._maxOverlap=this._query.extractTerms().length;a.score*=this._query.boost*this._similarity.queryNorm(a)*this._similarity.coord(a.terms.length,this._maxOverlap);this.emit(a)};
NormalizedScorer.prototype.onBulkWrite=function(a){var b,d,c;if(!this._maxOverlap)this._maxOverlap=this._query.extractTerms().length;b=0;for(d=a.length;b<d;++b)c=a[b],c.score*=this._query.boost*this._similarity.queryNorm(c)*this._similarity.coord(c.terms.length,this._maxOverlap);this.emitBulk(a)};exports.NormalizedQuery=NormalizedQuery;function PhraseQuery(a,b,d,c){this.field=a||null;this.terms=b||[];this.slop=d||0;this.boost=c||1}PhraseQuery.prototype.field=null;PhraseQuery.prototype.slop=0;
PhraseQuery.prototype.boost=1;PhraseQuery.prototype.score=function(){};PhraseQuery.prototype.extractTerms=function(){var a,b,d=[];a=0;for(b=this.terms.length;a<b;++a)typeof this.terms[a]!=="undefined"&&d.push({term:this.terms[a],field:this.field});return d};PhraseQuery.prototype.rewrite=function(){if(this.terms.length===1&&typeof this.terms[0]!=="undefined")return new TermQuery(this.field,this.terms[0],this.boost);return this};exports.PhraseQuery=PhraseQuery;
function PrefixQuery(a,b,d){this.field=a||null;this.prefix=b;this.boost=d||1}PrefixQuery.prototype.field=null;PrefixQuery.prototype.boost=1;PrefixQuery.prototype.score=function(a,b){return this.rewrite().score(a,b)};PrefixQuery.prototype.extractTerms=function(){return[{term:this.prefix,field:this.field}]};PrefixQuery.prototype.rewrite=function(){var a=this.prefix.replace(/.$/,function(a){return String.fromCharCode(a.charCodeAt(0)+1)});return new TermRangeQuery(this.field,this.prefix,a,!1,!0,this.boost)};
exports.PrefixQuery=PrefixQuery;function QueryParser(){}QueryParser.parse=function(a,b){var d,c;d=QueryParser.impl.parse(a,void 0,b||null);do c=d,d=d.rewrite();while(d!==c);return d};
QueryParser.impl=function(){var a={parse:function(a,d,c){function f(a){var b=a.charCodeAt(0);if(b<=255)var a="x",e=2;else a="u",e=4;var a="\\"+a,d=b.toString(16).toUpperCase(),b=d;e-=d.length;for(d=0;d<e;d++)b="0"+b;return a+b}function h(a){return'"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/[\x80-\uFFFF]/g,f)+'"'}function i(a){e<v||(e>v&&(v=e,y=[]),y.push(a))}function r(){var d="WHITESPACE@"+e,j=l[d];if(j)return e=j.nextPos,j.result;j=k;k=!1;if(a.substr(e).match(/^[ \t\n\r\u3000]/)!==
null){var g=a.charAt(e);e++}else g=null,k&&i("[ \t\\n\\r\\u3000]");(k=j)&&g===null&&i("whitespace");l[d]={nextPos:e,result:g};return g}function t(){var a="SKIP@"+e,b=l[a];if(b)return e=b.nextPos,b.result;for(var b=[],d=r();d!==null;)b.push(d),d=r();l[a]={nextPos:e,result:b};return b}function z(){var d="Number@"+e,j=l[d];if(j)return e=j.nextPos,j.result;j=k;k=!1;var g=e;if(a.substr(e).match(/^[0-9]/)!==null){var c=a.charAt(e);e++}else c=null,k&&i("[0-9]");if(c!==null)for(var f=[];c!==null;)f.push(c),
a.substr(e).match(/^[0-9]/)!==null?(c=a.charAt(e),e++):(c=null,k&&i("[0-9]"));else f=null;if(f!==null){c=e;if(a.substr(e,1)==="."){var p=".";e+=1}else p=null,k&&i('"."');if(p!==null){if(a.substr(e).match(/^[0-9]/)!==null){var m=a.charAt(e);e++}else m=null,k&&i("[0-9]");if(m!==null)for(var h=[];m!==null;)h.push(m),a.substr(e).match(/^[0-9]/)!==null?(m=a.charAt(e),e++):(m=null,k&&i("[0-9]"));else h=null;h!==null?p=[p,h]:(p=null,e=c)}else p=null,e=c;c=p!==null?p:"";c!==null?f=[f,c]:(f=null,e=g)}else f=
null,e=g;g=f!==null?parseFloat(f[0].concat(f[1][0],f[1][1]).join("")):null;(k=j)&&g===null&&i("number");l[d]={nextPos:e,result:g};return g}function E(){var d="ESCAPED_CHAR@"+e,j=l[d];if(j)return e=j.nextPos,j.result;j=e;if(a.substr(e,1)==="\\"){var g="\\";e+=1}else g=null,k&&i('"\\\\"');if(g!==null){if(a.length>e){var c=a.charAt(e);e++}else c=null,k&&i("any character");c!==null?g=[g,c]:(g=null,e=j)}else g=null,e=j;l[d]={nextPos:e,result:g};return g}function B(){var d="TERM_START_CHAR@"+e,j=l[d];if(j)return e=
j.nextPos,j.result;a.substr(e).match(/^[^ \t\n\r\u3000+\-!():^[\]"{}~*?\\]/)!==null?(j=a.charAt(e),e++):(j=null,k&&i('[^ \t\\n\\r\\u3000+\\-!():^[\\]"{}~*?\\\\]'));l[d]={nextPos:e,result:j};return j}function C(){var d="TERM_CHAR@"+e,j=l[d];if(j)return e=j.nextPos,j.result;j=B();j===null&&(j=E(),j===null&&(a.substr(e,1)==="-"?(j="-",e+=1):(j=null,k&&i('"-"')),j===null&&(a.substr(e,1)==="+"?(j="+",e+=1):(j=null,k&&i('"+"')),j=j!==null?j:null)));l[d]={nextPos:e,result:j};return j}function u(){var a=
"Term@"+e,b=l[a];if(b)return e=b.nextPos,b.result;b=k;k=!1;var d=e,c=B();if(c!==null){for(var f=[],h=C();h!==null;)f.push(h),h=C();f!==null?c=[c,f]:(c=null,e=d)}else c=null,e=d;d=c!==null?[c[0]].concat(c[1]).join(""):null;(k=b)&&d===null&&i("term");l[a]={nextPos:e,result:d};return d}function D(){var d="Boost@"+e,j=l[d];if(j)return e=j.nextPos,j.result;j=k;k=!1;var g=e;if(a.substr(e,1)==="^"){var c="^";e+=1}else c=null,k&&i('"^"');if(c!==null){var f=z();f!==null?c=[c,f]:(c=null,e=g)}else c=null,e=
g;g=c!==null?c:"";g=g!==null?function(a){a&&(a=a[1]);return typeof a==="number"?a:1}(g):null;(k=j)&&g===null&&i("boost");l[d]={nextPos:e,result:g};return g}function G(){var d="TermType@"+e,c=l[d];if(c)return e=c.nextPos,c.result;var c=e,g=u();if(g!==null){if(a.substr(e,1)==="*"){var f="*";e+=1}else f=null,k&&i('"*"');f=f!==null?f:"";f!==null?g=[g,f]:(g=null,e=c)}else g=null,e=c;c=g!==null?g[1]?{prefix:g[0]}:{term:g[0]}:null;l[d]={nextPos:e,result:c};return c}function H(){var d="Range@"+e,c=l[d];if(c)return e=
c.nextPos,c.result;c=e;if(a.substr(e,1)==="["){var g="[";e+=1}else g=null,k&&i('"["');g===null&&(a.substr(e,1)==="{"?(g="{",e+=1):(g=null,k&&i('"{"')),g=g!==null?g:null);if(g!==null){var f=t();if(f!==null){var h=u();if(h!==null){var p=t();if(p!==null){if(a.substr(e,2)==="TO"){var m="TO";e+=2}else m=null,k&&i('"TO"');m===null&&(a.substr(e,1)==="-"?(m="-",e+=1):(m=null,k&&i('"-"')),m=m!==null?m:null);m=m!==null?m:"";if(m!==null){var n=t();if(n!==null){var o=u();if(o!==null){var s=t();if(s!==null){if(a.substr(e,
1)==="]"){var q="]";e+=1}else q=null,k&&i('"]"');q===null&&(a.substr(e,1)==="}"?(q="}",e+=1):(q=null,k&&i('"}"')),q=q!==null?q:null);q!==null?g=[g,f,h,p,m,n,o,s,q]:(g=null,e=c)}else g=null,e=c}else g=null,e=c}else g=null,e=c}else g=null,e=c}else g=null,e=c}else g=null,e=c}else g=null,e=c}else g=null,e=c;c=g!==null?{startTerm:g[2],endTerm:g[6],excludeStart:g[0]==="{",excludeEnd:g[8]==="}"}:null;l[d]={nextPos:e,result:c};return c}function I(){var d="Phrase@"+e,c=l[d];if(c)return e=c.nextPos,c.result;
c=e;if(a.substr(e,1)==='"'){var g='"';e+=1}else g=null,k&&i('"\\""');if(g!==null){var f=t();if(f!==null){var h=u();if(h!==null){var p=[],m=e,n=r();if(n!==null)for(var o=[];n!==null;)o.push(n),n=r();else o=null;o!==null?(n=u(),n!==null?o=[o,n]:(o=null,e=m)):(o=null,e=m);for(;o!==null;){p.push(o);m=e;n=r();if(n!==null)for(o=[];n!==null;)o.push(n),n=r();else o=null;o!==null?(n=u(),n!==null?o=[o,n]:(o=null,e=m)):(o=null,e=m)}if(p!==null)if(m=t(),m!==null)if(a.substr(e,1)==='"'?(o='"',e+=1):(o=null,k&&
i('"\\""')),o!==null){n=e;if(a.substr(e,1)==="~"){var s="~";e+=1}else s=null,k&&i('"~"');if(s!==null){var q=z();q!==null?s=[s,q]:(s=null,e=n)}else s=null,e=n;n=s!==null?s:"";n!==null?g=[g,f,h,p,m,o,n]:(g=null,e=c)}else g=null,e=c;else g=null,e=c;else g=null,e=c}else g=null,e=c}else g=null,e=c}else g=null,e=c;c=g!==null?function(a,b,d){a=[a];if(b)for(var c=0,e=b.length;c<e;++c)a.push(b[c][1]);return{phrase:a,slop:d?d[1]:0}}(g[2],g[3],g[6]):null;l[d]={nextPos:e,result:c};return c}function J(){var d=
"TermQuery@"+e,c=l[d];if(c)return e=c.nextPos,c.result;var g=c=e,f=u();if(f!==null){if(a.substr(e,1)===":"){var h=":";e+=1}else h=null,k&&i('":"');h!==null?f=[f,h]:(f=null,e=g)}else f=null,e=g;g=f!==null?f:"";g!==null?(f=I(),f===null&&(f=H(),f===null&&(f=G(),f=f!==null?f:null)),f!==null?(h=D(),h!==null?g=[g,f,h]:(g=null,e=c)):(g=null,e=c)):(g=null,e=c);c=g!==null?function(a,b,d){a=a?a[0]:P;return b.phrase?new PhraseQuery(a,b.phrase,b.slop,d):b.startTerm?new TermRangeQuery(a,b.startTerm,b.endTerm,
b.excludeStart,b.excludeEnd,d):b.prefix?new PrefixQuery(a,b.prefix,d):new TermQuery(a,b.term,d)}(g[0],g[1],g[2]):null;l[d]={nextPos:e,result:c};return c}function w(){var d="BooleanClause@"+e,c=l[d];if(c)return e=c.nextPos,c.result;c=e;if(a.substr(e,1)==="+"){var g="+";e+=1}else g=null,k&&i('"+"');g===null&&(a.substr(e,1)==="-"?(g="-",e+=1):(g=null,k&&i('"-"')),g=g!==null?g:null);g=g!==null?g:"";if(g!==null){var f=K();f===null&&(f=J(),f=f!==null?f:null);f!==null?g=[g,f]:(g=null,e=c)}else g=null,e=
c;c=g!==null?function(a,b){a=a==="+"?Occur.MUST:a==="-"?Occur.MUST_NOT:Occur.SHOULD;return new BooleanClause(b,a)}(g[0],g[1]):null;l[d]={nextPos:e,result:c};return c}function L(){var a="BooleanQuery@"+e,b=l[a];if(b)return e=b.nextPos,b.result;var b=e,d=w();if(d!==null){var c=[],f=e,h=r();if(h!==null)for(var i=[];h!==null;)i.push(h),h=r();else i=null;i!==null?(h=w(),h!==null?i=[i,h]:(i=null,e=f)):(i=null,e=f);for(;i!==null;){c.push(i);f=e;h=r();if(h!==null)for(i=[];h!==null;)i.push(h),h=r();else i=
null;i!==null?(h=w(),h!==null?i=[i,h]:(i=null,e=f)):(i=null,e=f)}c!==null?d=[d,c]:(d=null,e=b)}else d=null,e=b;b=d!==null?function(a,b){var d=[a];if(b)for(var c=0,e=b.length;c<e;++c)d[d.length]=b[c][1];return new BooleanQuery(d)}(d[0],d[1]):null;l[a]={nextPos:e,result:b};return b}function K(){var d="SubQuery@"+e,c=l[d];if(c)return e=c.nextPos,c.result;c=e;if(a.substr(e,1)==="("){var f="(";e+=1}else f=null,k&&i('"("');if(f!==null){var h=M();if(h!==null){if(a.substr(e,1)===")"){var A=")";e+=1}else A=
null,k&&i('")"');if(A!==null){var p=D();p!==null?f=[f,h,A,p]:(f=null,e=c)}else f=null,e=c}else f=null,e=c}else f=null,e=c;c=f!==null?function(a,b){a.boost=b;return a}(f[1],f[3]):null;l[d]={nextPos:e,result:c};return c}function M(){var a="Query@"+e,b=l[a];if(b)return e=b.nextPos,b.result;var b=e,c=t();if(c!==null){var d=L();if(d!==null){var f=t();f!==null?c=[c,d,f]:(c=null,e=b)}else c=null,e=b}else c=null,e=b;b=c!==null?c[1]:null;l[a]={nextPos:e,result:b};return b}function Q(){var c=function(a){a.sort();
for(var b=null,c=[],d=0;d<a.length;d++)a[d]!==b&&(c.push(a[d]),b=a[d]);switch(c.length){case 0:return"end of input";case 1:return c[0];default:return c.slice(0,c.length-1).join(", ")+" or "+c[c.length-1]}}(y),d=Math.max(e,v),d=d<a.length?h(a.charAt(d)):"end of input";return"Expected "+c+" but "+d+" found."}function R(){for(var c=1,d=1,e=!1,f=0;f<v;f++){var h=a.charAt(f);h==="\n"?(e||c++,d=1,e=!1):h==="\r"|h==="\u2028"||h==="\u2029"?(c++,d=1,e=!0):(d++,e=!1)}return{line:c,column:d}}var N={BooleanClause:w,
BooleanQuery:L,Boost:D,ESCAPED_CHAR:E,Number:z,Phrase:I,Query:M,Range:H,SKIP:t,SubQuery:K,TERM_CHAR:C,TERM_START_CHAR:B,Term:u,TermQuery:J,TermType:G,WHITESPACE:r};if(d!==void 0){if(N[d]===void 0)throw Error("Invalid rule name: "+h(d)+".");}else d="Query";var e=0,k=!0,v=0,y=[],l={},P=c||null,d=N[d]();if(d===null||e!==a.length)throw d=R(),new this.SyntaxError(Q(),d.line,d.column);return d},toSource:function(){return typeof this._source==="string"?this._source:this.toString()},SyntaxError:function(a,
d,c){this.name="SyntaxError";this.message=a;this.line=d;this.column=c}};a.SyntaxError.prototype=Error.prototype;return a}();function Searcher(a){this._index=a}Searcher.prototype.similarity=new DefaultSimilarity;Searcher.prototype.search=function(a,b,d){b=new TopDocumentsCollector(b,d);(new NormalizedQuery(a)).score(this.similarity,this._index).pipe(b)};exports.Searcher=Searcher;function TermQuery(a,b,d){this.field=a||null;this.term=b;this.boost=d||1}TermQuery.prototype.field=null;
TermQuery.prototype.boost=1;TermQuery.prototype.score=function(a,b){var d=new TermScorer(this,a);b.getTermVectors(this.field,this.term).pipe(d);return d};TermQuery.prototype.extractTerms=function(){return[{term:this.term,field:this.field}]};TermQuery.prototype.rewrite=function(){return this};function TermScorer(a,b){Stream.call(this);this._boost=a.boost;this._similarity=b}TermScorer.prototype=Object.create(Stream.prototype);
TermScorer.prototype.onWrite=function(a){var b=this._similarity,d=new DocumentTerms(a.documentID,[a]),c=b.idf(a);d.sumOfSquaredWeights=c*this._boost*c*this._boost;d.score=b.tf(a)*c*c*this._boost*b.norm(a);this.emit(d)};TermScorer.prototype.onBulkWrite=function(a){var b=this._similarity,d,c,f,h=Array(a.length);x=0;for(xl=a.length;x<xl;++x)d=a[x],c=new DocumentTerms(d.documentID,[d]),f=b.idf(d),c.sumOfSquaredWeights=f*this._boost*f*this._boost,c.score=b.tf(d)*f*f*this._boost*b.norm(d),h[x]=c;this.emitBulk(h)};
exports.TermQuery=TermQuery;function TermRangeQuery(a,b,d,c,f,h){this.field=a||null;this.startTerm=b;this.endTerm=d;this.excludeStart=c||!1;this.excludeEnd=f||!1;this.boost=h||1}TermRangeQuery.prototype.field=null;TermRangeQuery.prototype.excludeStart=!1;TermRangeQuery.prototype.excludeEnd=!1;TermRangeQuery.prototype.boost=1;TermRangeQuery.prototype._terms=null;
TermRangeQuery.prototype.score=function(a,b){var d=this,c=new Stream;b.getTermRange(this.field,this.startTerm,this.endTerm,this.excludeStart,this.excludeEnd,function(f,h){if(f)c.error(f);else try{d._terms=h,(new MultiTermQuery(d.field,h,d.boost)).score(a,b).pipe(c)}catch(i){c.error(i)}});return c};
TermRangeQuery.prototype.extractTerms=function(){var a,b,d,c;if(this._terms){a=this._terms;b=Array(a.length);d=0;for(c=a.length;d<c;++d)b[d]={term:a[d],field:this.field};return b}else return[{term:this.startTerm,field:this.field}]};TermRangeQuery.prototype.rewrite=function(){return this};exports.TermRangeQuery=TermRangeQuery;function TopDocumentsCollector(a,b){Collector.call(this,b);this.max=a||1}TopDocumentsCollector.compareScores=function(a,b){return b.score-a.score};
TopDocumentsCollector.prototype=Object.create(Collector.prototype);TopDocumentsCollector.prototype.lowestScore=0;TopDocumentsCollector.prototype.onWrite=function(a){if(this.collection.length<this.max||a.score>this.lowestScore)this.collection.length>=this.max&&this.collection.pop(),Array.orderedInsert(this.collection,a,TopDocumentsCollector.compareScores),this.lowestScore=this.collection[this.collection.length-1].score};
TopDocumentsCollector.prototype.onBulkWrite=function(a){var b,d;b=0;for(d=a.length;b<d;++b)if(this.collection.length<this.max||a[b].score>this.lowestScore)this.collection.length>=this.max&&this.collection.pop(),Array.orderedInsert(this.collection,a[b],TopDocumentsCollector.compareScores),this.lowestScore=this.collection[this.collection.length-1].score};exports.TopDocumentsCollector=TopDocumentsCollector;
