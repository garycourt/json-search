var O={};function F(){}function typeOf(a){return a===void 0?"undefined":a===null?"null":Object.prototype.toString.call(a).split(" ").pop().split("]").shift().toLowerCase()}typeof exports==="undefined"&&(exports={});typeof require!=="function"&&(require=function(){return exports});if(typeof Object.create!=="function")Object.create=function(a){F.prototype=a;return new F};if(typeof Array.isArray!=="function")Array.isArray=function(a){return typeOf(a)==="array"};
if(typeof Array.add!=="function")Array.add=function(a,b){if(a.indexOf(b)===-1)return a[a.length]=b,!0;return!1};if(typeof Array.remove!=="function")Array.remove=function(a,b){var c=a.indexOf(b);if(c!==-1)return a.splice(c,1),!0;return!1};if(!Array.append)Array.append=function(a,b){b=b.slice(0);b.unshift(a.length,0);a.splice.apply(a,b);return a};
if(typeof Array.orderedInsert!=="function")Array.orderedInsert=function(a,b,c){var d,f,g;if(a.length===0)a[0]=b;else{d=0;f=a.length-1;for(g=Math.floor(f/2);d<f;)c(a[g],b)<=0?d=g+1:f=g-1,g=Math.round(d+(f-d)/2);d===f?c(a[d],b)<=0?a.splice(d+1,0,b):a.splice(d,0,b):a.splice(f+1,0,b)}};var EventEmitter=function(){};
try{if(!require("events").EventEmitter)throw Error();EventEmitter=require("events").EventEmitter}catch(e$$5){EventEmitter.prototype.emit=function(a,b){if(a==="error"&&(!this._events||!this._events.error||Array.isArray(this._events.error)&&!this._events.error.length))if(arguments[1]instanceof Error)throw arguments[1];else throw Error("Uncaught, unspecified 'error' event.");if(!this._events)return!1;var c=this._events[a];if(!c)return!1;if(typeof c=="function"){switch(arguments.length){case 1:c.call(this);
break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:b=Array.prototype.slice.call(arguments,1),c.apply(this,b)}return!0}else if(Array.isArray(c)){for(var b=Array.prototype.slice.call(arguments,1),c=c.slice(),d=0,f=c.length;d<f;d++)c[d].apply(this,b);return!0}else return!1},EventEmitter.prototype.addListener=function(a,b){if("function"!==typeof b)throw Error("addListener only takes instances of Function");if(!this._events)this._events={};this._events[a]?
Array.isArray(this._events[a])?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b;return this},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.once=function(a,b){function c(){d.removeListener(a,c);b.apply(this,arguments)}if("function"!==typeof b)throw Error(".once only takes instances of Function");var d=this;c.listener=b;d.on(a,c);return this},EventEmitter.prototype.removeListener=function(a,b){if("function"!==typeof b)throw Error("removeListener only takes instances of Function");
if(!this._events||!this._events[a])return this;var c=this._events[a];if(Array.isArray(c)){for(var d=-1,f=0,g=c.length;f<g;f++)if(c[f]===b||c[f].listener&&c[f].listener===b){d=f;break}if(d<0)return this;c.length===1?delete this._events[a]:c.splice(d,1)}else(c===b||c.listener&&c.listener===b)&&delete this._events[a];return this},EventEmitter.prototype.removeAllListeners=function(a){if(arguments.length===0)return this._events={},this;a&&this._events&&this._events[a]&&(this._events[a]=null);return this},
EventEmitter.prototype.listeners=function(a){if(!this._events)this._events={};this._events[a]||(this._events[a]=[]);Array.isArray(this._events[a])||(this._events[a]=[this._events[a]]);return this._events[a]}}exports.EventEmitter=EventEmitter;function Stream(){EventEmitter.call(this)}Stream.prototype=Object.create(EventEmitter.prototype);Stream.prototype.readable=!1;Stream.prototype.writable=!1;
Stream.prototype.pipe=function(a,b){function c(b){a.writable&&!1===a.write(b)&&k.pause()}function d(b){a.emit("error",b);k.destroy()}function f(){k.readable&&k.resume()}function g(){a.end()}function j(){k.pause()}function p(){k.readable&&k.resume()}function n(){k.removeListener("data",c);k.removeListener("error",d);a.removeListener("drain",f);k.removeListener("end",g);k.removeListener("close",g);a.removeListener("pause",j);a.removeListener("resume",p);k.removeListener("end",n);k.removeListener("close",
n);k.removeListener("error",n);a.removeListener("end",n);a.removeListener("close",n)}var k=this;k.on("data",c);if(!b||b.error!==!1)k.on("error",d);a.on("drain",f);if(!b||b.end!==!1)k.on("end",g),k.on("close",g);a.on("pause",j);a.on("resume",p);k.on("end",n);k.on("close",n);k.on("error",n);a.on("end",n);a.on("close",n)};Stream.prototype.pause=function(){this.emit("pause")};Stream.prototype.resume=function(){this.emit("resume")};
Stream.prototype.destroy=function(){this.writable=this.readable=!1;this.emit("close");this.removeAllListeners()};exports.Stream=Stream;function ArrayStream(a,b){Stream.call(this);this._entries=a;this._index=0;this._mapper=b}ArrayStream.prototype=Object.create(Stream.prototype);ArrayStream.prototype._started=!1;ArrayStream.prototype._paused=!1;ArrayStream.prototype.readable=!0;
ArrayStream.prototype._run=function(){var a;for(this._started=!0;!this._paused&&this._index<this._entries.length;)a=this._entries[this._index++],this._mapper&&(a=this._mapper(a)),this.emit("data",a);!this._paused&&this._index>=this._entries.length&&(this.emit("end"),this.destroy())};ArrayStream.prototype.start=function(){var a=this;setTimeout(function(){a._run()},0);return this};ArrayStream.prototype.pause=function(){this._paused=!0;Stream.prototype.pause.call(this)};
ArrayStream.prototype.resume=function(){if(this._started&&this._paused)this._paused=!1,this.start(),Stream.prototype.resume.call(this)};ArrayStream.prototype.destroy=function(){this._index=Number.POSITIVE_INFINITY;Stream.prototype.destroy.call(this)};exports.ArrayStream=ArrayStream;function Collector(a){var b=this;Stream.call(this);this.collection=[];this.callback=a||null;this.on("error",function(a){if(b.callback)b.callback(a),b.callback=null})}Collector.prototype=Object.create(Stream.prototype);
Collector.prototype.callback=null;Collector.prototype.writable=!0;Collector.prototype.write=function(a){this.collection.push(a);return!0};Collector.prototype.end=function(a){typeof a!=="undefined"&&this.write(a);this.destroy()};Collector.prototype.destroy=function(){if(this.callback)this.callback(null,this.collection),this.callback=null};exports.Collector=Collector;function SingleCollector(){Stream.call(this)}SingleCollector.prototype=Object.create(Stream.prototype);
SingleCollector.prototype._writing=!1;SingleCollector.prototype.readable=!0;SingleCollector.prototype.writable=!0;SingleCollector.prototype.write=function(a){if(typeof this.data!=="undefined")throw Error("Stream is full");this.data=a;this._writing=!0;this.emit("data",a);this._writing=!1;return typeof this.data==="undefined"};SingleCollector.prototype.drain=function(){this.data=void 0;this._writing||this.emit("drain")};
SingleCollector.prototype.end=function(a){typeof a!=="undefined"&&this.write(a);this.emit("end");this.destroy()};exports.SingleCollector=SingleCollector;function DefaultTermIndexer(){}
DefaultTermIndexer.prototype.index=function(a,b,c){var d,f,g=[];switch(typeOf(a)){case "null":case "boolean":case "number":g[0]={term:a,field:c,documentID:b};break;case "string":a=a.replace(/[^\w\d]/g," ").replace(/\s\s/g," ").toLowerCase().split(" ");d={};for(f=0;f<a.length;++f)d[a[f]]?(d[a[f]].termFrequency++,d[a[f]].termPositions.push(f)):d[a[f]]={term:a[f],termFrequency:1,termPositions:[f],field:c,totalFieldTokens:a.length,documentID:b};for(f in d)d[f]!==O[f]&&(g[g.length]=d[f]);break;case "object":for(f in a)a[f]!==
O[f]&&(g=g.concat(this.index(a[f],b,c?c+"."+f:f)));break;case "array":for(f=0;f<a.length;++f)g=g.concat(this.index(a[f],b,c?c+"."+f:String(f)))}return g};DefaultTermIndexer.prototype.toSource=function(){};exports.DefaultTermIndexer=DefaultTermIndexer;function MemoryIndex(){this._docs={};this._index={}}MemoryIndex.documentIDComparator=function(a,b){if(a.documentID<b.documentID)return-1;else if(a.documentID>b.documentID)return 1;return 0};MemoryIndex.prototype._docCount=0;
MemoryIndex.prototype._termIndexer=new DefaultTermIndexer;MemoryIndex.prototype.generateID=function(){return String(Math.random())};MemoryIndex.prototype.indexDocument=function(a,b,c){var d,f,a=this._termIndexer.index(a,b),b=0;for(d=a.length;b<d;++b)f=JSON.stringify([a[b].field,a[b].term]),this._index[f]?Array.orderedInsert(this._index[f],a[b],MemoryIndex.documentIDComparator):this._index[f]=[a[b]];c&&c(null)};
MemoryIndex.prototype.addDocument=function(a,b,c){b=typeof b==="undefined"||typeOf(b)==="null"?this.generateID():String(b);this._docs[b]=a;this._docCount++;this.indexDocument(a,b,c)};MemoryIndex.prototype.getDocument=function(a,b){b(null,this._docs[a])};MemoryIndex.prototype.setTermIndexer=function(a,b){var c=this._docs,d;this._termIndexer=a;this._index={};for(d in c)c.hasOwnProperty(d)&&this.indexDocument(c[d],d);b&&b(null)};
MemoryIndex.prototype.getTermVectors=function(a,b){var c=this._index[JSON.stringify([b,a])]||[],d=this;return(new ArrayStream(c,function(a){return{term:a.term,termFrequency:a.termFrequency||1,termPositions:a.termPositions||null,termOffsets:a.termOffsets||null,field:a.field||null,fieldBoost:a.fieldBoost||1,totalFieldTokens:a.totalFieldTokens||1,documentBoost:a.fieldBoost||1,documentID:a.documentID,documentFrequency:c.length,totalDocuments:d._docCount}})).start()};
MemoryIndex.prototype.getTermRangeVectors=function(){};exports.MemoryIndex=MemoryIndex;function BooleanClause(a,b){this.query=a;this.occur=b||Occur.SHOULD}var Occur={MUST:1,SHOULD:0,MUST_NOT:-1};exports.BooleanQuery=BooleanQuery;exports.Occur=Occur;function TopDocumentsCollector(a,b){Collector.call(this,b);this.max=a||1}TopDocumentsCollector.compareScores=function(a,b){return b.score-a.score};TopDocumentsCollector.prototype=Object.create(Collector.prototype);
TopDocumentsCollector.prototype.lowestScore=0;TopDocumentsCollector.prototype.write=function(a){if(this.collection.length<this.max||a.score>this.lowestScore)this.collection.length>=this.max&&this.collection.pop(),Array.orderedInsert(this.collection,a,TopDocumentsCollector.compareScores),this.lowestScore=this.collection[this.collection.length-1].score};exports.TopDocumentsCollector=TopDocumentsCollector;var DefaultSimilarity=function(){};
DefaultSimilarity.prototype.norm=function(a){return a.documentBoost*a.fieldBoost*(1/Math.sqrt(a.totalFieldTokens))};DefaultSimilarity.prototype.queryNorm=function(a){return 1/Math.sqrt(a.sumOfSquaredWeights)};DefaultSimilarity.prototype.tf=function(a){return Math.sqrt(a.termFrequency)};DefaultSimilarity.prototype.sloppyFreq=function(a){return 1/(a+1)};DefaultSimilarity.prototype.idf=function(a){return Math.log(a.totalDocuments/(a.documentFrequency+1))+1};
DefaultSimilarity.prototype.coord=function(a,b){return a/b};exports.DefaultSimilarity=DefaultSimilarity;function DocumentTerms(a,b){this.id=a;this.terms=b||[]}DocumentTerms.prototype.terms=[];DocumentTerms.prototype.sumOfSquaredWeights=0;DocumentTerms.prototype.score=0;exports.DocumentTerms=DocumentTerms;function FilterQuery(a,b,c){this.query=a;this.filter=b;this.boost=c||1}FilterQuery.prototype.boost=1;
FilterQuery.prototype.score=function(a,b){var c=new FilterScorer(this,a);this.query.score(a,b).pipe(c);return c};FilterQuery.prototype.extractTerms=function(){return this.query.extractTerms()};FilterQuery.prototype.rewrite=function(){var a;do a=this.query,this.query=this.query.rewrite();while(this.query!==a);return this};function FilterScorer(a,b){Stream.call(this);this._query=a;this._similarity=b;this._maxOverlap=a.extractTerms().length}FilterScorer.prototype=Object.create(Stream.prototype);
FilterScorer.prototype.readable=!0;FilterScorer.prototype.writable=!0;FilterScorer.prototype.write=function(a){this._query.filter(a)&&(a.score*=this._query.boost,a.sumOfSquaredWeights*=this._query.boost*this._query.boost,this.emit("data",a))};FilterScorer.prototype.end=function(a){typeof a!=="undefined"&&this.write(a);this.emit("end");this.destroy()};exports.FilterQuery=FilterQuery;function BooleanQuery(a,b,c){this.clauses=a||[];this.minimumOptionalMatches=b||0;this.boost=c||1}
BooleanQuery.prototype.minimumOptionalMatches=0;BooleanQuery.prototype.boost=1;BooleanQuery.prototype.score=function(a,b){return new BooleanScorer(this,a,b)};BooleanQuery.prototype.extractTerms=function(){var a,b,c=[];a=0;for(b=this.clauses.length;a<b;++a)c=c.concat(this.clauses[a].query.extractTerms());return c};
BooleanQuery.prototype.rewrite=function(){var a,b,c,d=!1;if(this.minimumOptionalMatches===0&&this.clauses.length===1&&this.clauses[0].occur!==Occur.MUST_NOT)a=this.clauses[0].query,a=a.rewrite(),a.boost*=this.boost;else{a=new BooleanQuery;a.boost=this.boost;b=0;for(c=this.clauses.length;b<c;++b)a.clauses[b]=new BooleanClause(this.clauses[b].query.rewrite(),this.clauses[b].occur),a.clauses[b].query!==this.clauses[b].query&&(d=!0);d||(a=this)}return a};
function BooleanScorer(a,b,c){Stream.call(this);this._query=a;this._similarity=b;this._index=c;this._inputs=[];this.addInputs(a.clauses)}BooleanScorer.prototype=Object.create(Stream.prototype);BooleanScorer.prototype._collectorCount=0;BooleanScorer.prototype._paused=!1;BooleanScorer.prototype.readable=!0;BooleanScorer.prototype.writable=!0;
BooleanScorer.prototype.addInputs=function(a){var b=this,c,d,f,g,j;c=0;for(d=a.length;c<d;++c)f=a[c],g=new SingleCollector,j=new BooleanClauseStream(f.query,f.occur,g),g.pipe(this,{end:!1}),f.query.score(this._similarity,this._index).pipe(g),this._inputs.push(j),this._collectorCount++,f=function(a){return function(){a.collector.removeListener("end",arguments.callee);a.collector.removeListener("close",arguments.callee);a.collector=null;b._collectorCount--;!b._collectorCount||a.occur===Occur.MUST?(b._collectorCount=
0,b.end()):b.write()}}(j),g.on("end",f),g.on("close",f)};
BooleanScorer.prototype.write=function(){var a,b,c=[],d=0,f=!1,g=0,j;if(this._paused)return!0;a=0;for(b=this._inputs.length;a<b;++a){if(this._inputs[a].collector){if(c[a]=this._inputs[a].collector.data,typeof c[a]==="undefined")return!0}else c[a]=void 0;if(a>0&&(!c[d]||c[a]&&c[a].id<c[d].id))d=a}d=c[d].id;j=new DocumentTerms(d);a=0;for(b=this._inputs.length;a<b;++a)if(c[a]&&c[a].id===d)if(this._inputs[a].occur===Occur.MUST_NOT){f=!1;break}else this._inputs[a].occur===Occur.SHOULD&&g++,f=!0,j.terms=
j.terms.concat(c[a].terms),j.sumOfSquaredWeights+=c[a].sumOfSquaredWeights,j.score+=c[a].score;else if(this._inputs[a].occur===Occur.MUST){f=!1;break}f&&g>=this._query.minimumOptionalMatches&&(j.score*=this._query.boost,j.sumOfSquaredWeights*=this._query.boost*this._query.boost,this.emit("data",j));a=0;for(b=this._inputs.length;a<b;++a)c[a]&&c[a].id===d&&this._inputs[a].collector.drain();return!0};
BooleanScorer.prototype.end=function(){if(this._collectorCount)throw Error("BooleanScorer#end called while there are still collectors attached!");this.emit("end");this.destroy()};BooleanScorer.prototype.pause=function(){this._paused=!0};BooleanScorer.prototype.resume=function(){this._paused=!1;this.write()};BooleanScorer.prototype.destroy=function(){var a,b;a=0;for(b=this._inputs.length;a<b;++a)this._inputs[a].collector&&this._inputs[a].collector.destroy();Stream.prototype.destroy.call(this)};
function BooleanClauseStream(a,b,c){this.query=a;this.occur=b;this.collector=c}BooleanClauseStream.prototype=Object.create(BooleanClause.prototype);exports.BooleanQuery=BooleanQuery;function QueryParser(){}QueryParser.parse=function(a,b){var c,d;c=QueryParser.impl.parse(a,void 0,b||null);do d=c,c=c.rewrite();while(c!==d);return c};
QueryParser.impl=function(){var a={parse:function(a,c,d){function f(a){var b=a.charCodeAt(0);if(b<=255)var a="x",c=2;else a="u",c=4;var a="\\"+a,e=b.toString(16).toUpperCase(),b=e;c-=e.length;for(e=0;e<c;e++)b="0"+b;return a+b}function g(a){return'"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/[\x80-\uFFFF]/g,f)+'"'}function j(a){e<q||(e>q&&(q=e,s=[]),s.push(a))}function p(){var c="WHITESPACE@"+e,i=m[c];if(i)return e=i.nextPos,i.result;i=l;l=!1;if(a.substr(e).match(/^[ \t\n\r\u3000]/)!==
null){var h=a.charAt(e);e++}else h=null,l&&j("[ \t\\n\\r\\u3000]");(l=i)&&h===null&&j("whitespace");m[c]={nextPos:e,result:h};return h}function n(){var a="SKIP@"+e,b=m[a];if(b)return e=b.nextPos,b.result;for(var b=[],c=p();c!==null;)b.push(c),c=p();m[a]={nextPos:e,result:b};return b}function k(){var c="Number@"+e,i=m[c];if(i)return e=i.nextPos,i.result;i=l;l=!1;var h=e;if(a.substr(e).match(/^[0-9]/)!==null){var o=a.charAt(e);e++}else o=null,l&&j("[0-9]");if(o!==null)for(var d=[];o!==null;)d.push(o),
a.substr(e).match(/^[0-9]/)!==null?(o=a.charAt(e),e++):(o=null,l&&j("[0-9]"));else d=null;if(d!==null){o=e;if(a.substr(e,1)==="."){var f=".";e+=1}else f=null,l&&j('"."');if(f!==null){if(a.substr(e).match(/^[0-9]/)!==null){var g=a.charAt(e);e++}else g=null,l&&j("[0-9]");if(g!==null)for(var k=[];g!==null;)k.push(g),a.substr(e).match(/^[0-9]/)!==null?(g=a.charAt(e),e++):(g=null,l&&j("[0-9]"));else k=null;k!==null?f=[f,k]:(f=null,e=o)}else f=null,e=o;o=f!==null?f:"";o!==null?d=[d,o]:(d=null,e=h)}else d=
null,e=h;h=d!==null?parseFloat(d[0].concat(d[1][0],d[1][1]).join("")):null;(l=i)&&h===null&&j("number");m[c]={nextPos:e,result:h};return h}function x(){var c="ESCAPED_CHAR@"+e,i=m[c];if(i)return e=i.nextPos,i.result;i=e;if(a.substr(e,1)==="\\"){var h="\\";e+=1}else h=null,l&&j('"\\\\"');if(h!==null){if(a.length>e){var d=a.charAt(e);e++}else d=null,l&&j("any character");d!==null?h=[h,d]:(h=null,e=i)}else h=null,e=i;m[c]={nextPos:e,result:h};return h}function t(){var c="TERM_START_CHAR@"+e,i=m[c];if(i)return e=
i.nextPos,i.result;a.substr(e).match(/^[^ \t\n\r\u3000+\-!():^[\]"{}~*?\\]/)!==null?(i=a.charAt(e),e++):(i=null,l&&j('[^ \t\\n\\r\\u3000+\\-!():^[\\]"{}~*?\\\\]'));m[c]={nextPos:e,result:i};return i}function u(){var c="TERM_CHAR@"+e,i=m[c];if(i)return e=i.nextPos,i.result;i=t();i===null&&(i=x(),i===null&&(a.substr(e,1)==="-"?(i="-",e+=1):(i=null,l&&j('"-"')),i===null&&(a.substr(e,1)==="+"?(i="+",e+=1):(i=null,l&&j('"+"')),i=i!==null?i:null)));m[c]={nextPos:e,result:i};return i}function v(){var a=
"Term@"+e,b=m[a];if(b)return e=b.nextPos,b.result;b=l;l=!1;var c=e,d=t();if(d!==null){for(var f=[],g=u();g!==null;)f.push(g),g=u();f!==null?d=[d,f]:(d=null,e=c)}else d=null,e=c;c=d!==null?[d[0]].concat(d[1]).join(""):null;(l=b)&&c===null&&j("term");m[a]={nextPos:e,result:c};return c}function w(){var c="Boost@"+e,i=m[c];if(i)return e=i.nextPos,i.result;i=l;l=!1;var h=e;if(a.substr(e,1)==="^"){var d="^";e+=1}else d=null,l&&j('"^"');if(d!==null){var f=k();f!==null?d=[d,f]:(d=null,e=h)}else d=null,e=
h;h=d!==null?d:"";h=h!==null?function(a){a&&(a=a[1]);return typeof a==="number"?a:1}(h):null;(l=i)&&h===null&&j("boost");m[c]={nextPos:e,result:h};return h}function y(){var c="TermQuery@"+e,i=m[c];if(i)return e=i.nextPos,i.result;var h=i=e,d=v();if(d!==null){if(a.substr(e,1)===":"){var f=":";e+=1}else f=null,l&&j('":"');f!==null?d=[d,f]:(d=null,e=h)}else d=null,e=h;h=d!==null?d:"";h!==null?(d=v(),d!==null?(f=w(),f!==null?h=[h,d,f]:(h=null,e=i)):(h=null,e=i)):(h=null,e=i);i=h!==null?new TermQuery(h[1],
h[0]?h[0][0]:D,h[2]):null;m[c]={nextPos:e,result:i};return i}function r(){var c="BooleanClause@"+e,d=m[c];if(d)return e=d.nextPos,d.result;d=e;if(a.substr(e,1)==="+"){var h="+";e+=1}else h=null,l&&j('"+"');h===null&&(a.substr(e,1)==="-"?(h="-",e+=1):(h=null,l&&j('"-"')),h=h!==null?h:null);h=h!==null?h:"";if(h!==null){var f=z();f===null&&(f=y(),f=f!==null?f:null);f!==null?h=[h,f]:(h=null,e=d)}else h=null,e=d;d=h!==null?function(a,b){a=a==="+"?Occur.MUST:a==="-"?Occur.MUST_NOT:Occur.SHOULD;return new BooleanClause(b,
a)}(h[0],h[1]):null;m[c]={nextPos:e,result:d};return d}function A(){var a="BooleanQuery@"+e,b=m[a];if(b)return e=b.nextPos,b.result;var b=e,c=r();if(c!==null){var d=[],f=e,g=n();if(g!==null){var j=r();j!==null?g=[g,j]:(g=null,e=f)}else g=null,e=f;for(;g!==null;)d.push(g),f=e,g=n(),g!==null?(j=r(),j!==null?g=[g,j]:(g=null,e=f)):(g=null,e=f);d!==null?c=[c,d]:(c=null,e=b)}else c=null,e=b;b=c!==null?function(a,b){var c=[a];if(b)for(var e=0,d=b.length;e<d;++e)c[c.length]=b[e][1];return new BooleanQuery(c)}(c[0],
c[1]):null;m[a]={nextPos:e,result:b};return b}function z(){var c="SubQuery@"+e,d=m[c];if(d)return e=d.nextPos,d.result;d=e;if(a.substr(e,1)==="("){var f="(";e+=1}else f=null,l&&j('"("');if(f!==null){var g=B();if(g!==null){if(a.substr(e,1)===")"){var k=")";e+=1}else k=null,l&&j('")"');if(k!==null){var n=w();n!==null?f=[f,g,k,n]:(f=null,e=d)}else f=null,e=d}else f=null,e=d}else f=null,e=d;d=f!==null?function(a,b){a.boost=b;return a}(f[1],f[3]):null;m[c]={nextPos:e,result:d};return d}function B(){var a=
"Query@"+e,b=m[a];if(b)return e=b.nextPos,b.result;var b=e,c=n();if(c!==null){var d=A();if(d!==null){var f=n();f!==null?c=[c,d,f]:(c=null,e=b)}else c=null,e=b}else c=null,e=b;b=c!==null?c[1]:null;m[a]={nextPos:e,result:b};return b}function E(){var c=function(a){a.sort();for(var b=null,c=[],d=0;d<a.length;d++)a[d]!==b&&(c.push(a[d]),b=a[d]);switch(c.length){case 0:return"end of input";case 1:return c[0];default:return c.slice(0,c.length-1).join(", ")+" or "+c[c.length-1]}}(s),d=Math.max(e,q),d=d<a.length?
g(a.charAt(d)):"end of input";return"Expected "+c+" but "+d+" found."}function G(){for(var c=1,d=1,e=!1,f=0;f<q;f++){var g=a.charAt(f);g==="\n"?(e||c++,d=1,e=!1):g==="\r"|g==="\u2028"||g==="\u2029"?(c++,d=1,e=!0):(d++,e=!1)}return{line:c,column:d}}var C={BooleanClause:r,BooleanQuery:A,Boost:w,ESCAPED_CHAR:x,Number:k,Query:B,SKIP:n,SubQuery:z,TERM_CHAR:u,TERM_START_CHAR:t,Term:v,TermQuery:y,WHITESPACE:p};if(c!==void 0){if(C[c]===void 0)throw Error("Invalid rule name: "+g(c)+".");}else c="Query";var e=
0,l=!0,q=0,s=[],m={},D=d||null,c=C[c]();if(c===null||e!==a.length)throw c=G(),new this.SyntaxError(E(),c.line,c.column);return c},toSource:function(){return typeof this._source==="string"?this._source:this.toString()},SyntaxError:function(a,c,d){this.name="SyntaxError";this.message=a;this.line=c;this.column=d}};a.SyntaxError.prototype=Error.prototype;return a}();function Searcher(a){this._index=a}Searcher.prototype.similarity=new DefaultSimilarity;
Searcher.prototype.search=function(a,b,c){b=new TopDocumentsCollector(b,c);(new NormalizedQuery(a)).score(this.similarity,this._index).pipe(b)};exports.Searcher=Searcher;function TermQuery(a,b,c){this.term=a;this.field=b||null;this.boost=c||1}TermQuery.prototype.field=null;TermQuery.prototype.boost=1;TermQuery.prototype.score=function(a,b){var c=new TermScorer(this,a);b.getTermVectors(this.term,this.field).pipe(c);return c};TermQuery.prototype.extractTerms=function(){return[{term:this.term,field:this.field}]};
TermQuery.prototype.rewrite=function(){return this};function TermScorer(a,b){Stream.call(this);this._boost=a.boost;this._similarity=b}TermScorer.prototype=Object.create(Stream.prototype);TermScorer.prototype.readable=!0;TermScorer.prototype.writable=!0;TermScorer.prototype.write=function(a){var b=this._similarity,c=new DocumentTerms(a.documentID,[a]),d=b.idf(a);c.sumOfSquaredWeights=d*this._boost*d*this._boost;c.score=b.tf(a)*d*d*this._boost*b.norm(a);this.emit("data",c)};
TermScorer.prototype.end=function(a){typeof a!=="undefined"&&this.write(a);this.emit("end");this.destroy()};exports.TermQuery=TermQuery;function NormalizedQuery(a,b){this.query=a;this.boost=b||1}NormalizedQuery.prototype.boost=1;NormalizedQuery.prototype.score=function(a,b){var c=new NormalizedScorer(this,a);this.query.score(a,b).pipe(c);return c};NormalizedQuery.prototype.extractTerms=function(){return this.query.extractTerms()};
NormalizedQuery.prototype.rewrite=function(){var a;do a=this.query,this.query=this.query.rewrite();while(this.query!==a);return this};function NormalizedScorer(a,b){Stream.call(this);this._query=a;this._similarity=b;this._maxOverlap=a.extractTerms().length}NormalizedScorer.prototype=Object.create(Stream.prototype);NormalizedScorer.prototype.readable=!0;NormalizedScorer.prototype.writable=!0;
NormalizedScorer.prototype.write=function(a){a.score*=this._query.boost*this._similarity.queryNorm(a)*this._similarity.coord(a.terms.length,this._maxOverlap);this.emit("data",a)};NormalizedScorer.prototype.end=function(a){typeof a!=="undefined"&&this.write(a);this.emit("end");this.destroy()};exports.NormalizedQuery=NormalizedQuery;
